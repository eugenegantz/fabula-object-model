{"version":3,"sources":["webpack:///webpack/bootstrap 0f6b4087b1c87c1611f0","webpack:///./fabula-object-model/browser/FabulaObjectModel.js","webpack:///./fabula-object-model/browser/cascade.js","webpack:///./fabula-object-model/browser/DBModel.js","webpack:///./fabula-object-model/_FabulaObjectModel.js","webpack:///./fabula-object-model/data-models/AgentsDataModel.js","webpack:///./fabula-object-model/data-models/DataModelAdapters.js","webpack:///./fabula-object-model/utils.js","webpack:///./fabula-object-model/data-models/MovDataModel.js","webpack:///./fabula-object-model/data-models/DefaultDataModel.js","webpack:///./fabula-object-model/data-models/InterfaceEvents.js","webpack:///./fabula-object-model/data-models/IEvent.js","webpack:///./fabula-object-model/data-models/InterfaceFProperty.js","webpack:///./fabula-object-model/data-models/ObjectA.js","webpack:///./fabula-object-model/data-models/TalksDataModel.js","webpack:///./fabula-object-model/data-models/DocDataModel.js","webpack:///./fabula-object-model/data-models/GandsDataModel.js","webpack:///./fabula-object-model/data-models/FirmsDataModel.js","webpack:///./fabula-object-model/data-models/PathsDataModel.js","webpack:///./fabula-object-model/data-models/calc/DefaultPrintCalc.js"],"names":[],"mappings":";AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,uBAAe;AACf;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;;;;;;;;;ACtCA;AACA;AACA;AACA;AACA;;AAEA;AACA,uBAAsB;AACtB;AACA;AACA;AACA;;AAEA;;AAEA;AACA,EAAC;;AAED;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,eAAc,eAAe;AAC7B;AACA;AACA;AACA;AACA,EAAC,I;;;;;;;;;ACnCD;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,eAAc,qBAAqB;AACnC;AACA;AACA;AACA;;AAEA,eAAc,qBAAqB;AACnC;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA,EAAC,I;;;;;;;;;AClGD;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,IAAG;AACH;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;;AAGA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA,sFAAqF;AACrF,oEAAmE;AACnE,kEAAiE;AACjE;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,GAAE;;;AAGF;AACA,eAAc,6BAA6B;AAC3C;AACA;AACA,GAAE;;;AAGF;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,GAAE;;;AAGF;AACA;AACA,GAAE;;;AAGF;AACA;AACA;AACA;AACA,eAAc,yBAAyB;AACvC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;;AAGF;AACA;AACA;;AAEA;AACA;AACA;;AAEA,YAAW,gBAAgB;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;;AAEA,aAAY,0BAA0B;AACtC;;AAEA;;AAEA,cAAa,cAAc;AAC3B;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA,GAAE;;;AAGF;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,GAAE;;;AAGF;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA,MAAK;AACL;;AAEA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA,GAAE;;;AAGF;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA,KAAI;AACJ;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,IAAG;AACH;;AAEA;;AAEA;;AAEA;;AAEA,0B;;;;;;;;;;AC9RA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA,YAAW,OAAO;AAClB,YAAW,kBAAkB;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA,YAAW,OAAO;AAClB,YAAW,MAAM;AACjB,aAAY;AACZ;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA,GAAE;AACF;AACA;;AAEA,IAAG;AACH;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA,iC;;;;;;;;;ACzHA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA,GAAE;;AAEF;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,8EAA6E;AAC7E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA,kC;;;;;;;;;AC9DA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+BAA8B,OAAO;AACrC;AACA;AACA;AACA,kCAAiC,OAAO;AACxC;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA,cAAa,oBAAoB;AACjC;;AAEA;AACA;;AAEA,IAAG;AACH;;AAEA,IAAG;AACH;;AAEA,IAAG;AACH;AACA;;AAEA;;AAEA;;AAEA,eAAc,cAAc;AAC5B;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,cAAa,oBAAoB;AACjC;;AAEA;AACA;;AAEA,IAAG;AACH;;AAEA,IAAG;AACH;;AAEA,IAAG;AACH;AACA;;AAEA;;AAEA;;AAEA,eAAc,cAAc;AAC5B;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,cAAa,oBAAoB;AACjC;;AAEA;AACA;;AAEA,IAAG;AACH;;AAEA,IAAG;AACH;;AAEA,IAAG;AACH;AACA;;AAEA;;AAEA;;AAEA,eAAc,cAAc;;AAE5B;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,MAAK;AACL;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA,cAAa,oBAAoB;AACjC;;AAEA;AACA;;AAEA,IAAG;AACH;;AAEA,IAAG;AACH;;AAEA,IAAG;AACH;AACA;;AAEA;;AAEA;;AAEA,eAAc,cAAc;AAC5B;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA,UAAS,oBAAoB;AAC7B;;AAEA;AACA;;AAEA,IAAG;AACH;;AAEA,IAAG;AACH;;AAEA,IAAG;AACH;AACA;;AAEA;;AAEA;;AAEA,WAAU,cAAc;;AAExB;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,MAAK;AACL;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;AACA,aAAY;AACZ,eAAc,OAAO;AACrB,eAAc,OAAO;AACrB,eAAc,OAAO;AACrB;AACA;AACA;AACA,cAAa,cAAc;AAC3B;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA,iDAAgD,4BAA4B;AAC5E,WAAU,+BAA+B;AACzC;AACA;AACA;AACA,WAAU,mBAAmB;AAC7B;AACA;AACA;AACA,kDAAiD,8BAA8B;AAC/E;AACA;AACA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;AACA;;AAEA;AACA,YAAW,oBAAoB;AAC/B;AACA;AACA;AACA;AACA,OAAM;;AAEN,MAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;;AAEA,IAAG;AACH;AACA;;AAEA;;AAEA,iDAAgD,4BAA4B;AAC5E,WAAU,+BAA+B;AACzC;AACA;;AAEA;;AAEA;;AAEA;;AAEA,WAAU,mBAAmB;AAC7B;AACA;AACA;AACA,gCAA+B,6BAA6B;AAC5D;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA,iCAAgC,yBAAyB;AACzD,GAAE;;AAEF;AACA;AACA;AACA;;AAEA,4BAA2B,0BAA0B;;AAErD;AACA;AACA,6BAA4B,yCAAyC;AACrE;AACA;AACA,GAAE;;AAEF;;AAEA;AACA;AACA;;AAEA,WAAU,mBAAmB;AAC7B;;AAEA,yBAAwB,wBAAwB;;AAEhD;AACA;AACA;AACA,KAAI;AACJ;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA,WAAU,eAAe;AACzB;AACA;AACA;AACA;AACA;;AAEA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA,WAAU,wBAAwB;AAClC;AACA;AACA;AACA,WAAU,eAAe;AACzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,eAAc,aAAa;AAC3B;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;AACA;AACA,GAAE;;AAEF;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA,eAAc,eAAe;AAC7B;AACA;AACA;AACA,GAAE;;AAEF;AACA,iCAAgC,wBAAwB;AACxD,GAAE;;AAEF;AACA;AACA;AACA;;AAEA,4BAA2B,yBAAyB;;AAEpD;AACA;AACA,6BAA4B,qCAAqC;AACjE;AACA;AACA;AACA;;AAEA,2B;;;;;;;;;ACxgBA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAa,aAAa;AAC1B;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,YAAW,MAAM;AACjB,YAAW,OAAO;AAClB;AACA;AACA;AACA;AACA;AACA,GAAE,kCAAkC;AACpC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA,YAAW,MAAM;AACjB,YAAW,OAAO;AAClB;AACA;AACA;AACA;AACA;;AAEA;AACA,YAAW,OAAO;AAClB,YAAW,cAAc;AACzB,YAAW,OAAO;AAClB;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA,GAAE;;AAEF,GAAE;AACF;;AAEA;;AAEA;;AAEA;;AAEA,QAAO;AACP;AACA;;AAEA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,IAAG;AACH;;AAEA;;AAEA;;AAEA;AACA;;;AAGA;AACA,YAAW,OAAO;AAClB,YAAW,cAAc;AACzB;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA,YAAW,OAAO;AAClB,YAAW,cAAc;AACzB;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;;;AAGA;AACA,YAAW,MAAM;AACjB,YAAW,OAAO;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA,cAAa,eAAe;AAC5B;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,cAAa,eAAe;AAC5B;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,cAAa,eAAe;AAC5B;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA,kBAAiB,iBAAiB;AAClC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;;AAEA,kBAAiB,kBAAkB;AACnC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA,IAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;AACF;AACA;AACA;AACA,kBAAiB,mBAAmB;AACpC;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA,YAAW,EAAE;AACb,aAAY;AACZ;AACA;AACA;AACA;;AAEA,GAAE;AACF;;AAEA,GAAE;AACF;;AAEA,GAAE;AACF;;AAEA,GAAE;AACF;;AAEA;AACA;;;AAGA;AACA;AACA;AACA,wBAAuB,IAAI;AAC3B,YAAW,OAAO;AAClB,YAAW,EAAE;AACb,YAAW,OAAO;AAClB,YAAW,QAAQ;AACnB,YAAW,QAAQ;AACnB,YAAW,QAAQ;AACnB,YAAW,QAAQ;AACnB,YAAW,QAAQ;AACnB,YAAW,MAAM;AACjB,YAAW,cAAc;AACzB;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA,kGAAiG;;AAEjG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA,IAAG;;AAEH;;AAEA,IAAG;;AAEH;;AAEA,IAAG;AACH;AACA;;AAEA;;AAEA,eAAc,gBAAgB;AAC9B;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK,UAAU;;AAEf;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAM;AACN;AACA;AACA;AACA,MAAK;AACL;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA,GAAE;;;AAGF,wB;;;;;;;;;AChhBA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;;;AAGH;AACA;AACA,gBAAe,4BAA4B;AAC3C;AACA;AACA,IAAG;;;AAGH;AACA;AACA;;AAEA;;AAEA,YAAW,4BAA4B;AACvC;AACA;AACA;AACA;;AAEA,YAAW,yBAAyB;AACpC;AACA;AACA;AACA,aAAY,eAAe;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;;;AAGH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;;;AAGH;AACA;AACA,IAAG;;;AAGH;AACA;;AAEA;;AAEA,KAAI;AACJ;;AAEA,KAAI;AACJ;;AAEA;;AAEA,cAAa,gBAAgB;AAC7B;;AAEA;;AAEA;;AAEA,MAAK;;AAEL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA,IAAG;;;AAGH;AACA;AACA,IAAG;;;AAGH;AACA;AACA,IAAG;;;AAGH;AACA;AACA,IAAG;;AAEH;AACA;AACA,IAAG;;AAEH;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,KAAI;;AAEJ;AACA;AACA;AACA;AACA;AACA,mBAAkB,eAAe;AACjC;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA,IAAG;;;AAGH;AACA,cAAa,sBAAsB;AACnC,cAAa,QAAQ;AACrB;AACA;AACA;AACA;AACA,IAAG;;;AAGH;AACA,cAAa,sBAAsB;AACnC,cAAa,QAAQ;AACrB;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA,aAAY,4BAA4B;AACxC;AACA;AACA;AACA;;AAEA,KAAI;;AAEJ;AACA;AACA;AACA;;AAEA;;AAEA;AACA,eAAc,eAAe;AAC7B;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA,IAAG;;;AAGH;AACA;AACA;AACA;AACA,gBAAe,eAAe;AAC9B;AACA;AACA;AACA;AACA;AACA,IAAG;;;AAGH;;AAEA;;AAEA;;AAEA;;AAEA,yCAAwC;;AAExC;AACA;AACA;AACA;AACA;AACA,sBAAqB;AACrB,KAAI;;AAEJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,YAAW,iBAAiB;AAC5B;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,yBAAwB;AACxB;AACA;;AAEA,cAAa,gBAAgB;AAC7B;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA,cAAa,uBAAuB;AACpC;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA,cAAa,wBAAwB;AACrC;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA,MAAK;AACL,KAAI,EAAE;;AAEN,IAAG;;;AAGH;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ,IAAG;;;AAGH;;AAEA;;AAEA,yCAAwC;;AAExC;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,yEAAwE;AACxE;;AAEA;AACA;;AAEA,MAAK;AACL;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA,YAAW,yBAAyB;;AAEpC;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;;;AAGA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,2BAA0B;AAC1B;AACA;AACA,oBAAmB,gBAAgB;AACnC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAM;;AAEN;AACA;;AAEA,YAAW,4BAA4B;AACvC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAQ;AACR;AACA;AACA,MAAK;AACL;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA,MAAK;;AAEL,IAAG;;;AAGH;AACA,cAAa,QAAQ;AACrB,cAAa,QAAQ;AACrB,cAAa,QAAQ;AACrB,cAAa,MAAM;AACnB,cAAa,MAAM;AACnB,cAAa,SAAS;AACtB;AACA;AACA;;AAEA,yCAAwC;;AAExC;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,0BAAyB;AACzB,KAAI;;AAEJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0BAAyB;AACzB,KAAI;AACJ;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;;AAGA;;AAEA;;AAEA;;AAEA;AACA,yBAAwB;AACxB;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA,2BAA0B;AAC1B,2BAA0B;AAC1B;AACA;;AAEA;AACA;AACA,cAAa,4BAA4B;AACzC;AACA;AACA;;AAEA;AACA;AACA,cAAa,yBAAyB;AACtC;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,eAAc,yBAAyB;AACvC;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,eAAc,kBAAkB;;AAEhC;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA,eAAc,yBAAyB;AACvC;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;;AAEA,eAAc,wBAAwB;AACtC;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,4EAA2E;AAC3E;;AAEA;AACA;;AAEA,SAAQ;AACR;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,8BAA6B;AAC7B;AACA;AACA,uBAAsB,gBAAgB;AACtC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;;AAEA;;AAEA,gBAAe,4BAA4B;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAY;AACZ;AACA;AACA,UAAS;AACT;;AAEA,QAAO;;AAEP;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAU;AACV;AACA;;AAEA;;AAEA,OAAM;;;AAGN;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA,QAAO;;AAEP;AACA,KAAI;;AAEJ,IAAG;;;AAGH;AACA,eAAc,YAAY;AAC1B,eAAc,YAAY;AAC1B,iBAAgB,YAAY;AAC5B,eAAc,YAAY;AAC1B,cAAa,YAAY;AACzB,eAAc,YAAY;AAC1B,kBAAiB,YAAY;AAC7B,gBAAe,YAAY;AAC3B,gBAAe,YAAY;AAC3B,gBAAe,YAAY;AAC3B,iBAAgB,YAAY;AAC5B,eAAc,YAAY;AAC1B,gBAAe,YAAY;AAC3B,gBAAe,YAAY;AAC3B,iBAAgB,YAAY;AAC5B,iBAAgB,YAAY;AAC5B,cAAa,YAAY;AACzB,gBAAe,YAAY;AAC3B,gBAAe,YAAY;AAC3B,kBAAiB,YAAY;AAC7B,gBAAe,YAAY;AAC3B,eAAc,YAAY;AAC1B,iBAAgB,YAAY;AAC5B,gBAAe,YAAY;AAC3B,kBAAiB,YAAY;AAC7B,cAAa,YAAY;AACzB,eAAc,YAAY;AAC1B,mBAAkB,YAAY;AAC9B,gBAAe,YAAY;AAC3B,gBAAe,YAAY;AAC3B,gBAAe,YAAY;AAC3B,iBAAgB,YAAY;AAC5B,kBAAiB;AACjB,IAAG;;;AAGH;AACA;;AAEA;;AAEA;AACA,kFAAiF;;AAEjF;AACA,yCAAwC;;AAExC;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,0BAAyB;AACzB;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA,OAAM;AACN;AACA;AACA;;AAEA,OAAM;;AAEN,MAAK;;AAEL,KAAI,EAAE;AACN;;;AAGA;AACA;;AAEA,+B;;;;;;;;;AC7sCA;AACA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;;AAEA,UAAS,oBAAoB;;AAE7B;;AAEA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;;;AAGA;AACA;AACA,IAAG;;;AAGH;AACA;AACA,IAAG;;AAEH;AACA,cAAa,OAAO;AACpB,cAAa,OAAO;AACpB,cAAa,gBAAgB;AAC7B;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA,KAAI;AACJ;AACA;AACA;AACA;;AAEA,KAAI;AACJ;;AAEA,KAAI;AACJ;AACA;AACA;AACA;;AAEA;;AAEA,IAAG;;AAEH;AACA,cAAa,OAAO;AACpB,cAAa,OAAO;AACpB,cAAa,EAAE;AACf;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA,MAAK;;AAEL;;AAEA,MAAK;;AAEL;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA,IAAG;;;AAGH;AACA,cAAa,OAAO;AACpB;AACA,cAAa,OAAO;AACpB,cAAa,EAAE;AACf;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA,wDAAuD,gCAAgC,EAAE;AACzF,4DAA2D,gCAAgC,EAAE;AAC7F;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,MAAK;AACL;AACA;;AAEA,MAAK;AACL;;AAEA;;AAEA,KAAI;AACJ;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA,IAAG;;;AAGH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;;;AAGH;AACA;AACA;;;AAGA;AACA;;AAEA,mC;;;;;;;;;AC1RA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,gBAAe,iBAAiB;;AAEhC;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA,GAAE;;;AAGF;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA,GAAE;;;AAGF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAe,iBAAiB;AAChC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;;AAGF;AACA;AACA,aAAY,OAAO;AACnB,aAAY,QAAQ;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,GAAE;;;AAGF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;;AAGF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,kC;;;;;;;;;AC9JA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,yB;;;;;;;;;ACfA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,eAAc,eAAe;AAC7B;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA,eAAc,eAAe;AAC7B;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;;AAEA;AACA;;AAEA,IAAG;AACH;;AAEA;AACA;;AAEA,KAAI;AACJ;AACA;;AAEA,IAAG;AACH;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,cAAa,iBAAiB;AAC9B,cAAa,iBAAiB;AAC9B,eAAc,iBAAiB;AAC/B,eAAc,gBAAgB;AAC9B,iBAAgB,gBAAgB;AAChC,iBAAgB,gBAAgB;AAChC,eAAc,gBAAgB;AAC9B,iBAAgB,gBAAgB;AAChC,eAAc;AACd,IAAG;;;AAGH;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAgB,cAAc;AAC9B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,iBAAgB,cAAc;AAC9B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,KAAI;AACJ;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA,YAAW,gBAAgB;AAC3B;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,YAAW,gBAAgB;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,IAAG;;;AAGH;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA,iBAAgB,mBAAmB;AACnC;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;;AAEA;AACA;;AAEA;AACA,IAAG;;;AAGH;AACA;AACA,IAAG;;;AAGH;AACA;AACA;AACA;AACA;;AAEA;AACA,YAAW,eAAe;AAC1B;AACA;AACA;;AAEA;AACA;;AAEA,YAAW,gBAAgB;AAC3B;AACA,aAAY,eAAe;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,IAAG;;;AAGH;AACA;AACA;AACA,iBAAgB,aAAa;AAC7B;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;;AAEA,KAAI;;AAEJ,KAAI;AACJ;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA,cAAa,EAAE;;AAEf;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA,cAAa,eAAe;AAC5B;AACA;AACA;AACA;;AAEA;AACA;;AAEA,MAAK;;AAEL;;AAEA;;AAEA;;AAEA;;AAEA,IAAG;;;AAGH;AACA,eAAc;AACd,cAAa,OAAO;AACpB;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,YAAW,yBAAyB;AACpC;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA,aAAY,eAAe;AAC3B;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA,IAAG;;;AAGH;AACA;AACA,IAAG;;;AAGH;AACA;AACA,IAAG;;;AAGH;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,gBAAe,yBAAyB;AACxC;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA,IAAG;;AAEH;AACA;AACA;;AAEA;AACA;;AAEA,qC;;;;;;;;;ACneA;AACA;AACA,YAAW,OAAO;AAClB;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA,cAAa,eAAe;AAC5B;AACA;;AAEA;;AAEA;AACA,YAAW,OAAO;AAClB;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,aAAY,OAAO;AACnB;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA,GAAE;;AAEF;AACA;AACA,aAAY,OAAO;AACnB,aAAY,IAAI;AAChB;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA,GAAE;;AAEF;AACA;AACA,aAAY,OAAO;AACnB;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,aAAY,OAAO;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,0B;;;;;;;;;AC9GA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA,0DAAyD;AACzD;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA,OAAM;AACN;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA,MAAK;AACL,mDAAkD;AAClD;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,6EAA4E;;AAE5E;AACA;AACA;AACA;;AAEA,SAAQ;AACR;;AAEA;AACA;AACA;AACA;AACA,MAAK;;AAEL,KAAI;AACJ,IAAG;AACH,GAAE;;;AAGF,0BAAyB;;;AAGzB;AACA;AACA;AACA;;AAEA,iC;;;;;;;;;ACvHA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,gBAAe,oBAAoB;AACnC;AACA;AACA;AACA;AACA;AACA,IAAG;;;AAGH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;;;AAGH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;;;AAGH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAiB,gBAAgB;AACjC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;;;AAGH;;AAEA,IAAG;;;AAGH;AACA,gBAAe,oBAAoB;AACnC;AACA;AACA;AACA,IAAG;;;AAGH;AACA,eAAc;AACd,cAAa,QAAQ;AACrB,cAAa,QAAQ;AACrB;AACA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;;AAEA,aAAY,oBAAoB;AAChC;AACA;AACA;AACA;;AAEA,KAAI;;AAEJ;AACA;AACA;AACA;;AAEA;;AAEA;AACA,eAAc,eAAe;AAC7B;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA,IAAG;;;AAGH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;;;AAGH;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,KAAI;AACJ;AACA;AACA;AACA;AACA;AACA,mBAAkB,eAAe;AACjC;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA,IAAG;;;AAGH;AACA;AACA,IAAG;;;AAGH;AACA;AACA,IAAG;;;AAGH;AACA;AACA,IAAG;;;AAGH;AACA;;AAEA;;AAEA,yCAAwC;;AAExC;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA,OAAM;AACN,kBAAiB,sBAAsB;AACvC;AACA;AACA;AACA,SAAQ;AACR;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP,OAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;;;AAGH;AACA;;AAEA;;AAEA,mFAAkF;;AAElF,yCAAwC;;AAExC;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,yEAAwE;AACxE;;AAEA;AACA;;AAEA,MAAK;AACL;;AAEA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;;AAEA,YAAW,mBAAmB;AAC9B;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,4BAA2B;AAC3B;AACA;AACA,wBAAuB,kBAAkB;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA;;AAEA,YAAW,oBAAoB;AAC/B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAQ;AACR;AACA;AACA,MAAK;AACL;;AAEA;AACA;AACA;AACA;;AAEA,+BAA8B,8BAA8B;AAC5D;AACA;AACA,MAAK;AACL;AACA;AACA,MAAK;;;AAGL,IAAG;;AAEH;AACA,cAAa,OAAO;AACpB,cAAa,SAAS;AACtB,cAAa,MAAM;AACnB,cAAa,OAAO;AACpB,cAAa,OAAO;AACpB,cAAa,OAAO;AACpB;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,2BAA0B;AAC1B,MAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAA0B;AAC1B,MAAK;AACL;;AAEA;;AAEA,yCAAwC;;AAExC;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,cAAa;AACb;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,eAAc,wBAAwB;AACtC;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,4EAA2E;AAC3E;;AAEA;AACA;;AAEA,SAAQ;AACR;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,cAAa,yBAAyB;AACtC;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA,cAAa,kBAAkB;AAC/B;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA,cAAa,0BAA0B;;AAEvC;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA,cAAa,kBAAkB;AAC/B;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA,kBAAiB,oBAAoB;AACrC;AACA;AACA;;AAEA,cAAa,iBAAiB;AAC9B;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,8BAA6B;AAC7B;AACA;AACA,0BAAyB,kBAAkB;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;;;AAGA,cAAa,oBAAoB;AACjC;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,QAAO;AACP;;AAEA;AACA;AACA;AACA;;AAEA,iCAAgC,8BAA8B;AAC9D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,KAAI;;AAEJ,IAAG;;;AAGH;AACA;AACA;AACA;AACA,gBAAe,eAAe;AAC9B;AACA;AACA;AACA;AACA;AACA,IAAG;;;AAGH;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA,sBAAqB;AACrB,KAAI;;AAEJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA,yCAAwC;;AAExC;AACA,yBAAwB;AACxB;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA,cAAa,gBAAgB;AAC7B;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA,OAAM;;AAEN;;AAEA,kBAAiB,iBAAiB;AAClC;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA,kBAAiB,mBAAmB;;AAEpC;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kDAAiD;AACjD,+BAA8B,yBAAyB;AACvD;AACA;AACA;AACA,aAAY;AACZ;AACA;AACA;;AAEA,SAAQ;;AAER;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,qBAAoB,eAAe;AACnC;AACA,sBAAqB,gBAAgB;AACrC,8BAA6B,6BAA6B;AAC1D;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,KAAI;;AAEJ,IAAG;;;AAGH;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ,IAAG;;;AAGH;;;AAGA;AACA,yCAAwC;AACxC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ,IAAG;;;AAGH;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,MAAK;AACL;;AAEA;;AAEA,gBAAe,gBAAgB;AAC/B;AACA;AACA;AACA;;AAEA;;AAEA;AACA,IAAG;;;AAGH;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA,yCAAwC;;AAExC;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,yBAAwB;AACxB;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA,OAAM;;AAEN;;AAEA;;AAEA;;AAEA,gBAAe,gBAAgB;AAC/B;AACA;AACA;AACA;;AAEA,QAAO;;AAEP,gBAAe,wBAAwB;AACvC,iDAAgD;AAChD,iBAAgB,cAAc;AAC9B;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,QAAO;;AAEP;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA,OAAM;AACN;;AAEA;;AAEA;;AAEA;;AAEA,iBAAgB,iBAAiB;AACjC;AACA;;AAEA;;AAEA;AACA,KAAI;;AAEJ,IAAG;;;AAGH;AACA,gBAAe,WAAW;AAC1B,kBAAiB,WAAW;AAC5B,oBAAmB,WAAW;AAC9B,qBAAoB,WAAW;AAC/B,iBAAgB,WAAW;AAC3B,sBAAqB,WAAW;AAChC,kBAAiB,WAAW;AAC5B,kBAAiB,WAAW;AAC5B,mBAAkB,WAAW;AAC7B,iBAAgB,WAAW;AAC3B,mBAAkB,4BAA4B;AAC9C,mBAAkB,WAAW;AAC7B,mBAAkB,WAAW;AAC7B,kBAAiB,WAAW;AAC5B,mBAAkB,WAAW;AAC7B,iBAAgB,WAAW;AAC3B,mBAAkB,WAAW;AAC7B,sBAAqB,WAAW;AAChC,kBAAiB,WAAW;AAC5B,sBAAqB,WAAW;AAChC,mBAAkB,WAAW;AAC7B,oBAAmB,WAAW;AAC9B,oBAAmB,WAAW;AAC9B,kBAAiB,WAAW;AAC5B,oBAAmB,WAAW;AAC9B,mBAAkB,WAAW;AAC7B,oBAAmB,WAAW;AAC9B,iBAAgB,WAAW;AAC3B,iBAAgB,WAAW;AAC3B,iBAAgB,WAAW;AAC3B,kBAAiB,WAAW;AAC5B,mBAAkB,WAAW;AAC7B,mBAAkB,WAAW;AAC7B,oBAAmB,WAAW;AAC9B,mBAAkB,WAAW;AAC7B,qBAAoB,WAAW;AAC/B,kBAAiB,WAAW;AAC5B,oBAAmB,WAAW;AAC9B,kBAAiB,WAAW;AAC5B,mBAAkB,WAAW;AAC7B,oBAAmB,WAAW;AAC9B,oBAAmB,WAAW;AAC9B,kBAAiB,WAAW;AAC5B,mBAAkB,WAAW;AAC7B,oBAAmB,6BAA6B;AAChD,oBAAmB,WAAW;AAC9B,mBAAkB,WAAW;AAC7B,iBAAgB,WAAW;AAC3B,iBAAgB,WAAW;AAC3B,mBAAkB;AAClB;;;AAGA;AACA;;AAEA,+B;;;;;;;;;ACxzCA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA,GAAE;;AAEF;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,8EAA6E;AAC7E;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,0BAAyB;AACzB;AACA;AACA;;AAEA;;AAEA,cAAa,oBAAoB;AACjC;AACA;AACA;;AAEA;;AAEA;;AAEA,cAAa,mBAAmB;AAChC;AACA;AACA;;AAEA,mCAAkC,KAAK;AACvC;AACA;AACA;AACA;;AAEA;AACA;AACA,KAAI;AACJ;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA,cAAa,sBAAsB;;AAEnC;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA,YAAW,cAAc;AACzB;AACA;AACA;AACA;;AAEA,MAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,GAAE;;AAEF;AACA;;AAEA;;AAEA;AACA;;AAEA;;AAEA,iC;;;;;;;;;ACtPA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA,GAAE;;AAEF;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,8EAA6E;AAC7E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA,iC;;;;;;;;;AC/DA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA,GAAE;;AAEF;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAE;;AAEF;AACA;AACA,8EAA6E;AAC7E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAI;AACJ;AACA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA,iC;;;;;;;;;AC9DA;;AAEA;AACA;AACA;;;AAGA;;;AAGA;AACA;AACA;;;AAGA;AACA,YAAW,OAAO;AAClB,YAAW,eAAe;AAC1B,YAAW,OAAO;AAClB;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA,GAAE;;AAEF,cAAa,+BAA+B;AAC5C;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,KAAI;AACJ;AACA;AACA;;AAEA,OAAM;AACN;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,GAAE;;AAEF;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA","file":"fabula-object-model.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 0f6b4087b1c87c1611f0\n **/","// --------------------------------------------------------------------------------\r\n// Полфил CustomEvents для IE9+\r\n// https://developer.mozilla.org/en-US/docs/Web/API/CustomEvent/CustomEvent\r\n(function () {\r\n\tif ( typeof window.CustomEvent === \"function\" ) return false;\r\n\r\n\tfunction CustomEvent ( event, params ) {\r\n\t\tparams = params || { bubbles: false, cancelable: false, detail: undefined };\r\n\t\tvar evt = document.createEvent( 'CustomEvent' );\r\n\t\tevt.initCustomEvent( event, params.bubbles, params.cancelable, params.detail );\r\n\t\treturn evt;\r\n\t}\r\n\r\n\tCustomEvent.prototype = window.Event.prototype;\r\n\r\n\twindow.CustomEvent = CustomEvent;\r\n})();\r\n\r\n// --------------------------------------------------------------------------------\r\n// FabulaObjectModel\r\n(function(){\r\n\trequire(\"./cascade\");\r\n\tvar dbModel = require(\"./DBModel\");\r\n\tvar F = require(\"./../_FabulaObjectModel\");\r\n\r\n\t// Установка модуля БД для браузера\r\n\tF.prototype._setModule(\"DBModel\", dbModel);\r\n\r\n\tF.globalize = function(){\r\n\t\tvar keys = Object.getOwnPropertyNames(this.prototype);\r\n\t\tfor(var c=0; c<keys.length; c++){\r\n\t\t\twindow[keys[c]] = this.prototype[keys[c]];\r\n\t\t}\r\n\t};\r\n\twindow.FabulaObjectModel = F;\r\n})();\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./fabula-object-model/browser/FabulaObjectModel.js\n ** module id = 0\n ** module chunks = 0\n **/","/**\r\n * Promise.cascade execute promises as separate groups of promises with interval between them.\r\n * It can be useful if you want to set limit\r\n * for simultaneously executing promise functions in one moment of time.\r\n * */\r\n\r\n(function(){\r\n\tif (typeof Promise == \"undefined\") return;\r\n\tif (typeof Promise.cascade != \"undefined\") return;\r\n\r\n\tPromise.cascade = function(promises, options){\r\n\r\n\t\tif (typeof options != \"object\" || typeof options.join == \"functions\") options = Object.create(null);\r\n\r\n\t\t// Interval between stacks\r\n\t\tvar interval = (\r\n\t\t\ttypeof options.interval == \"undefined\"\r\n\t\t\t\t? 0\r\n\t\t\t\t: (\r\n\t\t\t\tisNaN(options.interval)\r\n\t\t\t\t\t? 0\r\n\t\t\t\t\t: parseInt(options.interval)\r\n\t\t\t)\r\n\t\t);\r\n\r\n\t\t/*\r\n\t\t * Number of promises in stack.\r\n\t\t * Promise inside stack proceeds through Promise.all(), parallel.\r\n\t\t * */\r\n\t\tvar stackSize = (\r\n\t\t\ttypeof options.stackSize == \"undefined\"\r\n\t\t\t\t? 1\r\n\t\t\t\t: (\r\n\t\t\t\tisNaN(options.stackSize)\r\n\t\t\t\t\t? 1\r\n\t\t\t\t\t: parseInt(options.stackSize)\r\n\t\t\t)\r\n\t\t);\r\n\r\n\t\t// Objects into Array\r\n\t\tvar tmp = [];\r\n\t\tfor(var prop in promises){\r\n\t\t\tif (!promises.hasOwnProperty(prop)) continue;\r\n\t\t\ttmp.push(promises[prop]);\r\n\t\t}\r\n\t\tpromises = tmp;\r\n\r\n\t\t// Cycled promise function\r\n\t\tvar func = function(resolve, reject){\r\n\t\t\tvar promiseStack = [];\r\n\r\n\t\t\tvar tmp = [], c;\r\n\t\t\tfor (c = 0; c < promises.length; c++) {\r\n\t\t\t\tif (promises[c] === null) continue;\r\n\t\t\t\ttmp.push(promises[c]);\r\n\t\t\t}\r\n\t\t\tpromises = tmp;\r\n\r\n\t\t\tfor (c = 0; c < promises.length; c++) {\r\n\t\t\t\tif (typeof promises[c] == \"function\") promiseStack.push(new Promise(promises[c]));\r\n\r\n\t\t\t\tpromises[c] = null;\r\n\r\n\t\t\t\tif (\r\n\t\t\t\t\tpromiseStack.length >= stackSize\r\n\t\t\t\t\t|| promises.length == (c + 1)\r\n\t\t\t\t) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (!promises.length){\r\n\t\t\t\tresolve();\r\n\t\t\t}\r\n\r\n\t\t\tPromise.all(promiseStack)\r\n\t\t\t.then(\r\n\t\t\t\tfunction () {\r\n\t\t\t\t\tsetTimeout(\r\n\t\t\t\t\t\tfunction () {\r\n\t\t\t\t\t\t\tfunc(resolve,reject);\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tinterval\r\n\t\t\t\t\t)\r\n\t\t\t\t}\r\n\t\t\t)\r\n\t\t\t.catch(\r\n\t\t\t\tfunction(e){\r\n\t\t\t\t\treject(e);\r\n\t\t\t\t}\r\n\t\t\t);\r\n\r\n\t\t};\r\n\r\n\t\treturn new Promise(func);\r\n\r\n\t};\r\n\r\n})();\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./fabula-object-model/browser/cascade.js\n ** module id = 1\n ** module chunks = 0\n **/","var WsObserver = function(arg, dbContext){\r\n\t// this.uid = Math.random() * Math.pow(10,18);\r\n\tthis.callback = typeof arg.callback == \"function\" ? arg.callback : new Function();\r\n\tthis.t0 = new Date();\r\n\r\n\tvar dbreq = JSON.stringify({\r\n\t\t\"query\":\t\targ.query,\r\n\t\t\"format\":\t\"awws\",\r\n\t\t\"dbname\":\targ.dbname,\r\n\t\t\"dbsrc\":\t\targ.dbsrc,\r\n\t\t\"uid\":\t\t\targ.uid\r\n\t});\r\n\r\n\tif (  !dbContext.wsClient.readyState  ){\r\n\t\tdbContext.wsOnOpenArray.push(function(){\r\n\t\t\tdbContext.wsClient.send(dbreq);\r\n\t\t});\r\n\t\treturn;\r\n\t}\r\n\r\n\tdbContext.wsClient.send(dbreq);\r\n};\r\n\r\nvar DBModel = function(A){\r\n\tthis.init(A);\r\n};\r\n\r\nDBModel.prototype = {\r\n\r\n\t\"instances\" : [],\r\n\r\n\r\n\t\"init\" : function(arg){\r\n\t\tif (typeof arg != \"object\") {\r\n\t\t\tthrow new Error(\"1st argument suppose to be Object\");\r\n\t\t}\r\n\r\n\t\t// var self = this;\r\n\r\n\t\tthis.wsObservers = Object.create(null);\r\n\t\tthis.wsClient\t= null;\r\n\t\tthis.wsOnOpenArray = [];\r\n\r\n\t\tthis.dburl \t\t= typeof arg.dburl == \"string\" ? arg.dburl : location.origin + \"/db/\";\t// http://fabula.net.ru/db?\r\n\t\tthis.dbname \t= typeof arg.dbname == \"string\" ? arg.dbname : null;\t\t\t\t// well.2015\r\n\t\tthis.dbsrc \t\t= typeof arg.dbsrc == \"string\" ? arg.dbsrc : null;\t\t\t\t\t\t// main, common, stat\r\n\t\tthis.lastError \t= \"\";\r\n\t\tthis.errors \t\t= [];\r\n\t\tthis.logs\t\t= [];\r\n\r\n\t\t// var parsedURL = new URL(this.dburl);\r\n\r\n\t\tthis._config = {\r\n\t\t\t\"ws:console:writeResponseMessage\": 0\r\n\t\t};\r\n\r\n\t\tif (  this.dburl.match(/^ws:\\/\\//g)  ){\r\n\t\t\tif (typeof WebSocket != \"function\"){\r\n\t\t\t\tthrow new Error(\"!WebSocket\");\r\n\t\t\t}\r\n\t\t\tthis.wsClient = new WebSocket(this.dburl);\r\n\t\t\tthis.wsClient.onmessage = this._wsOnMessage.bind(this);\r\n\t\t\tthis.wsClient.onerror = this._wsOnError;\r\n\t\t\tthis.wsClient.onopen = this._wsOnOpen.bind(this);\r\n\t\t}\r\n\r\n\t\tthis.instances.push(this);\r\n\t},\r\n\r\n\r\n\t\"_wsOnOpen\": function(){\r\n\t\tfor(var c=0; c<this.wsOnOpenArray.length; c++){\r\n\t\t\tthis.wsOnOpenArray[c]();\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t\"_wsOnMessage\": function(msg){\r\n\t\tvar msgData = JSON.parse(msg.data);\r\n\r\n\t\tif (  typeof this.wsObservers[msgData.uid] == \"undefined\"  ) {\r\n\t\t\tthrow new Error(\"!wsObserver\");\r\n\t\t}\r\n\r\n\t\tif (typeof this.wsObservers[msgData.uid].callback != \"function\"){\r\n\t\t\tthrow new Error(\"!wsObserver.callback\");\r\n\t\t}\r\n\r\n\t\tthis.wsObservers[msgData.uid].callback(msgData.dbres);\r\n\r\n\t\tconsole.log(\r\n\t\t\t(new Date() - this.wsObservers[msgData.uid].t0) / 1000,\r\n\t\t\t(this._config[\"ws:console:writeResponseMessage\"] ? msg : void 0)\r\n\t\t);\r\n\r\n\t\tdelete this.wsObservers[msgData.uid];\r\n\t},\r\n\r\n\r\n\t\"_wsOnError\": function(err){\r\n\t\tthrow err;\r\n\t},\r\n\r\n\r\n\t\"getInstance\" : function(arg){\r\n\t\tif (typeof arg != \"object\"){\r\n\t\t\treturn this.instances.length ? this.instances[0] : new DBModel(void 0);\r\n\t\t}\r\n\t\tfor(var c=0; c<this.instances.length; c++){\r\n\t\t\tif (\r\n\t\t\t\ttypeof arg.dburl == \"string\"\r\n\t\t\t\t&& this.instances[c].dburl != arg.dburl\r\n\t\t\t){\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif (\r\n\t\t\t\ttypeof arg.dbname == \"string\"\r\n\t\t\t\t&& this.instances[c].dbname != arg.dbname\r\n\t\t\t){\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif (\r\n\t\t\t\ttypeof arg.dbsrc == \"string\"\r\n\t\t\t\t&& this.instances[c].dbsrc != arg.dbsrc\r\n\t\t\t){\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\treturn this.instances[c];\r\n\t\t}\r\n\t\treturn new DBModel(arg);\r\n\t},\r\n\r\n\r\n\t\"_convert\": function(dbres){\r\n\t\tvar responses = [];\r\n\t\tvar c, v, b, row, col, colname;\r\n\r\n\t\tif (  !Array.isArray(dbres)  ){\r\n\t\t\tdbres = [dbres];\r\n\t\t}\r\n\r\n\t\tfor (c=0; c<dbres.length; c++) {\r\n\t\t\tvar response = {\r\n\t\t\t\t\"info\" : {\r\n\t\t\t\t\t\"t\" : -1,\r\n\t\t\t\t\t\"t_fx\" : -1,\r\n\t\t\t\t\t\"t_fabula\" : dbres[c]['t'],\r\n\t\t\t\t\t\"t_jsDecode\" : -1,\r\n\t\t\t\t\t\"num_rows\" : dbres[c]['res'].length,\r\n\t\t\t\t\t\"errors\" : dbres[c]['err']\r\n\t\t\t\t},\r\n\t\t\t\t\"recs\" : []\r\n\t\t\t};\r\n\r\n\t\t\tfor (v=0; v<dbres[c]['res'].length; v++){\r\n\t\t\t\trow = dbres[c]['res'][v];\r\n\r\n\t\t\t\tvar row_ = {};\r\n\r\n\t\t\t\tfor (b=0; b<row.length; b++){\r\n\t\t\t\t\tcol = row[b];\r\n\t\t\t\t\tcolname = dbres[c]['fld'][b]['Name'];\r\n\t\t\t\t\trow_[colname] = col;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tresponse.recs.push(row_);\r\n\t\t\t}\r\n\r\n\t\t\tresponses.push(response);\r\n\t\t}\r\n\r\n\t\treturn responses.length == 1 ? responses[0] : responses;\r\n\t},\r\n\r\n\r\n\t\"_dbquery_ws\": function(arg){\r\n\r\n\t\tif (typeof arg != \"object\"){\r\n\t\t\tthrow new Error(\"1st argument suppose to be Object\");\r\n\t\t}\r\n\r\n\t\tif (typeof arg.query != \"string\"){\r\n\t\t\tthrow new Error(\"arg.query suppose to be String\");\r\n\t\t}\r\n\r\n\t\tvar self = this;\r\n\r\n\t\targ.uid = Math.random() * Math.pow(10, 18);\r\n\r\n\t\tif ( typeof arg.callback == \"function\"  ){\r\n\t\t\tvar callback = arg.callback;\r\n\t\t\targ.callback = function(dbres){\r\n\t\t\t\tcallback(self._convert(dbres));\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tthis.wsObservers[arg.uid] = new WsObserver(arg, this);\r\n\t},\r\n\r\n\r\n\t\"_dbquery_http\": function(arg){\r\n\t\tvar self\t\t\t\t= this;\r\n\t\tvar dbquery\t\t= typeof arg.query == \"string\" ? arg.query : null;\r\n\t\tvar dburl\t\t\t= typeof arg.dburl == \"string\" ? arg.dburl : this.dburl;\r\n\t\tvar dbname\t\t= typeof arg.dbname == \"string\" ? arg.dbname : this.dbname;\r\n\t\tvar dbsrc\t\t\t= typeof arg.dbsrc == \"string\" ? arg.dbsrc : this.dbsrc;\r\n\t\tvar callback\t\t= typeof arg.callback == \"function\" ? arg.callback : new Function();\r\n\r\n\t\tvar http = new XMLHttpRequest();\r\n\t\thttp.open(\"POST\",dburl, true);\r\n\t\thttp.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');\r\n\r\n\t\t// --------------------------------------------------------\r\n\r\n\t\thttp.onreadystatechange = function(){\r\n\t\t\tif (  this.readyState == 4  ){\r\n\t\t\t\tvar dbres = {\r\n\t\t\t\t\t\"err\": \"\",\r\n\t\t\t\t\t\"t\": 0,\r\n\t\t\t\t\t\"recs\": 0,\r\n\t\t\t\t\t\"fld\": [],\r\n\t\t\t\t\t\"res\": []\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif (  this.status != 200  ){\r\n\t\t\t\t\tdbres.err = \"status != 200\"\r\n\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdbres = JSON.parse(this.responseText);\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcallback(self._convert(dbres));\r\n\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t// --------------------------------------------------------\r\n\r\n\t\tvar form = [\r\n\t\t\t\"query=\" + encodeURIComponent(dbquery),\r\n\t\t\t\"dbsrc=\" + encodeURIComponent(!dbsrc ? \"\" : dbsrc),\r\n\t\t\t\"dbname=\" + encodeURIComponent(!dbname ? \"\" : dbname),\r\n\t\t\t\"format=\" + encodeURIComponent(\"awws\")\r\n\t\t];\r\n\r\n\t\tform = form.join(\"&\");\r\n\r\n\t\thttp.send(form);\r\n\t},\r\n\r\n\r\n\t\"dbquery\" : function(arg){\r\n\t\tif (typeof arg == \"undefined\") arg = Object.create(null);\r\n\t\tvar dbquery\t\t= typeof arg.query == \"string\" ? arg.query : null;\r\n\t\tvar callback\t\t= typeof arg.callback == \"function\" ? arg.callback : new Function();\r\n\r\n\t\tif (  !dbquery  ){\r\n\t\t\tcallback({\r\n\t\t\t\t\"info\":{\r\n\t\t\t\t\t\"errors\": [\"!dbquery\"],\r\n\t\t\t\t\t\"num_rows\": 0\r\n\t\t\t\t},\r\n\t\t\t\t\"recs\": []\r\n\t\t\t});\r\n\t\t\tthrow new Error(\"!dbquery\");\r\n\t\t}\r\n\r\n\t\t// --------------------------------------------------------\r\n\t\t// История запросов\r\n\t\tif (this.logs.length > 50) this.logs = [];\r\n\t\tthis.logs.push(dbquery);\r\n\r\n\t\t// --------------------------------------------------------\r\n\t\t// http или webSocket\r\n\t\tif (  this.wsClient  ){\r\n\t\t\tthis._dbquery_ws.apply(this, arguments);\r\n\r\n\t\t} else {\r\n\t\t\tthis._dbquery_http.apply(this, arguments);\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n};\r\n\r\nmodule.exports = DBModel;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./fabula-object-model/browser/DBModel.js\n ** module id = 2\n ** module chunks = 0\n **/","\r\nvar FabulaObjModel = function(arg){\r\n\tthis._dbInstance = this.mod.DBModel.prototype.getInstance(arg);\r\n\tthis.instances.push(this);\r\n};\r\n\r\n// ------------------------------------------------------------------------\r\n\r\nFabulaObjModel.prototype = {};\r\n\r\nFabulaObjModel.prototype.mod = Object.create(null);\r\n\r\nFabulaObjModel.prototype._lowMethods = Object.create(null);\r\n\r\n// ------------------------------------------------------------------------\r\n\r\n/**\r\n * @param {String} name\r\n * @param {Object | Function} _module\r\n * */\r\nFabulaObjModel.prototype._setModule = function(name, _module){\r\n\tif (typeof name != \"string\"){\r\n\t\tthrow new Error(\"1st argument suppose to be String\");\r\n\t}\r\n\tname = name.trim();\r\n\tthis.mod[name] = _module;\r\n\tthis._lowMethods[name.toLowerCase()] = _module;\r\n};\r\n\r\n// ------------------------------------------------------------------------\r\n\r\nFabulaObjModel.prototype._setModule(\"AgentsDataModel\", require(\"./data-models/AgentsDataModel\"));\r\n\r\nFabulaObjModel.prototype._setModule(\"DataModelAdapters\", require(\"./data-models/DataModelAdapters\"));\r\n\r\nFabulaObjModel.prototype._setModule(\"DefaultDataModel\", require(\"./data-models/DefaultDataModel\"));\r\n\r\nFabulaObjModel.prototype._setModule(\"DocDataModel\", require(\"./data-models/DocDataModel\"));\r\n\r\nFabulaObjModel.prototype._setModule(\"FirmsDataModel\", require(\"./data-models/FirmsDataModel\"));\r\n\r\nFabulaObjModel.prototype._setModule(\"GandsDataModel\", require(\"./data-models/GandsDataModel\"));\r\n\r\nFabulaObjModel.prototype._setModule(\"InterfaceEvents\", require(\"./data-models/InterfaceEvents\"));\r\n\r\nFabulaObjModel.prototype._setModule(\"InterfaceFProperty\", require(\"./data-models/InterfaceFProperty\"));\r\n\r\nFabulaObjModel.prototype._setModule(\"MovDataModel\t\", require(\"./data-models/MovDataModel\"));\r\n\r\nFabulaObjModel.prototype._setModule(\"PathsDataModel\", require(\"./data-models/PathsDataModel\"));\r\n\r\nFabulaObjModel.prototype._setModule(\"TalksDataModel\",  require(\"./data-models/TalksDataModel\"));\r\n\r\nFabulaObjModel.prototype._setModule(\"CalcDefaultPrint\",  require(\"./data-models/calc/DefaultPrintCalc\"));\r\n\r\nFabulaObjModel.prototype._setModule(\"utils\", require(\"./utils\"));\r\n\r\nFabulaObjModel.prototype._setModule(\"ObjectA\", require(\"./data-models/ObjectA\"));\r\n\r\nFabulaObjModel.prototype._setModule(\"DBModel\", null);\r\n\r\n// ------------------------------------------------------------------------\r\n\r\n/**\r\n * @param {String} name\r\n * @param {Array} arg\r\n * @return {Object}\r\n * */\r\nFabulaObjModel.prototype.create = function(name, arg){\r\n\tif (typeof name != \"string\"){\r\n\t\tthrow new Error(\"1st argument suppose to be String\");\r\n\t}\r\n\r\n\tname = name.toLowerCase().trim();\r\n\r\n\tif (typeof this._lowMethods[name] == \"undefined\"){\r\n\t\tthrow new Error(\"Class \\\"\" + name + \"\\\" does not exist\");\r\n\t}\r\n\r\n\t// var rest = utils.arrayRest(arguments, 1);\r\n\t// TODO передать ...rest в конструктор. Например через bind\r\n\tvar method = this._lowMethods[name];\r\n\tvar obj;\r\n\tvar type = this.mod.utils.getType(method);\r\n\r\n\tif (  type == \"object\"  ) {\r\n\t\tobj = method;\r\n\r\n\t} else if (type == \"function\") {\r\n\t\tif (  typeof method.prototype.getInstance == \"function\"  ){\r\n\t\t\tobj = method.prototype.getInstance();\r\n\r\n\t\t} else {\r\n\t\t\tobj = new method();\r\n\r\n\t\t}\r\n\t}\r\n\r\n\tif (obj) obj._fabulaInstance = this;\r\n\r\n\treturn obj;\r\n};\r\n\r\n// ------------------------------------------------------------------------\r\n\r\nFabulaObjModel.prototype.getDBInstance = function(){\r\n\treturn this._dbInstance;\r\n};\r\n\r\n// ------------------------------------------------------------------------\r\n\r\nFabulaObjModel.prototype.instances = [];\r\n\r\n// ------------------------------------------------------------------------\r\n\r\nFabulaObjModel.prototype.getInstance = function(arg){\r\n\treturn this.instances.length ? this.instances[0] : new FabulaObjModel(arg);\r\n};\r\n\r\n// ------------------------------------------------------------------------\r\n\r\nmodule.exports = FabulaObjModel;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./fabula-object-model/_FabulaObjectModel.js\n ** module id = 3\n ** module chunks = 0\n **/","// ------------------------------------------------------\r\n// Данные из базы об агентах\r\n\r\n// Для совместимости\r\nvar getContextDB = function(){\r\n\tvar FabulaObjectModel = require(\"./../_FabulaObjectModel.js\");\r\n\tvar DBModel = FabulaObjectModel.prototype.DBModel;\r\n\r\n\tif (  this._fabulaInstance ){\r\n\t\treturn this._fabulaInstance.getDBInstance();\r\n\t}\r\n\treturn DBModel.prototype.getInstance();\r\n};\r\n\r\nvar AgentsDataModel = function(){\r\n\tthis.init();\r\n};\r\n\r\nAgentsDataModel.prototype = {\r\n\t\"init\" : function(){\r\n\r\n\t\tthis.dbModel = null;\r\n\r\n\t\tthis.data = [];\r\n\r\n\t\tthis.instances.push(this);\r\n\r\n\t\tthis.state = 0;\r\n\r\n\t},\r\n\r\n\t\"instances\" : [],\r\n\r\n\t\"getInstance\" : function(){\r\n\t\tif (this.instances.length){\r\n\t\t\treturn this.instances[0];\r\n\t\t}\r\n\t\treturn new AgentsDataModel();\r\n\t},\r\n\r\n\t\"load\" : function(A){\r\n\t\tif (typeof A == \"undefined\") A = Object.create(null);\r\n\t\tvar callback = (typeof A.callback == \"function\" ? A.callback : function(){} );\r\n\t\tvar db = getContextDB.call(this);\r\n\t\tvar self = this;\r\n\t\tif (db){\r\n\t\t\tdb.dbquery({\r\n\t\t\t\t\"query\" : \"SELECT AgentID, FIO, NameShort, NameFull, User FROM Agents\",\r\n\t\t\t\t\"callback\" : function(res){\r\n\t\t\t\t\tself.data = res.recs;\r\n\t\t\t\t\tself.state = 1;\r\n\t\t\t\t\tcallback(self.data);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\r\n\t\"get\" : function(){\r\n\t\treturn this.data;\r\n\t}\r\n};\r\n\r\nmodule.exports = AgentsDataModel;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./fabula-object-model/data-models/AgentsDataModel.js\n ** module id = 4\n ** module chunks = 0\n **/","var _utils = require(\"./../utils\");\r\nvar MovDataModel = require(\"./MovDataModel\");\r\nvar DocDataModel = require (\"./DocDataModel\");\r\nvar GandsDataModel = require(\"./GandsDataModel\");\r\n\r\nvar gandsInstance = GandsDataModel.prototype.getInstance();\r\n\r\n/**\r\n * Это настолько Адаптеры что, кто-то назовет их Декораторы\r\n * От декораторов:\r\n * - расширяют фунционал объектов наследующих методы интерфейса \"InterfaceFProperty\"\r\n *   - возможность выбирать, удалять, обновлять свойства собственных, родительской и подчиненных задач.\r\n *\r\n * От адаптеров:\r\n * - удобный интерфейс для работы с рядом свойств обьектов\r\n *     - Свойство заявки \"Примечание\"\r\n *         - adapter.getNote()\r\n *         - adapter.setNote({string} note)\r\n *\r\n *     - Свойство задачи \"Комментарий\"\r\n *         - adapter.getComment();\r\n *         - adapter.setComment({String} comment)\r\n *\r\n *  - Получение валовой суммы по задачам в заявке // adapter.getGrossSum()\r\n */\r\nvar Adapters = Object.create(null);\r\n\r\n// -----------------------------------------------------------------------------\r\n\r\nAdapters._getProperty = function(ownKeyValue, parentKeyValue, childrenKeyValue){\r\n\tvar props = [], obj;\r\n\r\n\tfor(var c=0; c<arguments.length; c++){\r\n\t\tif (typeof arguments[c] != \"object\" || !arguments[c]) continue;\r\n\r\n\t\tif (!c){\r\n\t\t\tobj = this._getSelfObj();\r\n\r\n\t\t} else if (c==1) {\r\n\t\t\tobj = this._getParentObj();\r\n\r\n\t\t} else if (c==2) {\r\n\t\t\tobj = this._getChildrenObj();\r\n\r\n\t\t} else {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\r\n\t\tif (!obj) continue;\r\n\r\n\t\tif (!Array.isArray(obj)) obj = [obj];\r\n\r\n\t\tfor(var v=0; v<obj.length; v++){\r\n\t\t\tprops = props.concat(obj[v].getProperty(arguments[c]));\r\n\t\t}\r\n\r\n\t\tif (c==2) break;\r\n\t}\r\n\r\n\treturn props;\r\n};\r\n\r\nAdapters._updateProperty = function(\r\n\townGetKeyValue,\r\n\townSetKeyValue,\r\n\tparentGetKeyValue,\r\n\tparentSetKeyValue,\r\n\tchildrenGetKeyValue,\r\n\tchildrenSetKeyValue\r\n){\r\n\tvar obj, isUpdated = 0;\r\n\r\n\tfor(var c=0; c<arguments.length; c++){\r\n\t\tif (typeof arguments[c] != \"object\" || !arguments[c]) continue;\r\n\r\n\t\tif (!c){\r\n\t\t\tobj = this._getSelfObj();\r\n\r\n\t\t} else if (c==2) {\r\n\t\t\tobj = this._getParentObj();\r\n\r\n\t\t} else if (c==4) {\r\n\t\t\tobj = this._getChildrenObj();\r\n\r\n\t\t} else {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\r\n\t\tif (!obj) continue;\r\n\r\n\t\tif (!Array.isArray(obj)) obj = [obj];\r\n\r\n\t\tfor(var v=0; v<obj.length; v++){\r\n\t\t\tisUpdated += obj[v].updateProperty(arguments[c], arguments[c+1]);\r\n\t\t}\r\n\r\n\t\tif (c==5) break;\r\n\t}\r\n\r\n\treturn isUpdated > 0;\r\n\r\n};\r\n\r\nAdapters._upsertProperty = function(\r\n\townGetKeyValue,\r\n\townSetKeyValue,\r\n\tparentGetKeyValue,\r\n\tparentSetKeyValue,\r\n\tchildrenGetKeyValue,\r\n\tchildrenSetKeyValue\r\n){\r\n\tvar obj, insProperty, isUpdated = 0;\r\n\r\n\tfor(var c=0; c<arguments.length; c++){\r\n\t\tif (typeof arguments[c] != \"object\" || !arguments[c]) continue;\r\n\r\n\t\tif (!c){\r\n\t\t\tobj = this._getSelfObj();\r\n\r\n\t\t} else if (c==2) {\r\n\t\t\tobj = this._getParentObj();\r\n\r\n\t\t} else if (c==4) {\r\n\t\t\tobj = this._getChildrenObj();\r\n\r\n\t\t} else {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\r\n\t\tif (!obj) continue;\r\n\r\n\t\tif (!Array.isArray(obj)) obj = [obj];\r\n\r\n\t\tfor(var v=0; v<obj.length; v++){\r\n\r\n\t\t\tinsProperty = _utils.objectKeysToLowerCase(arguments[c+1]);\r\n\r\n\t\t\tif (\r\n\t\t\t\t!insProperty.hasOwnProperty(\"pid\")\r\n\t\t\t\t|| typeof insProperty.pid == \"undefined\"\r\n\t\t\t\t|| insProperty.pid === null\r\n\t\t\t\t|| insProperty.pid === \"\"\r\n\t\t\t){\r\n\t\t\t\tif (  obj[v] instanceof MovDataModel  ){\r\n\t\t\t\t\tinsProperty.pid = obj[v].get(\"MMID\");\r\n\r\n\t\t\t\t} else if (  obj[v] instanceof DocDataModel  ) {\r\n\t\t\t\t\tinsProperty.pid = 0;\r\n\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tisUpdated += obj[v].upsertProperty(arguments[c], insProperty);\r\n\t\t}\r\n\r\n\t\tif (c==5) break;\r\n\t}\r\n\r\n\treturn isUpdated > 0;\r\n\r\n};\r\n\r\nAdapters._deleteProperty = function(ownKeyValue, parentKeyValue, childrenKeyValue){\r\n\tvar obj, isDeleted = 0;\r\n\r\n\tfor(var c=0; c<arguments.length; c++){\r\n\t\tif (typeof arguments[c] != \"object\" || !arguments[c]) continue;\r\n\r\n\t\tif (!c){\r\n\t\t\tobj = this._getSelfObj();\r\n\r\n\t\t} else if (c==1) {\r\n\t\t\tobj = this._getParentObj();\r\n\r\n\t\t} else if (c==2) {\r\n\t\t\tobj = this._getChildrenObj();\r\n\r\n\t\t} else {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\r\n\t\tif (!obj) continue;\r\n\r\n\t\tif (!Array.isArray(obj)) obj = [obj];\r\n\r\n\t\tfor(var v=0; v<obj.length; v++){\r\n\t\t\tisDeleted += obj[v].deleteProperty(arguments[c]);\r\n\t\t}\r\n\r\n\t\tif (c==2) break;\r\n\t}\r\n\r\n\treturn isDeleted > 0;\r\n};\r\n\r\nAdapters._addProperty = function(ownProperty, parentProperty, childrenProperty){\r\n\tvar obj, c, v, insProperty;\r\n\r\n\tfor(c=0; c<arguments.length; c++){\r\n\t\tif (typeof arguments[c] != \"object\" || !arguments[c]) continue;\r\n\r\n\t\tif (!c){\r\n\t\t\tobj = this._getSelfObj();\r\n\r\n\t\t} else if (c==1) {\r\n\t\t\tobj = this._getParentObj();\r\n\r\n\t\t} else if (c==2) {\r\n\t\t\tobj = this._getChildrenObj();\r\n\r\n\t\t} else {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\r\n\t\tif (!obj) continue;\r\n\r\n\t\tif (!Array.isArray(obj)) obj = [obj];\r\n\r\n\t\tfor(v=0; v<obj.length; v++){\r\n\r\n\t\t\tinsProperty = _utils.objectKeysToLowerCase(arguments[c]);\r\n\r\n\t\t\tif (\r\n\t\t\t\t!insProperty.hasOwnProperty(\"pid\")\r\n\t\t\t\t|| typeof insProperty.pid == \"undefined\"\r\n\t\t\t\t|| insProperty.pid === null\r\n\t\t\t\t|| insProperty.pid === \"\"\r\n\t\t\t){\r\n\t\t\t\tif (  obj[v] instanceof MovDataModel  ){\r\n\t\t\t\t\tinsProperty.pid = obj[v].get(\"MMID\");\r\n\r\n\t\t\t\t} else if (  obj[v] instanceof DocDataModel  ) {\r\n\t\t\t\t\tinsProperty.pid = 0;\r\n\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tobj[v].addProperty(insProperty);\r\n\r\n\t\t}\r\n\r\n\t\tif (c==2) break;\r\n\t}\r\n\r\n};\r\n\r\n/**\r\n * @return {Array}\r\n * // @param {Object} ownKeyValue\r\n * // @param {Object} parentKeyValue\r\n * // @param {Object} childrenKeyValue\r\n * */\r\nAdapters._getPropertyValue = function(){\r\n\tvar tmp = this.getProperty.apply(this, arguments);\r\n\tfor(var c=0; c<tmp.length; c++){\r\n\t\ttmp[c] = tmp[c].value;\r\n\t}\r\n\treturn tmp;\r\n};\r\n\r\n// -----------------------------------------------------------------------------\r\n// -----------------------------------------------------------------------------\r\n\r\nAdapters.MovTaskAdapter = function(mov){\r\n\tif (!arguments.length){\r\n\t\tthrow new Error(\"arguments.length == 0\");\r\n\t}\r\n\r\n\tif (mov instanceof MovDataModel === false){\r\n\t\tthrow new Error(\"1st argument suppose to be \\\"MovDataModel\\\"\");\r\n\t}\r\n\r\n\tthis.mov = mov;\r\n\r\n};\r\n\r\nAdapters.MovTaskAdapter.prototype = {\r\n\r\n\t\"getProperty\": Adapters._getProperty,\r\n\r\n\t\"updateProperty\": Adapters._updateProperty,\r\n\r\n\t\"upsertProperty\": Adapters._upsertProperty,\r\n\r\n\t\"getPropertyValue\": Adapters._getPropertyValue,\r\n\r\n\t\"addProperty\": Adapters._addProperty,\r\n\r\n\t\"deleteProperty\": Adapters._deleteProperty,\r\n\r\n\t\"_getSelfObj\": function(){\r\n\t\treturn this.mov;\r\n\t},\r\n\r\n\t\"_getParentObj\": function(){\r\n\t\treturn this.mov.parentMov;\r\n\t},\r\n\r\n\t\"_getChildrenObj\": function(){\r\n\t\treturn this.mov.childrenMovs;\r\n\t},\r\n\r\n\t\"getCuttingTemplates\": function(){\r\n\t\tvar props = [], c;\r\n\t\tvar gandsPostprocCutting = gandsInstance.get({\"type\":[\"postproc:cutting\"]});\r\n\t\tfor(c=0; c<gandsPostprocCutting.length; c++){\r\n\t\t\tgandsPostprocCutting[c] = gandsPostprocCutting[c].GSID.toLowerCase();\r\n\t\t}\r\n\t\tvar children = this.mov.childrenMovs;\r\n\t\tfor(c=0; c<children.length; c++){\r\n\t\t\tif (!children[c]) continue;\r\n\t\t\tif (typeof children[c] != \"object\") continue;\r\n\t\t\tif (  gandsPostprocCutting.indexOf(children[c].get(\"GS\").toLowerCase()) == -1  ) continue;\r\n\t\t\tprops = props.concat(children[c].getProperty({\"Property\": \"Макет исходящий\"}));\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\treturn props;\r\n\t},\r\n\r\n\t\"setCuttingTemplates\": function(templates){\r\n\t\tvar c, template_, templates_ = [];\r\n\r\n\t\tif (typeof templates == \"string\"){\r\n\t\t\ttemplates = [templates];\r\n\t\t}\r\n\r\n\t\tif (   Array.isArray(templates)  ){\r\n\t\t\tfor(c=0; c<templates.length; c++){\r\n\t\t\t\tif (  typeof templates[c] == \"string\"  ){\r\n\t\t\t\t\ttemplates_.push({\r\n\t\t\t\t\t\t\"value\": templates[c],\r\n\t\t\t\t\t\t\"property\":\"Макет исходящий\"\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t} else if (  typeof templates[c] == \"object\"  ) {\r\n\t\t\t\t\ttemplate_ = _utils.objectKeysToLowerCase(templates[c]);\r\n\t\t\t\t\tif (  !template_.hasOwnProperty(\"value\") || !template_.value  ) continue;\r\n\t\t\t\t\ttemplate_.property = \"Макет исходящий\";\r\n\t\t\t\t\ttemplates_.push(template_);\r\n\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\t\t\tthrow new Error(\"argument suppose to be String or Array type\");\r\n\t\t}\r\n\r\n\t\t// .......................................................\r\n\r\n\t\tvar gandsPostprocCutting = gandsInstance.get({\"type\":[\"postproc:cutting\"]});\r\n\t\tfor(c=0; c<gandsPostprocCutting.length; c++){\r\n\t\t\tgandsPostprocCutting[c] = gandsPostprocCutting[c].GSID.toLowerCase();\r\n\t\t}\r\n\r\n\t\t// .......................................................\r\n\r\n\t\tvar children = this.mov.childrenMovs;\r\n\r\n\t\tvar isChanged = false;\r\n\r\n\t\tfor(c=0; c<children.length; c++){\r\n\t\t\tif (!children[c]) continue;\r\n\t\t\tif (typeof children[c] != \"object\" || !children[c]) continue;\r\n\t\t\tif (  gandsPostprocCutting.indexOf(children[c].get(\"GS\").toLowerCase()) == -1  ) continue;\r\n\t\t\tchildren[c].deleteProperty({\"Property\":\"Макет исходящий\"});\r\n\t\t\tchildren[c].addProperty(templates_);\r\n\t\t\tisChanged = true;\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\treturn isChanged;\r\n\t},\r\n\r\n\t\"getComments\": function(){\r\n\t\treturn this.getPropertyValue({\"Property\":\"Комментарий\"});\r\n\t},\r\n\r\n\t\"setComment\": function(comment){\r\n\t\tif (typeof comment != \"string\"){\r\n\t\t\tthrow new Error(\"type != \\\"String\\\"\");\r\n\t\t}\r\n\r\n\t\tthis.mov.removeProperty({\"Property\": \"Комментарий\"});\r\n\r\n\t\tif (  comment.trim()  ){\r\n\t\t\tthis.mov.addProperty(\r\n\t\t\t\tthis.mov.splitProperty({\"Property\":\"Комментарий\",\"value\":comment})\r\n\t\t\t);\r\n\t\t}\r\n\t},\r\n\r\n\t\"setPostproc\": function(postproc){\r\n\r\n\t\tvar mov = this._getSelfObj();\r\n\t\tvar child, c;\r\n\t\tvar postproc_ = [];\r\n\r\n\t\tfor(c=0; c<postproc.length; c++){\r\n\t\t\tif (typeof postproc[c] != \"object\" || !postproc[c]) continue;\r\n\r\n\t\t\tchild = mov.getCMov({\"mmid\":postproc[c].mmid});\r\n\r\n\t\t\tif (!child.length || !postproc[c].mmid){\r\n\t\t\t\tchild = new MovDataModel();\r\n\t\t\t\tmov.addChildMov(child);\r\n\t\t\t} else {\r\n\t\t\t\tchild = child[0];\r\n\t\t\t}\r\n\r\n\t\t\tchild.set(postproc[c]);\r\n\r\n\t\t\tpostproc_.push(child.get(\"MMID\"));\r\n\r\n\t\t}\r\n\r\n\t\tvar movs = mov.getCMov();\r\n\r\n\t\tfor(c=0; c<movs.length; c++){\r\n\t\t\tif (  !movs[c].get(\"MMID\")  ) continue;\r\n\t\t\tif (  postproc_.indexOf(movs[c].get(\"MMID\")) == -1  ){\r\n\t\t\t\tmov.removeCMov(movs[c]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t},\r\n\r\n\t\"getPostprocMov\": function(){\r\n\t\t// COP07 - КОП \"работы\"\r\n\t\tvar gandsPostproc = gandsInstance.get({\r\n\t\t\t\"cop\": [\r\n\t\t\t\tnew RegExp(\"07\",\"gi\")\r\n\t\t\t]\r\n\t\t});\r\n\r\n\t\tvar c, tmp, postproc = [], gandsPostproc_ = [];\r\n\t\tfor(c=0; c<gandsPostproc.length; c++){\r\n\t\t\tgandsPostproc_[c] = gandsPostproc[c].GSID.toLowerCase();\r\n\t\t}\r\n\t\tvar movs = this.mov.childrenMovs;\r\n\t\tfor(c=0; c<movs.length; c++){\r\n\t\t\ttmp = movs[c].get(\"GS\");\r\n\t\t\tif (typeof tmp != \"string\") continue;\r\n\t\t\ttmp = tmp.toLowerCase();\r\n\t\t\tif (  gandsPostproc_.indexOf(tmp) == -1  ) continue;\r\n\t\t\tpostproc.push(movs[c]);\r\n\t\t}\r\n\t\treturn postproc;\r\n\t},\r\n\r\n\t\"getPostprocObject\": function(){\r\n\t\tvar pp = this.getPostprocMov();\r\n\t\tfor(var c=0; c<pp.length; c++){\r\n\t\t\tpp[c] = pp[c].getJSON();\r\n\t\t}\r\n\t\treturn pp;\r\n\t}\r\n};\r\n\r\n// -----------------------------------------------------------------------------\r\n// -----------------------------------------------------------------------------\r\n\r\nAdapters.DocAdapter = function(doc){\r\n\tif (!arguments.length){\r\n\t\tthrow new Error(\"!arguments.length\");\r\n\t}\r\n\tif (  doc instanceof DocDataModel === false ){\r\n\t\tthrow new Error(\"1st argument suppose to be \\\"DocDataModel\\\"\");\r\n\t}\r\n\tthis.doc = doc;\r\n};\r\n\r\nAdapters.DocAdapter.prototype = {\r\n\r\n\t\"getPropertyValue\": Adapters._getPropertyValue,\r\n\r\n\t\"_getSelfObj\": function(){\r\n\t\treturn this.doc;\r\n\t},\r\n\r\n\t\"_getParentObj\": function(){\r\n\t\treturn null;\r\n\t},\r\n\r\n\t\"_getChildrenObj\": function(){\r\n\t\treturn null;\r\n\t},\r\n\r\n\t\"getProperty\": Adapters._getProperty,\r\n\r\n\t\"addProperty\": Adapters._addProperty,\r\n\r\n\t\"deleteProperty\": Adapters._deleteProperty,\r\n\r\n\t\"getGrossSum\": function(){\r\n\t\tvar movs = this.doc.movs;\r\n\t\tvar sum = 0;\r\n\t\tfor(var c=0; c<movs.length; c++){\r\n\t\t\tsum += movs[c].get(\"Sum\");\r\n\t\t}\r\n\t\treturn sum;\r\n\t},\r\n\r\n\t\"getNote\": function(){\r\n\t\treturn this.getPropertyValue({\"Property\":\"Примечание\"});\r\n\t},\r\n\r\n\t\"setNote\": function(note){\r\n\t\tif (typeof note != \"string\"){\r\n\t\t\tthrow new Error(\"type != \\\"String\\\"\");\r\n\t\t}\r\n\r\n\t\tthis.doc.removeProperty({\"Property\": \"Примечание\"});\r\n\r\n\t\tif (note.trim()){\r\n\t\t\tthis.doc.addProperty(\r\n\t\t\t\tthis.doc.splitProperty({\"Property\":\"Примечание\",\"value\":note})\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n};\r\n\r\nmodule.exports = Adapters;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./fabula-object-model/data-models/DataModelAdapters.js\n ** module id = 5\n ** module chunks = 0\n **/","var _utils = Object.create(null);\r\n\r\n_utils.DBSecureStr = function(str){\r\n\tif (!arguments.length) return;\r\n\tif (typeof str != \"string\") return str;\r\n\tvar a = [\r\n\t\t[new RegExp(/[\"']/g),\"\"],\r\n\t\t[\"№\",\"N\"]\r\n\t];\r\n\tfor(var c=0; c< a.length; c++){\r\n\t\tstr = str.replace(\r\n\t\t\ta[c][0],\r\n\t\t\ta[c][1]\r\n\t\t);\r\n\t}\r\n\treturn str;\r\n};\r\n\r\n/**\r\n * @param {Array} d Delimiters\"\r\n * @param {String} s - String\r\n * @return Array\r\n * */\r\n_utils.msplit = function(d,s){\r\n\tif (  typeof d == \"string\"  ){\r\n\t\td = [d];\r\n\t} else if (  Array.isArray(d)  ) {} else {\r\n\t\tthrow new Error(\"First argument suppose to be \\\"Array\\\" or \\\"String\\\"\");\r\n\t}\r\n\tif (  typeof s != \"string\"  ){\r\n\t\tthrow new Error(\"Second argument suppose to be \\\"String\\\"\");\r\n\t}\r\n\tvar regx = new RegExp('[' + d.join('') + ']','g');\r\n\ts = s.replace(regx,d[0]);\r\n\treturn s.split(d[0]);\r\n};\r\n\r\n\r\n/**\r\n * @param {Array} d Delimiters\r\n * @param {String} s - String\r\n * @return Array\r\n * */\r\n_utils.split = function(d,s){\r\n\tthis.msplit.apply(this, arguments);\r\n};\r\n\r\n/**\r\n * @param {String} str - String\r\n * @param {String, Array} _chars - Characters\r\n * @param {Number} direction - 0 - left, 1 = right, -1 = both\r\n * */\r\n_utils.trim = function(str,_chars, direction){\r\n\tif (typeof str != \"string\") {\r\n\t\tthrow new Error(\"1st argument suppose to be String\");\r\n\t}\r\n\r\n\tif ( typeof _chars == \"string\" ){\r\n\t\t_chars = _chars.split('');\r\n\r\n\t} else if (  Array.isArray(_chars)  ){\r\n\r\n\t} else {\r\n\t\tthrow new Error(\"1st argument suppose to be String or Array\");\r\n\r\n\t}\r\n\r\n\tif (typeof direction != \"number\") direction = -1;\r\n\r\n\tstr = str.split('');\r\n\r\n\tfor(;;){\r\n\t\tif (!str.length) {\r\n\t\t\tbreak;\r\n\r\n\t\t} else if (\r\n\t\t\t(\r\n\t\t\t\tdirection === -1\r\n\t\t\t\t|| direction === 0\r\n\t\t\t)\r\n\t\t\t&& _chars.indexOf(str[0]) > -1\r\n\t\t){\r\n\t\t\tstr.shift();\r\n\r\n\t\t} else if (\r\n\t\t\t(\r\n\t\t\t\tdirection === -1\r\n\t\t\t\t|| direction === 1\r\n\t\t\t)\r\n\t\t\t&& _chars.indexOf(str[str.length-1]) > -1\r\n\t\t){\r\n\t\t\tstr.pop();\r\n\r\n\t\t} else {\r\n\t\t\tbreak;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\treturn str.join('');\r\n};\r\n\r\n\r\n/**\r\n * @param {String} str - String\r\n * @param {String, Array} _chars - Characters\r\n * */\r\n_utils.ltrim = function(str,_chars){\r\n\tvar arg = Array.prototype.slice.call(arguments,0);\r\n\targ[2] = 0;\r\n\treturn this.trim.apply(this, arg);\r\n};\r\n\r\n\r\n/**\r\n * @param {String} str - String\r\n * @param {String, Array} _chars - Characters\r\n * */\r\n_utils.rtrim = function(str,_chars){\r\n\tvar arg = Array.prototype.slice.call(arguments,0);\r\n\targ[2] = 1;\r\n\treturn this.trim.apply(this, arg);\r\n};\r\n\r\n\r\n_utils.arrayRemove = function(arr, from, to) {\r\n\tvar rest = arr.slice((to || from) + 1 || arr.length);\r\n\tarr.length = from < 0 ? arr.length + from : from;\r\n\treturn arr.push.apply(arr, rest);\r\n};\r\n\r\n\r\n/**\r\n * @param {Array} arr - Массив\r\n * @param {Number} n\r\n * */\r\n_utils.arrayRest = function(arr, n){\r\n\tif (typeof arr != \"object\"){\r\n\t\tthrow new Error(\"1st argument suppose to be Array\");\r\n\t}\r\n\tif (typeof n != \"number\") {\r\n\t\tthrow new Error(\"2nd argument suppose to be Number\");\r\n\t}\r\n\treturn Array.prototype.slice.call(arr, Math.abs(n));\r\n};\r\n\r\n\r\n_utils.objectHasOwnProperty = function(obj, key){\r\n\tif (arguments.length < 2) return false;\r\n\tif (typeof obj != \"object\") return false;\r\n\tvar keys = Object.getOwnPropertyNames(obj);\r\n\tfor(var c=0; c<keys.length; c++){\r\n\t\tif (  keys[c] == key  ){\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n\treturn false;\r\n};\r\n\r\n_utils.objectKeysToLowerCase = function(obj){\r\n\tif (typeof obj != \"object\") return null;\r\n\tvar keys = Object.getOwnPropertyNames(obj);\r\n\tvar res = {};\r\n\tfor(var c=0; c<keys.length; c++){\r\n\t\tres[keys[c].toLowerCase()] = obj[keys[c]];\r\n\t}\r\n\treturn res;\r\n};\r\n\r\n_utils.objectKeysToUpperCase = function(obj){\r\n\tif (typeof obj != \"object\") return null;\r\n\tvar keys = Object.getOwnPropertyNames(obj);\r\n\tvar res = {};\r\n\tfor(var c=0; c<keys.length; c++){\r\n\t\tres[keys[c].toUpperCase()] = obj[keys[c]];\r\n\t}\r\n\treturn res;\r\n};\r\n\r\n_utils.URLHashParse = function (){\r\n\tvar vars = {};\r\n\tif ( !!location.hash ){\r\n\t\tvar hash = location.hash.replace('#','');\r\n\t\thash = hash.split('&');\r\n\r\n\t\tfor (var c = 0; c < hash.length; c++) {\r\n\t\t\tvar match = hash[c].match(/=/g);\r\n\t\t\tif ( !!match && match.length == 1){\r\n\t\t\t\tvar tmp = hash[c].split('=');\r\n\t\t\t\tvars[tmp[0]] = tmp[1];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn vars;\r\n};\r\n\r\n_utils.URLHashSet = function (IN){\r\n\tvar this_ = this;\r\n\tvar newHash= (typeof IN.newHash == \"undefined\" ? false : IN.newHash );\r\n\tvar vars = ( newHash ? Object.create(null) : this_.URLHashParse() );\r\n\r\n\tvar prop;\r\n\r\n\tfor (prop in IN.vars) {\r\n\t\tif ( !IN.vars.hasOwnProperty(prop) ) continue;\r\n\t\tif ( IN.vars[prop] === null ){\r\n\t\t\tdelete vars[prop];\r\n\t\t} else {\r\n\t\t\tvars[prop] = IN.vars[prop];\r\n\t\t}\r\n\t}\r\n\r\n\tvar hash = [];\r\n\tfor (prop in vars) {\r\n\t\tif ( !vars.hasOwnProperty(prop) ) continue;\r\n\t\thash.push(prop + '=' + vars[prop]);\r\n\t}\r\n\thash = '#' + hash.join('&');\r\n\tlocation.hash = hash;\r\n};\r\n\r\n\r\n_utils.URLQueryParse = function (){\r\n\tvar vars = {};\r\n\tif ( !!location.search ){\r\n\t\tvar query = location.search.replace(/^[?]/,\"\");\r\n\t\tquery = query.split('&');\r\n\r\n\t\tfor (var c = 0; c < query.length; c++) {\r\n\t\t\tvar match = query[c].match(/=/g);\r\n\t\t\tif ( match && match.length == 1){\r\n\t\t\t\tvar tmp = query[c].split('=');\r\n\t\t\t\tvars[tmp[0]] = tmp[1];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn vars;\r\n};\r\n\r\n_utils.URLQuerySet = function (IN){\r\n\tvar newQuery= (typeof IN.newQuery == \"undefined\" ? false : IN.newQuery );\r\n\tvar vars = ( newQuery ? Object.create(null) : this.URLQueryParse() );\r\n\r\n\tvar prop;\r\n\r\n\tfor (prop in IN.vars) {\r\n\t\tif ( !IN.vars.hasOwnProperty(prop) ) continue;\r\n\r\n\t\tif ( IN.vars[prop] === null ){\r\n\t\t\tdelete vars[prop];\r\n\t\t} else {\r\n\t\t\tvars[prop] = IN.vars[prop];\r\n\t\t}\r\n\t}\r\n\r\n\tvar query = [];\r\n\tfor (prop in vars) {\r\n\t\tif ( !vars.hasOwnProperty(prop) ) continue;\r\n\t\tquery.push(prop + '=' + vars[prop]);\r\n\t}\r\n\tquery = '?' + query.join('&');\r\n\tlocation.search = query;\r\n};\r\n\r\n/**\r\n * @description Компонент Фабулы. Работа с Base64.\r\n * @author Миланин Альберт [milanin@mail.ru]\r\n * */\r\n_utils.awwsBase64 = {\r\n\t_keyStr: \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\",\r\n\tencode: function (input) {\r\n\t\tif (!input)return \"\";\r\n\t\tvar output = \"\";\r\n\t\tvar chr1, chr2, chr3, enc1, enc2, enc3, enc4;\r\n\t\tvar i = 0;\r\n\t\tinput = this._utf8_encode(input);\r\n\t\twhile (i < input.length) {\r\n\t\t\tchr1 = input.charCodeAt(i++);\r\n\t\t\tchr2 = input.charCodeAt(i++);\r\n\t\t\tchr3 = input.charCodeAt(i++);\r\n\t\t\tenc1 = chr1 >> 2;\r\n\t\t\tenc2 = ((chr1 & 3) << 4) | (chr2 >> 4);\r\n\t\t\tenc3 = ((chr2 & 15) << 2) | (chr3 >> 6);\r\n\t\t\tenc4 = chr3 & 63;\r\n\t\t\tif (isNaN(chr2)) {\r\n\t\t\t\tenc3 = enc4 = 64;\r\n\t\t\t} else if (isNaN(chr3)) {\r\n\t\t\t\tenc4 = 64;\r\n\t\t\t}\r\n\t\t\toutput = output + this._keyStr.charAt(enc1) + this._keyStr.charAt(enc2) + this._keyStr.charAt(enc3) + this._keyStr.charAt(enc4);\r\n\t\t}\r\n\t\toutput = ((output.length > 5) ? output.substr(5, 1) : \"x\") + output;\r\n\t\treturn output;\r\n\t},\r\n\tdecode: function (input) {\r\n\t\tvar _keyStr = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\";\r\n\t\tif (!input)return \"\";\r\n\t\tinput = input.substr(1);\r\n\t\tvar output = \"\";\r\n\t\tvar chr1, chr2, chr3;\r\n\t\tvar enc1, enc2, enc3, enc4;\r\n\t\tvar i = 0;\r\n\t\tinput = input.replace(/[^A-Za-z0-9\\+\\/\\=]/g, \"\");\r\n\t\twhile (i < input.length) {\r\n\t\t\tenc1 = _keyStr.indexOf(input.charAt(i++));\r\n\t\t\tenc2 = _keyStr.indexOf(input.charAt(i++));\r\n\t\t\tenc3 = _keyStr.indexOf(input.charAt(i++));\r\n\t\t\tenc4 = _keyStr.indexOf(input.charAt(i++));\r\n\t\t\tchr1 = (enc1 << 2) | (enc2 >> 4);\r\n\t\t\tchr2 = ((enc2 & 15) << 4) | (enc3 >> 2);\r\n\t\t\tchr3 = ((enc3 & 3) << 6) | enc4;\r\n\t\t\toutput = output + String.fromCharCode(chr1);\r\n\t\t\tif (enc3 != 64) {\r\n\t\t\t\toutput = output + String.fromCharCode(chr2);\r\n\t\t\t}\r\n\t\t\tif (enc4 != 64) {\r\n\t\t\t\toutput = output + String.fromCharCode(chr3);\r\n\t\t\t}\r\n\t\t}\r\n\t\toutput = this._utf8_decode(output);\r\n\t\treturn output;\r\n\t},\r\n\t_utf8_encode: function (string) {\r\n\t\tstring = string.replace(/\\r\\n/g, \"\\n\");\r\n\t\tvar utftext = \"\";\r\n\t\tfor (var n = 0; n < string.length; n++) {\r\n\t\t\tvar c = string.charCodeAt(n);\r\n\t\t\tif (c < 128) {\r\n\t\t\t\tutftext += String.fromCharCode(c);\r\n\t\t\t} else if ((c > 127) && (c < 2048)) {\r\n\t\t\t\tutftext += String.fromCharCode((c >> 6) | 192);\r\n\t\t\t\tutftext += String.fromCharCode((c & 63) | 128);\r\n\t\t\t} else {\r\n\t\t\t\tutftext += String.fromCharCode((c >> 12) | 224);\r\n\t\t\t\tutftext += String.fromCharCode(((c >> 6) & 63) | 128);\r\n\t\t\t\tutftext += String.fromCharCode((c & 63) | 128);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn utftext;\r\n\t},\r\n\t_utf8_decode: function (utftext) {\r\n\t\tvar string = \"\";\r\n\t\tvar i = 0;\r\n\t\tvar c = 0, c2 = 0, c3 = 0;\r\n\t\twhile (i < utftext.length) {\r\n\t\t\tc = utftext.charCodeAt(i);\r\n\t\t\tif (c < 128) {\r\n\t\t\t\tstring += String.fromCharCode(c);\r\n\t\t\t\ti++;\r\n\t\t\t} else if ((c > 191) && (c < 224)) {\r\n\t\t\t\tc2 = utftext.charCodeAt(i + 1);\r\n\t\t\t\tstring += String.fromCharCode(((c & 31) << 6) | (c2 & 63));\r\n\t\t\t\ti += 2;\r\n\t\t\t} else {\r\n\t\t\t\tc2 = utftext.charCodeAt(i + 1);\r\n\t\t\t\tc3 = utftext.charCodeAt(i + 2);\r\n\t\t\t\tstring += String.fromCharCode(((c & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63));\r\n\t\t\t\ti += 3;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn string;\r\n\t}\r\n};\r\n\r\n\r\n/**\r\n * @param {*} value\r\n * @return {String}\r\n * */\r\n_utils.getType = function(value){\r\n\tif (  toString.call(value) == \"[object Array]\"  ){\r\n\t\treturn \"array\";\r\n\r\n\t} else if (  toString.call(value) == \"[object Object]\"  )  {\r\n\t\treturn \"object\";\r\n\r\n\t} else if (  value === null  ) {\r\n\t\treturn \"null\";\r\n\r\n\t} else if (  value == \"[object Date]\"  ) {\r\n\t\treturn \"date\";\r\n\r\n\t} else {\r\n\t\treturn typeof value;\r\n\r\n\t}\r\n};\r\n\r\n\r\n/**\r\n * Парсинг строчных аргументов, в массив\r\n * Проверка типа, преобразование типов\r\n * Например: \"100,200;;300;400,abc\" => ['100','200','300','400'];\r\n * @param {Object} arg\r\n * @param {*} arg.value - входящие данные\r\n * @param {String} arg.into - тип преобразования\r\n * @param {Boolean} arg.kickEmpty - отбросить пустые значения\r\n * @param {Boolean} arg.toLowerCase - понизить регистр\r\n * @param {Boolean} arg.toUpperCase - повысить регистр\r\n * @param {Boolean} arg.toInt - привести к целым числам\r\n * @param {Boolean} arg.toFloat - привести с числамс плавающей точкой\r\n * @param {Array} arg.delimiters - массив разделителей для входящей строки\r\n * @param {Array, String} arg.trim - срезать символы в уже разделенной строке\r\n * */\r\n_utils.parseArg = function(arg){\r\n\r\n\tvar into = ( typeof arg.into == \"string\" ? arg.into.toLowerCase() : \"array\" );\r\n\r\n\tvar value = ( typeof arg.value != \"undefined\" ? arg.value : null );\r\n\r\n\tvar kickEmpty = ( typeof arg.kickEmpty == \"boolean\" ? arg.kickEmpty : true );\r\n\r\n\tvar toLowerCase = ( typeof arg.toLowerCase == \"boolean\" ? arg.toLowerCase : false );\r\n\r\n\tvar toUpperCase = ( typeof arg.toUpperCase == \"boolean\" ? arg.toUpperCase : false );\r\n\r\n\tvar toInt = ( typeof arg.toInt == \"boolean\" ? arg.toInt : false );\r\n\r\n\tvar toFloat = ( typeof arg.toFloat == \"boolean\" ? arg.toFloat : false );\r\n\r\n\tvar isInt = ( typeof arg.isInt == \"boolean\" ? arg.isInt : false );\r\n\r\n\tvar isFloat = ( typeof arg.isFloat == \"boolean\" ? arg.isFloat : false );\r\n\r\n\tvar delimiters = ( Array.isArray(arg.delimiters) && arg.delimiters.length ? arg.delimiters : [\";\",\",\"] );\r\n\r\n\tvar trim = typeof arg.trim == \"undefined\"\r\n\t\t? [\" \"]\r\n\t\t: (\r\n\t\tArray.isArray(arg.trim)\r\n\t\t\t? arg.trim\r\n\t\t\t: (\r\n\t\t\ttypeof arg.trim == \"string\"\r\n\t\t\t\t? arg.split(\"\")\r\n\t\t\t\t: null\r\n\t\t)\r\n\t);\r\n\r\n\t// --------------------------------------------------------------------------------\r\n\r\n\tif (value === null) {\r\n\t\treturn null;\r\n\t}\r\n\r\n\tif(into == \"array\"){\r\n\r\n\t\tif ( Array.isArray(value) ){\r\n\r\n\t\t} else if ( typeof value == \"string\" ){\r\n\r\n\t\t\tvalue = this.msplit(delimiters,value);\r\n\r\n\t\t} else if ( !isNaN(value) ) {\r\n\r\n\t\t\tvalue = [value];\r\n\r\n\t\t} else {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tvar tmp = [];\r\n\r\n\t\tfor(var c=0; c<value.length; c++){\r\n\t\t\tvar val = value[c];\r\n\r\n\t\t\t// trim\r\n\t\t\tif (\r\n\t\t\t\ttrim !== null\r\n\t\t\t\t&& typeof val == \"string\"\r\n\t\t\t){\r\n\t\t\t\tval = this.trim(val, trim);\r\n\t\t\t}\r\n\r\n\t\t\t// Если пустая ячейка\r\n\t\t\tif(\r\n\t\t\t\tkickEmpty\r\n\t\t\t\t&& (\r\n\t\t\t\t\tval === \"\"\r\n\t\t\t\t\t|| val === null\r\n\t\t\t\t)\r\n\t\t\t){ continue; }\r\n\r\n\t\t\t// Привести в нижний регистр\r\n\t\t\tif (toLowerCase && typeof val == \"string\") val = val.toLowerCase();\r\n\r\n\t\t\t// Перевести в верхний регистр\r\n\t\t\tif (toUpperCase && typeof val == \"string\") val = val.toUpperCase();\r\n\r\n\t\t\t// Откинуть все НЕ цифры\r\n\t\t\tif (isInt || isFloat){\r\n\t\t\t\tif ( typeof val == \"string\" && !isNaN(val)){\r\n\t\t\t\t\tval = val.trim();\r\n\t\t\t\t\tif( isFloat ){\r\n\t\t\t\t\t\tval = val.replace(\",\",\".\");\r\n\t\t\t\t\t\tif (  !val.match('/[.]/')  ) continue;\r\n\t\t\t\t\t} else if ( isInt ){\r\n\t\t\t\t\t\tval = val.replace(\",\",\".\");\r\n\t\t\t\t\t\tif (  val.match('/[.]/')  ) continue;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (  isInt && (val - Math.floor(val)) > 0  ) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t} else if  (  isFloat && (val - Math.floor(val)) == 0  ){\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Привести к целому\r\n\t\t\tif (toInt) {\r\n\t\t\t\tval = parseInt(val);\r\n\t\t\t}\r\n\r\n\t\t\t// Привести к десятичной\r\n\t\t\tif (toFloat) {\r\n\t\t\t\tval = parseFloat(val);\r\n\t\t\t}\r\n\r\n\t\t\ttmp.push(val);\r\n\r\n\t\t}\r\n\r\n\t\treturn tmp;\r\n\r\n\t}\r\n\r\n}; // parseArg\r\n\r\n\r\nmodule.exports =_utils;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./fabula-object-model/utils.js\n ** module id = 6\n ** module chunks = 0\n **/","var DefaultDataModel = require(\"./DefaultDataModel\");\r\nvar InterfaceFProperty = require(\"./InterfaceFProperty\");\r\nvar TalksDataModel = require(\"./TalksDataModel\");\r\n\r\nvar _utils = require(\"./../utils\");\r\n\r\n// Для совместимости\r\nvar getContextDB = function(){\r\n\tvar FabulaObjectModel = require(\"./../_FabulaObjectModel.js\");\r\n\tvar DBModel = FabulaObjectModel.prototype.DBModel;\r\n\r\n\tif (  this._fabulaInstance ){\r\n\t\treturn this._fabulaInstance.getDBInstance();\r\n\t}\r\n\treturn DBModel.prototype.getInstance();\r\n};\r\n\r\n// TODO пересмотреть алиасы\r\n/*\r\n* @Constructor\r\n* */\r\nvar MovDataModel = function(){\r\n\r\n\t// this.instances.push(this);\r\n\r\n\tDefaultDataModel.call(this);\r\n\r\n\tInterfaceFProperty.call(this);\r\n\r\n\tvar self = this;\r\n\r\n\tthis.set({\r\n\t\t\"GSDate\":\t\tnew Date(),\t// ALIASES: creatingDate\r\n\t\t\"MMID\":\t\t\tnull, \t\t\t\t// Integer\r\n\t\t\"MMPID\":\t\tnull,\t\t\t\t// Integer\r\n\t\t\"Doc\":\t\t\tnull,\t\t\t\t// string\r\n\t\t\"Doc1\":\t\t\tnull,\t\t\t\t// String\r\n\t\t\"IsDraft\":\t\tnull,\t\t\t\t// Integer (as Boolean)\r\n\t\t\"GS\":\t\t\t\tnull, \t\t\t\t// string\r\n\t\t\"GSSpec\":\t\tnull,\t\t\t\t// string\r\n\t\t\"Amount\":\t\tnull,\t\t\t\t// Integer\r\n\t\t\"Sum\":\t\t\tnull,\t\t\t\t// Float, Array(object,object,object), // ALIASES: mov_sum\r\n\t\t\"Sum2\":\t\t\tnull,\t\t\t\t// Float\r\n\t\t\"Price\":\t\t\tnull,\t\t\t\t// Float\r\n\t\t\"InOut\":\t\t\tnull,\t\t\t\t// Integer\r\n\t\t\"CodeOp\":\t\tnull,\t\t\t\t// string\r\n\t\t\"MMFlag\":\t\t\"1\",\t\t\t\t// String\r\n\t\t\"Performer\":\tnull,\t\t\t\t// Integer\r\n\t\t\"Manager2\":\tnull,\t\t\t\t// Integer\r\n\t\t\"Agent2\":\t\tnull\t\t\t\t// Integer\r\n\t});\r\n\r\n\tthis._property = [];\r\n\r\n\tthis.childrenMovs = [];\r\n\r\n\tthis.parentMov = null;\r\n\r\n\tthis.propsChanged = Object.create(null);\r\n\r\n\t// ------------------------------------------------------------------------\r\n\r\n\tfor(var prop in self.propertyKeys){\r\n\t\tif (  !self.propertyKeys.hasOwnProperty(prop)  ) continue;\r\n\t\t(function(){\r\n\t\t\tvar prop_ = prop;\r\n\t\t\tself.setAlias(\r\n\t\t\t\t\"getMethod\",\r\n\t\t\t\tprop,\r\n\t\t\t\tfunction(arg){\r\n\t\t\t\t\treturn self.getFabPropertyAliasMethod(prop_, arg);\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t\tself.setAlias(\r\n\t\t\t\t\"setMethod\",\r\n\t\t\t\tprop,\r\n\t\t\t\tfunction(value,arg){\r\n\t\t\t\t\treturn self.setFabPropertyAliasMethod(prop_, value, arg);\r\n\t\t\t\t}\r\n\t\t\t)\r\n\t\t})();\r\n\t}\r\n\r\n\t// ------------------------------------------------------------------------\r\n\r\n\tthis.setAlias(\r\n\t\t\"setMethod\",\r\n\t\t\"amount\",\r\n\t\tfunction(value){\r\n\t\t\tif (isNaN(value)) return false;\r\n\t\t\tvalue = parseFloat(value);\r\n\t\t\tif (value <= 0) value = 1;\r\n\t\t\tself.props.amount = value;\r\n\t\t\tself.propsChanged.amount = true;\r\n\t\t\treturn true;\r\n\t\t}\r\n\t);\r\n\r\n\tthis.on(\"set:mmid\", this._eventSetMMID);\r\n\tthis.on(\"set:doc\", this._eventSetDoc);\r\n\tthis.on(\"afterset:parentdoc\", this._eventSetParentDoc);\r\n\t// this.on(\"set:gs\", this._eventSetGS);\r\n\r\n\t// this.setAlias(\"set\",\"creatingDate\",\"GSDate\");\r\n\t// this.setAlias(\"set\",\"mov_sum\",\"Sum\");\r\n\t// this.setAlias(\"set\",\"GSID\",\"GS\");\r\n\r\n\t// this.setAlias(\"get\",\"creatingDate\",\"GSDate\");\r\n\t// this.setAlias(\"get\",\"mov_sum\",\"Sum\");\r\n\t// this.setAlias(\"get\",\"GSID\",\"GS\");\r\n\r\n\tthis.set(\"_unique_sid\", Math.random() * Math.pow(10,17));\r\n\r\n\tthis.clearChanged();\r\n\r\n};\r\n\r\nMovDataModel.prototype = DefaultDataModel.prototype._objectsPrototyping(\r\n\tDefaultDataModel.prototype,\r\n\tInterfaceFProperty.prototype,\r\n\t{\r\n\r\n\t\t\"_eventSetGS\": function(){\r\n\t\t\t/*\r\n\t\t\t* Планировалось привязать к событию \"set:gs\"\r\n\t\t\t* Для автоматического присваивания кода операции\r\n\t\t\t* (Поле CodeOp в Movement, поле GSCOP в GANDS)\r\n\t\t\t* Это требует асинх загрузки GandsDataModel.\r\n\t\t\t* Нет гарантии успешной выборки GSCOP из GANDS при отсутствии\r\n\t\t\t* задержек между инициализацией экземпляра и присваиванием.\r\n\t\t\t* => Было решено переложить данный функционал на внешние контроллеры\r\n\t\t\t* */\r\n\t\t},\r\n\r\n\r\n\t\t\"_eventSetMMID\": function(){\r\n\t\t\tvar e = arguments[1];\r\n\t\t\tfor(var c=0; c<this.childrenMovs.length; c++){\r\n\t\t\t\tthis.childrenMovs[c].set(\"MMPID\", e.value);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\r\n\t\t\"_eventSetDoc\": function(){\r\n\t\t\tvar e = arguments[1];\r\n\t\t\tvar c, v, keys, keys_, lowKey;\r\n\r\n\t\t\tvar doc = e.value || this.get(\"Doc1\") || this.get(\"ParentDoc\") || null;\r\n\r\n\t\t\tfor(c=0; c<this.childrenMovs.length; c++){\r\n\t\t\t\tif (  !this.childrenMovs[c].get(\"parentDoc\")  ){\r\n\t\t\t\t\tthis.childrenMovs[c].set(\"Doc\", doc);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfor(c=0; c<this._property.length; c++){\r\n\t\t\t\tif (!this._property[c]) continue;\r\n\t\t\t\tkeys = Object.getOwnPropertyNames(this._property[c]);\r\n\t\t\t\tkeys_ = [];\r\n\t\t\t\tfor(v=0; v<keys.length; v++){\r\n\t\t\t\t\tlowKey = keys[v].toLowerCase();\r\n\t\t\t\t\tkeys_.push(lowKey);\r\n\t\t\t\t\tif (lowKey == \"extid\"){\r\n\t\t\t\t\t\tthis._property[c][keys[v]] = doc;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (keys_.indexOf(\"extid\") == -1) this._property[c].extid = e.value;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\r\n\t\t\"_eventSetParentDoc\": function(){\r\n\t\t\t// Экспериментальное событие\r\n\t\t\t// Чтобы в интерфейсе фабулы задачи были видны как подчиненные\r\n\t\t\t// Необходимо чтобы они имели записи ParentDoc и равный ему Doc1\r\n\t\t\tvar e = arguments[1];\r\n\t\t\tif (typeof e.value != \"string\") return;\r\n\t\t\tthis.set(\"Doc1\",e.value);\r\n\t\t\tthis.set(\"Doc\", null);\r\n\t\t},\r\n\r\n\r\n\t\t\"addCMov\": function(){\r\n\t\t\treturn this.addChildMov.apply(this, arguments);\r\n\t\t},\r\n\r\n\r\n\t\t\"addChildMov\": function(child){\r\n\t\t\tvar mov, c, prop;\r\n\r\n\t\t\tif (  Array.isArray(child)  ){\r\n\r\n\t\t\t} else if (typeof child == \"object\") {\r\n\t\t\t\tchild = [child];\r\n\r\n\t\t\t} else {\r\n\t\t\t\treturn false;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tfor(  c=0; c<child.length; c++  ){\r\n\t\t\t\tif (typeof child[c] != \"object\") continue;\r\n\r\n\t\t\t\tif (  child[c] instanceof  MovDataModel){\r\n\r\n\t\t\t\t\tmov = child[c];\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tmov = new MovDataModel();\r\n\r\n\t\t\t\t\tfor (prop in child[c]) {\r\n\t\t\t\t\t\tif (typeof child[c].hasOwnProperty == \"function\") {\r\n\t\t\t\t\t\t\tif (!child[c].hasOwnProperty(prop)) continue;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (typeof child[c][prop] == \"undefined\") continue;\r\n\t\t\t\t\t\tmov.set(prop, child[c][prop]);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tmov.set(\"MMPID\", this.get(\"MMID\"));\r\n\r\n\t\t\t\tthis.childrenMovs.push(mov);\r\n\t\t\t}\r\n\r\n\t\t\treturn true;\r\n\t\t},\r\n\r\n\r\n\t\t\"appendChildMov\": function(){\r\n\t\t\treturn this.addChildMov.apply(this, arguments);\r\n\t\t},\r\n\r\n\r\n\t\t\"deleteChildMov\": function(){\r\n\t\t\treturn this.removeChilldMov.apply(this, arguments);\r\n\t\t},\r\n\r\n\r\n\t\t\"deleteCMov\": function(){\r\n\t\t\treturn this.removeChilldMov.apply(this, arguments);\r\n\t\t},\r\n\r\n\t\t\"removeCMov\": function(){\r\n\t\t\treturn this.removeChilldMov.apply(this, arguments);\r\n\t\t},\r\n\r\n\t\t\"removeChilldMov\": function(keyValue){\r\n\r\n\t\t\tif (typeof keyValue != \"object\") return false;\r\n\r\n\t\t\tif (  keyValue instanceof MovDataModel ){\r\n\r\n\t\t\t\tthis.childrenMovs = this.childrenMovs.filter(\r\n\t\t\t\t\tfunction(mov){\r\n\t\t\t\t\t\tif (  !mov  ) return false;\r\n\t\t\t\t\t\tif (  typeof mov != \"object\"  ) return false;\r\n\t\t\t\t\t\treturn mov.get(\"_unique_sid\") != keyValue.get(\"_unique_sid\");\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t\t\treturn true;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tthis.childrenMovs = this.childrenMovs.filter(\r\n\t\t\t\t\tfunction(mov){\r\n\t\t\t\t\t\tif (  !mov  ) return false;\r\n\t\t\t\t\t\tif (  typeof mov != \"object\"  ) return false;\r\n\t\t\t\t\t\tvar keys = Object.getOwnPropertyNames(keyValue);\r\n\t\t\t\t\t\tfor(var c=0; c<keys.length; c++){\r\n\t\t\t\t\t\t\tif (  mov.get(keys[c]) != keyValue[keys[c]]  ) return true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn true;\r\n\r\n\t\t},\r\n\r\n\r\n\t\t/**\r\n\t\t * @param {Object, MovDataModel=} keyValue - условия поиска по полям или обьект поиска\r\n\t\t * @param {Object=} propKeyValue - условия поиска по свойствам\r\n\t\t * @returns Array\r\n\t\t * */\r\n\t\t\"getCMov\": function(keyValue, propKeyValue){\r\n\t\t\treturn this.getChildrenMov.apply(this, arguments);\r\n\t\t},\r\n\r\n\r\n\t\t/**\r\n\t\t * @param {Object, MovDataModel=} fieldsArg - условия поиска по полям или обьект поиска\r\n\t\t * @param {Object=} propertyArg - условия поиска по свойствам\r\n\t\t * @returns Array\r\n\t\t * */\r\n\t\t\"getChildrenMov\": function(fieldsArg, propertyArg){\r\n\r\n\t\t\tif (!arguments.length) return this.childrenMovs;\r\n\r\n\t\t\tif (typeof fieldsArg != \"object\" || !fieldsArg) fieldsArg = {};\r\n\r\n\t\t\tif (typeof propertyArg != \"object\" || !propertyArg) propertyArg = {};\r\n\r\n\t\t\tvar c;\r\n\r\n\t\t\tif (  fieldsArg instanceof MovDataModel ){\r\n\r\n\t\t\t\tfor(c=0; c<this.childrenMovs.length; c++){\r\n\t\t\t\t\tif (  this.childrenMovs[c].get(\"_unique_sid\") == fieldsArg.get(\"_unique_sid\")  ){\r\n\t\t\t\t\t\treturn [this.childrenMovs[c]];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\treturn this.childrenMovs.filter(\r\n\t\t\t\t\tfunction(mov){\r\n\t\t\t\t\t\tif (!mov) return false;\r\n\t\t\t\t\t\tif (typeof mov != \"object\") return false;\r\n\r\n\t\t\t\t\t\tvar c, keys, ret = true;\r\n\r\n\t\t\t\t\t\tkeys = Object.getOwnPropertyNames(fieldsArg);\r\n\t\t\t\t\t\tfor(c=0; c<keys.length; c++){\r\n\t\t\t\t\t\t\tif (  mov.get(keys[c]) != fieldsArg[keys[c]]  ) ret = false;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tkeys = Object.getOwnPropertyNames(propertyArg);\r\n\t\t\t\t\t\tif (keys.length) {\r\n\t\t\t\t\t\t\tif (!mov.getProperty(propertyArg).length) ret = false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn ret;\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn [];\r\n\r\n\t\t},\r\n\r\n\r\n\t\t\"getJSON\": function(){\r\n\t\t\tvar keys = Object.getOwnPropertyNames(this.props);\r\n\t\t\tvar defaultFields = _utils.objectKeysToLowerCase(this.__movDataModelDefaultFields);\r\n\t\t\tvar lowKey, json = {};\r\n\t\t\tfor(var c=0; c<keys.length; c++){\r\n\t\t\t\tlowKey = keys[c].toLowerCase();\r\n\t\t\t\tif (  !defaultFields.hasOwnProperty(lowKey)  ) continue;\r\n\t\t\t\tjson[lowKey] = this.props[keys[c]];\r\n\t\t\t}\r\n\t\t\treturn json;\r\n\t\t},\r\n\r\n\r\n\t\t\"load\": function(arg){\r\n\r\n\t\t\tif (typeof arg != \"object\") arg = Object.create(null);\r\n\r\n\t\t\tvar c;\r\n\r\n\t\t\tvar callback = typeof arg.callback == \"function\" ? arg.callback : new Function();\r\n\r\n\t\t\tvar dbawws = getContextDB.call(this); // DBModel.prototype.getInstance();\r\n\r\n\t\t\tvar fields = _utils.parseArg({\r\n\t\t\t\t\"value\": arg.fields ? arg.fields : null,\r\n\t\t\t\t\"into\": \"array\",\r\n\t\t\t\t\"kickEmpty\": true,\r\n\t\t\t\t\"toLowerCase\": true,\r\n\t\t\t\t\"delimiters\": [\";\",\",\"]\r\n\t\t\t});\r\n\r\n\t\t\tif (  !fields || !fields.length  ){\r\n\t\t\t\tfields = [\r\n\t\t\t\t\t\"MMID\",\r\n\t\t\t\t\t\"MMPID\",\r\n\t\t\t\t\t\"ParentDoc\",\r\n\t\t\t\t\t\"Doc\",\r\n\t\t\t\t\t\"Doc1\",\r\n\t\t\t\t\t\"GS\",\r\n\t\t\t\t\t\"GSSpec\",\r\n\t\t\t\t\t\"MMFlag\",\r\n\t\t\t\t\t\"Amount\",\r\n\t\t\t\t\t\"Sum\",\r\n\t\t\t\t\t\"Sum2\",\r\n\t\t\t\t\t\"Price\",\r\n\t\t\t\t\t\"CodeOp\",\r\n\t\t\t\t\t\"Performer\",\r\n\t\t\t\t\t\"Manager2\",\r\n\t\t\t\t\t\"Agent2\",\r\n\t\t\t\t\t\"Format(GSDate,'yyyy-mm-dd Hh:Nn:Ss') as GSDate\"\r\n\t\t\t\t];\r\n\t\t\t}\r\n\r\n\t\t\tfor(c=0; c<fields.length; c++){\r\n\t\t\t\tif (  [\"sum\",\"sum2\",\"price\"].indexOf(fields[c].toLowerCase()) >-1  ){\r\n\t\t\t\t\tfields[c] = \"[\"+fields[c]+\"]\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar self = this;\r\n\r\n\t\t\t// -----------------------------------------------------------------------------------------------\r\n\r\n\t\t\tvar MMID = this.get(\"MMID\");\r\n\r\n\t\t\tif (!MMID || isNaN(MMID)) return;\r\n\r\n\t\t\tMMID = parseInt(MMID);\r\n\r\n\t\t\t// -----------------------------------------------------------------------------------------------\r\n\r\n\t\t\t// 38005\r\n\t\t\t// 37723 - РА5по31846\r\n\r\n\t\t\tvar DBq = [\r\n\t\t\t\t// Получение записи движения ТиУ\r\n\t\t\t\t\"SELECT \" +\r\n\t\t\t\tfields.join(\",\") +\r\n\t\t\t\t\" FROM Movement \" +\r\n\t\t\t\t\" WHERE MMID = \" + MMID,\r\n\r\n\t\t\t\t// Получение свойств записи\r\n\t\t\t\t\" SELECT uid, pid, ExtClass, ExtID, property, value FROM Property WHERE pid = \" + MMID + \" \",\r\n\r\n\t\t\t\t// Получение подчиненных записей\r\n\t\t\t\t\"SELECT \" +\r\n\t\t\t\tfields.join(\",\") +\r\n\t\t\t\t\" FROM Movement \" +\r\n\t\t\t\t\" WHERE MMPID = \" + MMID,\r\n\r\n\t\t\t\t// Получение свойств подчиненных записей\r\n\t\t\t\t\" SELECT uid, pid, ExtClass, ExtID, property, value \" +\r\n\t\t\t\t\" FROM Property WHERE pid IN (\" +\r\n\t\t\t\t\t\" SELECT MMID FROM Movement WHERE MMPID = \" + MMID + \" \" +\r\n\t\t\t\t\" ) \"\r\n\t\t\t];\r\n\r\n\t\t\tdbawws.dbquery({\r\n\t\t\t\t\"query\": DBq.join(\"; \"),\r\n\t\t\t\t\"callback\": function(dbres){\r\n\t\t\t\t\tvar c, prop, tmp;\r\n\r\n\t\t\t\t\tfor(c=0; c<dbres.length; c++){\r\n\t\t\t\t\t\tif (dbres[c].info.errors) console.error(\"DBDataModel.\" + dbres[c].info.errors);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (  !dbres[0].recs.length  ){\r\n\t\t\t\t\t\tcallback([\"!mov.length\"]);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Запись полей ТиУ (Поля задачи)\r\n\t\t\t\t\tvar mov = dbres[0].recs[0];\r\n\r\n\t\t\t\t\tfor(prop in mov){\r\n\t\t\t\t\t\tif (  !mov.hasOwnProperty(prop)  ) continue;\r\n\t\t\t\t\t\tself.set(prop, mov[prop]);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Запись свойств задачи\r\n\t\t\t\t\tself.addProperty(dbres[1].recs.length ? dbres[1].recs : []);\r\n\r\n\t\t\t\t\t// ----------------------------------------------------\r\n\t\t\t\t\t// Формируем подчиненные задачи\r\n\t\t\t\t\tvar childrenMovs = dbres[2].recs;\r\n\t\t\t\t\tvar childrenMovs_ = {};\r\n\t\t\t\t\tvar childMov, row;\r\n\r\n\t\t\t\t\tfor(c=0; c<childrenMovs.length; c++){\r\n\t\t\t\t\t\trow = childrenMovs[c];\r\n\r\n\t\t\t\t\t\tchildMov = new MovDataModel();\r\n\t\t\t\t\t\tchildMov.set(\"MMID\", row.MMID);\r\n\t\t\t\t\t\tchildMov.parentMov = self;\r\n\r\n\t\t\t\t\t\tfor(prop in row){\r\n\t\t\t\t\t\t\tif (  !row.hasOwnProperty(prop)  ) continue;\r\n\t\t\t\t\t\t\tchildMov.set(prop,row[prop])\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tchildrenMovs_[childMov.get(\"MMID\")] = childMov;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar childrenProps = dbres[3].recs;\r\n\r\n\t\t\t\t\tfor(c=0; c<childrenProps.length; c++){\r\n\t\t\t\t\t\tif (  childrenMovs_.hasOwnProperty(childrenProps[c].pid)  ){\r\n\t\t\t\t\t\t\tchildrenMovs_[childrenProps[c].pid].addProperty(childrenProps[c]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ttmp = [];\r\n\r\n\t\t\t\t\tfor(prop in childrenMovs_){\r\n\t\t\t\t\t\tif (  typeof childrenMovs_.hasOwnProperty == \"function\"  ){\r\n\t\t\t\t\t\t\tif (  !childrenMovs_.hasOwnProperty(prop)  ) continue;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\ttmp.push(childrenMovs_[prop]);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tself.addChildMov(tmp);\r\n\r\n\t\t\t\t\t// ----------------------------------------------------\r\n\t\t\t\t\t// Обнуляем информацию о проделанных изм.\r\n\t\t\t\t\tself.clearChanged();\r\n\t\t\t\t\tself.clearChangedProperty();\r\n\r\n\t\t\t\t\tcallback(null, self);\r\n\r\n\t\t\t\t} // close.callback\r\n\t\t\t}); // close.dbquery\r\n\r\n\t\t},\r\n\r\n\r\n\t\t\"remove\": function(arg){\r\n\t\t\tif (typeof arg != \"object\") arg = Object.create(null);\r\n\r\n\t\t\tvar callback = typeof arg.callback == \"function\" ? arg.callback : new Function();\r\n\r\n\t\t\tif (!this.get(\"MMID\")){\r\n\t\t\t\tcallback(\"!MMID\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tvar dbawws = getContextDB.call(this);\r\n\r\n\t\t\tdbawws.dbquery({\r\n\t\t\t\t\"query\": \"DELETE FROM Movement WHERE MMID='\" + this.get(\"MMID\") + \"'\",\r\n\t\t\t\t\"callback\": function(dbres){\r\n\t\t\t\t\tif (dbres.info.errors.length){\r\n\t\t\t\t\t\tcallback(dbres.info.errors);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcallback(null);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\r\n\r\n\t\t\"insert\": function(A){\r\n\r\n\t\t\tif (typeof A != \"object\") A = {};\r\n\r\n\t\t\tvar dbawws = getContextDB.call(this); // DBModel.prototype.getInstance();\r\n\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tvar callback = typeof A.callback == \"function\" ? A.callback : new Function();\r\n\r\n\t\t\tvar MMID = this.get(\"MMID\");\r\n\r\n\t\t\tvar defaultFields = _utils.objectKeysToLowerCase(self.__movDataModelDefaultFields);\r\n\t\t\tdefaultFields.gsdate.value = \"NOW()\";\r\n\r\n\t\t\tvar values = [], fields = [];\r\n\t\t\tvar value, c, prop, type, lowName;\r\n\r\n\t\t\t// -----------------------------------------------------------------\r\n\r\n\t\t\tself.trigger(\"beforeInsert\");\r\n\r\n\t\t\t// -----------------------------------------------------------------\r\n\r\n\t\t\tfor(prop in defaultFields){\r\n\t\t\t\tif (  !defaultFields.hasOwnProperty(prop)  ) continue;\r\n\t\t\t\tlowName = prop.toLowerCase();\r\n\r\n\t\t\t\tvalue = defaultFields[prop].value || this.get(prop);\r\n\r\n\t\t\t\tif (!value) continue;\r\n\r\n\t\t\t\tif (value instanceof Date){\r\n\t\t\t\t\tvalue = \"\"\r\n\t\t\t\t\t\t+ [value.getDate(), value.getMonth()-1, value.getFullYear()].join(\".\")\r\n\t\t\t\t\t\t+ \" \"\r\n\t\t\t\t\t\t+ [value.getHours(),value.getMinutes(),value.getSeconds()].join(\";\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (  defaultFields[prop].type == \"S\"  ) {\r\n\t\t\t\t\tvalues.push(!value ? \"NULL\" : \"\\\"\"+_utils.DBSecureStr(value)+\"\\\"\");\r\n\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvalues.push(!value ? \"NULL\" : value);\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfields.push(\"[\"+prop+\"]\");\r\n\t\t\t}\r\n\r\n\t\t\tvar dbq = [\r\n\t\t\t\t\"INSERT INTO Movement (\"+fields.join(\",\")+\") VALUES (\"+values.join(\",\")+\")\"\r\n\t\t\t];\r\n\r\n\t\t\t// -----------------------------------------------------------------\r\n\r\n\t\t\tdbq.push(\"DELETE FROM Property WHERE ExtClass = 'DOCS' AND pid = \" + MMID);\r\n\r\n\t\t\tvar property;\r\n\r\n\t\t\tvar _interfaceFPropertyFields = InterfaceFProperty.prototype._interfaceFPropertyFields;\r\n\r\n\t\t\tfor(c=0; c<this._property.length; c++){\r\n\r\n\t\t\t\tif (  typeof this._property[c] != \"object\"  ) continue;\r\n\r\n\t\t\t\tproperty = _utils.objectKeysToLowerCase(this._property[c]);\r\n\t\t\t\tvalues = [];\r\n\t\t\t\tfields = [];\r\n\r\n\t\t\t\tproperty.pid = self.get(\"MMID\");\r\n\r\n\t\t\t\tif (  !property.hasOwnProperty(\"property\")  ) continue;\r\n\r\n\t\t\t\tif (  !property.hasOwnProperty(\"value\")  ) continue;\r\n\r\n\t\t\t\tproperty.extclass = \"DOCS\";\r\n\r\n\t\t\t\tproperty.extid = self.get(\"Doc\");\r\n\r\n\t\t\t\tfor(prop in property){\r\n\t\t\t\t\tif (  !property.hasOwnProperty(prop)  ) continue;\r\n\r\n\t\t\t\t\ttype = null;\r\n\t\t\t\t\tvalue = property[prop];\r\n\t\t\t\t\tlowName = prop.toLowerCase();\r\n\r\n\t\t\t\t\tif (  value === null || typeof value == \"undefined\"  ) continue;\r\n\r\n\t\t\t\t\tfields.push(\"[\"+prop+\"]\");\r\n\r\n\t\t\t\t\tif (  !_interfaceFPropertyFields.hasOwnProperty(prop)  ) continue;\r\n\t\t\t\t\ttype = _interfaceFPropertyFields[lowName].type;\r\n\t\t\t\t\ttype = type.toLowerCase();\r\n\r\n\r\n\t\t\t\t\tif (type == \"string\") value = \"\\\"\"+_utils.DBSecureStr(value)+\"\\\"\";\r\n\r\n\t\t\t\t\tvalues.push(value);\r\n\t\t\t\t}\r\n\t\t\t\tdbq.push(\r\n\t\t\t\t\t\"INSERT INTO Property (\"+fields.join(\",\")+\") VALUES (\"+values.join(\",\")+\")\"\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\t// -----------------------------------------------------------------\r\n\r\n\t\t\tvar promises = [\r\n\t\t\t\tfunction(resolve, reject){\r\n\t\t\t\t\tdbawws.dbquery({\r\n\t\t\t\t\t\t\"query\": dbq.join(\"; \"),\r\n\t\t\t\t\t\t\"callback\": function(dbres){\r\n\t\t\t\t\t\t\tvar err = [];\r\n\t\t\t\t\t\t\tfor(var c=0; c<dbres.length; c++){\r\n\t\t\t\t\t\t\t\tif (  dbres[c].info.errors  ){\r\n\t\t\t\t\t\t\t\t\terr.push(dbres[c].info.errors);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (err.length){\r\n\t\t\t\t\t\t\t\treject(err);\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tresolve();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t}\r\n\t\t\t];\r\n\r\n\t\t\tfor(c=0; c<this.childrenMovs.length; c++){\r\n\t\t\t\t(function(){\r\n\t\t\t\t\tvar cc = c;\r\n\t\t\t\t\tpromises.push(\r\n\t\t\t\t\t\tfunction(resolve, reject){\r\n\t\t\t\t\t\t\tself.childrenMovs[cc].set(\"MMPID\", self.get(\"MMID\"));\r\n\t\t\t\t\t\t\tself.childrenMovs[cc].save({\r\n\t\t\t\t\t\t\t\t\"callback\": function(err){\r\n\t\t\t\t\t\t\t\t\tif (err){\r\n\t\t\t\t\t\t\t\t\t\treject(err);\r\n\t\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tresolve();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t);\r\n\t\t\t\t})()\r\n\t\t\t}\r\n\r\n\t\t\tif (\r\n\t\t\t\tself.get(\"MMFlag\")\r\n\t\t\t\t&& self.get(\"MMID\")\r\n\t\t\t){\r\n\r\n\t\t\t\tpromises.push(\r\n\t\t\t\t\tfunction(resolve, reject){\r\n\r\n\t\t\t\t\t\tvar docDataObj = self.get(\"DocDataObject\");\r\n\t\t\t\t\t\tvar talksInstance = TalksDataModel.prototype.getInstance();\r\n\r\n\t\t\t\t\t\ttalksInstance.postTalk({\r\n\t\t\t\t\t\t\t\"MMID\": self.get(\"MMID\"),\r\n\t\t\t\t\t\t\t\"MMFlag\": self.get(\"MMFlag\"),\r\n\t\t\t\t\t\t\t\"agent\": !docDataObj ? \"999\" : (docDataObj.get(\"agent\") || 999),\r\n\t\t\t\t\t\t\t\"callback\": function(err){\r\n\t\t\t\t\t\t\t\tif (err){\r\n\t\t\t\t\t\t\t\t\treject();\r\n\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tresolve();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif (  !promises.length  ){\r\n\t\t\t\tcallback(null);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tPromise.cascade(promises)\r\n\t\t\t\t.then(function(){\r\n\t\t\t\t\tcallback(null);\r\n\t\t\t\t\tself.trigger(\"afterInsert\");\r\n\t\t\t\t})\r\n\t\t\t\t.catch(function(err){\r\n\t\t\t\t\tcallback(err);\r\n\t\t\t\t});\r\n\r\n\t\t},\r\n\r\n\r\n\t\t/**\r\n\t\t * @param {Boolean}\t\targ.useNotification\t\t\t// Включатель уведомление о смене фазы\r\n\t\t * @param {Boolean}\t\targ.saveChildren\t\t\t\t// Применить изменения в подчиненных задачах\r\n\t\t * @param {Boolean}\t\targ.saveParent\t\t\t\t// Применить изменения в родительской задаче // НЕ РАБОТАЕТ\r\n\t\t * @param {Array}\t\t\targ.excludeMovs\t\t\t\t// Игнорировать изменения в перечисленных задачах. Массив из MMID (целые числа)\r\n\t\t * @param {Array}\t\t\targ.excludeMovs\t\t\t\t// Применить изменения только в перечисленных задачах // НЕ РАБОТАЕТ\r\n\t\t * @param {Function}\t\targ.callback(err)\t\t\t\t// callback\r\n\t\t * */\r\n\t\t \"update\": function(arg){\r\n\t\t\tif (typeof arg != \"object\") arg = {};\r\n\r\n\t\t\tvar dbawws = getContextDB.call(this); // DBModel.prototype.getInstance();\r\n\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tvar callback = typeof arg.callback == \"function\" ? arg.callback : new Function();\r\n\r\n\t\t\tvar useNotification = typeof arg.useNotification == \"undefined\" ? true : Boolean(arg.useNotification);\r\n\r\n\t\t\tvar saveChildren = typeof arg.saveChildren == \"undefined\" ? true : Boolean(arg.saveChildren);\r\n\r\n\t\t\t// var saveParent = typeof arg.saveParent == \"undefined\" ? true : Boolean(arg.saveParent);\r\n\r\n\t\t\tvar excludeMovs = _utils.parseArg({\r\n\t\t\t\t\"value\":\t\t\ttypeof arg.excludeMovs == \"undefined\"? null : arg.excludeMovs,\r\n\t\t\t\t\"into\":\t\t\t\"array\",\r\n\t\t\t\t\"isInt\":\t\t\ttrue,\r\n\t\t\t\t\"toInt\":\t\t\ttrue,\r\n\t\t\t\t\"kickEmpty\":\ttrue,\r\n\t\t\t\t\"delimiters\":\t[\",\",\";\"]\r\n\t\t\t}) || [];\r\n\r\n\t\t\t/*\r\n\t\t\tvar includeMovs = _utils.parseArg({\r\n\t\t\t\t\"value\": typeof arg.includeMovs == \"undefined\"? null : arg.includeMovs,\r\n\t\t\t\t\"into\":\t\t\t\"array\",\r\n\t\t\t\t\"isInt\":\t\t\ttrue,\r\n\t\t\t\t\"toInt\":\t\t\ttrue,\r\n\t\t\t\t\"kickEmpty\":\ttrue,\r\n\t\t\t\t\"delimiters\":\t[\",\",\";\"]\r\n\t\t\t}) || [];\r\n\t\t\t*/\r\n\r\n\t\t\tvar MMID = this.get(\"MMID\");\r\n\r\n\t\t\tvar dbq = [\r\n\t\t\t\t// Получение записи движения ТиУ\r\n\t\t\t\t\"SELECT MMID FROM Movement WHERE MMID = \" + MMID,\r\n\r\n\t\t\t\t// Получение свойств записи\r\n\t\t\t\t\" SELECT uid, pid, ExtClass, ExtID, property, [value] FROM Property WHERE pid = \" + MMID + \" \",\r\n\r\n\t\t\t\t\" SELECT MMID FROM Movement WHERE MMPID = \" + MMID\r\n\t\t\t];\r\n\r\n\r\n\t\t\t// ------------------------------------------------------------------------------\r\n\r\n\t\t\tself.trigger(\"beforeUpdate\");\r\n\r\n\t\t\t// ------------------------------------------------------------------------------\r\n\r\n\t\t\tdbawws.dbquery({\r\n\t\t\t\t\"query\": dbq.join(\"; \"),\r\n\t\t\t\t\"callback\": function(dbres) {\r\n\r\n\t\t\t\t\tvar c, prop, tmp, fields, values, value, type, lowName;\r\n\t\t\t\t\tvar dbq = [];\r\n\r\n\t\t\t\t\tvar changedFields = self.getChanged();\r\n\t\t\t\t\tvar disabledFields = [\"gsdate\",\"mmid\"];\r\n\r\n\t\t\t\t\tif (  !dbres[0].recs.length  ){\r\n\t\t\t\t\t\tcallback([\"!movs.length\"]);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar defaultFields = _utils.objectKeysToLowerCase(self.__movDataModelDefaultFields);\r\n\r\n\t\t\t\t\t// -----------------------------------------------------------------\r\n\r\n\t\t\t\t\tvar dbProps = dbres[1].recs;\r\n\t\t\t\t\t// var dbMov = dbres[0].recs[0];\r\n\t\t\t\t\tvar dbChildrenMovs = dbres[2].recs;\r\n\r\n\t\t\t\t\t// снижение регистра для полей записи из базы\r\n\t\t\t\t\t// dbMov = _utils.objectKeysToLowerCase(dbMov);\r\n\r\n\t\t\t\t\t// -----------------------------------------------------------------\r\n\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tvar promises = [];\r\n\r\n\t\t\t\t\t\tvar insertedProps = [];\r\n\t\t\t\t\t\tvar deletedProps = [];\r\n\t\t\t\t\t\tvar updatedProps = [];\r\n\r\n\t\t\t\t\t\tvar deletedChildren = [];\r\n\r\n\t\t\t\t\t\tvar objPropRef = {}; // Ссылки на свойства в обьекте\r\n\t\t\t\t\t\tvar dbPropRef2 = {}; // Ссылки на свойства в БД\r\n\t\t\t\t\t\tvar childrenMovsRef = {};\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// -----------------------------------------------------------------\r\n\t\t\t\t\t// Ссылки на подчиненные задачи\r\n\t\t\t\t\tfor(c=0; c<self.childrenMovs.length; c++){\r\n\t\t\t\t\t\ttmp = self.childrenMovs[c].get(\"MMID\");\r\n\t\t\t\t\t\tchildrenMovsRef[tmp] = self.childrenMovs[c];\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// -----------------------------------------------------------------\r\n\t\t\t\t\t// Список удаленных подчиненных задач\r\n\t\t\t\t\tfor(c=0; c<dbChildrenMovs.length; c++){\r\n\t\t\t\t\t\tif (  !childrenMovsRef.hasOwnProperty(dbChildrenMovs[c].MMID)  ){\r\n\t\t\t\t\t\t\tdeletedChildren.push(dbChildrenMovs[c].MMID);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar property;\r\n\t\t\t\t\ttmp = [];\r\n\r\n\t\t\t\t\t// ------------------------------------------------------------------\r\n\t\t\t\t\t// Ссылки на свойства задачи\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tfor(c=0; c<self._property.length; c++){\r\n\t\t\t\t\t\t\tif (  typeof self._property[c] != \"object\" || !self._property[c]  ) continue;\r\n\r\n\t\t\t\t\t\t\tproperty = _utils.objectKeysToLowerCase(self._property[c]);\r\n\r\n\t\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\t\t!property.hasOwnProperty(\"property\")\r\n\t\t\t\t\t\t\t\t|| !property.hasOwnProperty(\"value\")\r\n\t\t\t\t\t\t\t){\r\n\t\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tself._property[c].pid = self.get(\"MMID\");\r\n\r\n\t\t\t\t\t\t\tself._property[c].extclass = \"DOCS\";\r\n\r\n\t\t\t\t\t\t\tself._property[c].extid = self.get(\"Doc\");\r\n\r\n\t\t\t\t\t\t\ttmp.push(self._property[c]);\r\n\r\n\t\t\t\t\t\t\tif (  !property.hasOwnProperty(\"uid\")  ) continue;\r\n\r\n\t\t\t\t\t\t\tobjPropRef[property.uid] = self._property[c];\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tself._property = tmp;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// ------------------------------------------------------------------\r\n\t\t\t\t\t// Создание ссылок на свойства в базе.\r\n\t\t\t\t\t// Создание списка удаленных, добавленных и обновленных свойств\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tfor(c=0; c<dbProps.length; c++){\r\n\r\n\t\t\t\t\t\t\tdbPropRef2[dbProps[c].uid] = dbProps[c];\r\n\r\n\t\t\t\t\t\t\tif (  !objPropRef.hasOwnProperty(dbProps[c].uid)  ){\r\n\t\t\t\t\t\t\t\tdeletedProps.push(dbProps[c].uid);\r\n\t\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif (  objPropRef[dbProps[c].uid].value != dbProps[c].value  ){\r\n\t\t\t\t\t\t\t\tupdatedProps.push(dbProps[c]);\r\n\t\t\t\t\t\t\t\tdbq.push(\r\n\t\t\t\t\t\t\t\t\t\"UPDATE Property \" +\r\n\t\t\t\t\t\t\t\t\t\" SET \" +\r\n\t\t\t\t\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t\t\t\t\t\"[value]=\\\"\"+_utils.DBSecureStr(objPropRef[dbProps[c].uid].value)+\"\\\"\",\r\n\t\t\t\t\t\t\t\t\t\t\t\"[ExtClass]='DOCS'\",\r\n\t\t\t\t\t\t\t\t\t\t\t\"[ExtID]=\"+(!self.get(\"Doc\") ? \"NULL\" : \"\\\"\"+self.get(\"Doc\")+\"\\\"\")\r\n\t\t\t\t\t\t\t\t\t\t].join(\", \") +\r\n\t\t\t\t\t\t\t\t\t\" WHERE \" +\r\n\t\t\t\t\t\t\t\t\t\t\" property = '\"+dbProps[c].property+\"' \" +\r\n\t\t\t\t\t\t\t\t\t\t\" AND uid = \" + dbProps[c].uid\r\n\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tvar _interfaceFPropertyFields = InterfaceFProperty.prototype._interfaceFPropertyFields;\r\n\r\n\t\t\t\t\t\tfor(c=0; c<self._property.length; c++){\r\n\t\t\t\t\t\t\tif (  !dbPropRef2.hasOwnProperty(self._property[c].uid)  ){\r\n\t\t\t\t\t\t\t\tinsertedProps.push(self._property[c]);\r\n\r\n\t\t\t\t\t\t\t\tfields = [];\r\n\t\t\t\t\t\t\t\tvalues = [];\r\n\r\n\t\t\t\t\t\t\t\tfor(prop in self._property[c]){\r\n\t\t\t\t\t\t\t\t\tif (  !self._property[c].hasOwnProperty(prop)  ) continue;\r\n\r\n\t\t\t\t\t\t\t\t\ttype = null;\r\n\t\t\t\t\t\t\t\t\tvalue = self._property[c][prop];\r\n\t\t\t\t\t\t\t\t\tlowName = prop.toLowerCase();\r\n\r\n\t\t\t\t\t\t\t\t\tif (value === null) continue;\r\n\r\n\t\t\t\t\t\t\t\t\tfields.push(\"[\"+prop+\"]\");\r\n\r\n\t\t\t\t\t\t\t\t\tif (  !_interfaceFPropertyFields.hasOwnProperty(lowName)  ) continue;\r\n\t\t\t\t\t\t\t\t\ttype = _interfaceFPropertyFields[lowName].type;\r\n\t\t\t\t\t\t\t\t\ttype = type.toLowerCase();\r\n\r\n\t\t\t\t\t\t\t\t\tif (type == \"string\"){\r\n\t\t\t\t\t\t\t\t\t\tvalue = (  value === null || value === \"\" ? \"NULL\" : \"\\\"\"+_utils.DBSecureStr(value)+\"\\\"\"  );\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\tvalues.push(value);\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tif (fields.length != values.length || !fields.length) continue;\r\n\r\n\t\t\t\t\t\t\t\tdbq.push( \"INSERT INTO Property (\"+fields.join(\",\")+\") VALUES (\"+values.join(\",\")+\")\" );\r\n\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// ------------------------------------------------------------------\r\n\r\n\t\t\t\t\t\tif (  deletedProps.length  ){\r\n\t\t\t\t\t\t\tdbq.push(\"DELETE FROM Property WHERE uid IN (\"+deletedProps.join(\",\")+\")\");\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (  deletedChildren.length  ){\r\n\t\t\t\t\t\t\tdbq.push(\"DELETE FROM Movement WHERE MMID IN (\"+deletedChildren.join(\",\")+\")\");\r\n\t\t\t\t\t\t\tdbq.push(\"DELETE FROM Property WHERE pid IN (\"+deletedChildren.join(\",\")+\")\")\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\r\n\t\t\t\t\t// -----------------------------------------------------------------\r\n\t\t\t\t\t// Обновление полей в строке\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tvalues = [];\r\n\r\n\t\t\t\t\t\tfor(c=0; c<changedFields.length; c++){\r\n\t\t\t\t\t\t\tlowName = changedFields[c].toLowerCase();\r\n\r\n\t\t\t\t\t\t\tif (  !defaultFields.hasOwnProperty(lowName)  ) continue;\r\n\t\t\t\t\t\t\tif (  disabledFields.indexOf(lowName) > -1  ) continue;\r\n\r\n\t\t\t\t\t\t\tvalue = self.get(lowName);\r\n\t\t\t\t\t\t\ttype = defaultFields[lowName].type;\r\n\r\n\t\t\t\t\t\t\tif (value instanceof Date){\r\n\t\t\t\t\t\t\t\tvalue = \"\"\r\n\t\t\t\t\t\t\t\t\t+ [value.getDate(), value.getMonth()-1, value.getFullYear()].join(\".\")\r\n\t\t\t\t\t\t\t\t\t+ \" \"\r\n\t\t\t\t\t\t\t\t\t+ [value.getHours(),value.getMinutes(),value.getSeconds()].join(\";\");\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif (  type == \"S\"  ) {\r\n\t\t\t\t\t\t\t\tvalues.push((\"[\"+lowName+\"]=\") + (!value ? \"NULL\" : '\\''+_utils.DBSecureStr(value)+'\\''));\r\n\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tvalues.push((\"[\"+lowName+\"]=\") + (!value ? \"NULL\" : value));\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (  values.length  ){\r\n\t\t\t\t\t\t\tdbq.push(\"UPDATE Movement SET \"+ values.join(\", \") +\" WHERE MMID = \" + MMID);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\r\n\t\t\t\t\t// -----------------------------------------------------------------\r\n\t\t\t\t\t// Если ничего не изменилось\r\n\r\n\t\t\t\t\tif (  !dbq.length && !promises.length  ){\r\n\t\t\t\t\t\tcallback(null);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// -----------------------------------------------------------------\r\n\t\t\t\t\t// Прим. изменений\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tpromises.push(\r\n\t\t\t\t\t\t\tfunction(resolve, reject){\r\n\t\t\t\t\t\t\t\tdbawws.dbquery({\r\n\t\t\t\t\t\t\t\t\t\"query\": dbq.join(\"; \"),\r\n\t\t\t\t\t\t\t\t\t\"callback\": function(dbres){\r\n\t\t\t\t\t\t\t\t\t\tvar err = [];\r\n\t\t\t\t\t\t\t\t\t\tfor(var c=0; c<dbres.length; c++){\r\n\t\t\t\t\t\t\t\t\t\t\tif (  dbres[c].info.errors  ){\r\n\t\t\t\t\t\t\t\t\t\t\t\terr.push(dbres[c].info.errors);\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\tif (err.length){\r\n\t\t\t\t\t\t\t\t\t\t\treject(err);\r\n\t\t\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\tresolve();\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\tif (  saveChildren  ){\r\n\r\n\t\t\t\t\t\t\tfor(c=0; c<self.childrenMovs.length; c++){\r\n\t\t\t\t\t\t\t\t(function(){\r\n\t\t\t\t\t\t\t\t\tvar cc=c;\r\n\t\t\t\t\t\t\t\t\t// Если в списке исключений, игнорировать любые изменения\r\n\t\t\t\t\t\t\t\t\tif (  excludeMovs.indexOf(self.childrenMovs[cc].get(\"MMID\")) > -1  ){\r\n\t\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t// Если ничего не менялось, то и выполнять сохранения нет смысла\r\n\t\t\t\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\t\t\t\t!self.childrenMovs[cc].getChanged().length\r\n\t\t\t\t\t\t\t\t\t\t&& !self.childrenMovs[cc].getChangedProperty().length\r\n\t\t\t\t\t\t\t\t\t){\r\n\t\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t// Если запись уже удалена, update не произойдет. Наоборот insert\r\n\t\t\t\t\t\t\t\t\tif (  deletedChildren.indexOf(self.childrenMovs[cc].get(\"MMID\")) > -1  ){\r\n\t\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tpromises.push(\r\n\t\t\t\t\t\t\t\t\t\tfunction(resolve, reject){\r\n\t\t\t\t\t\t\t\t\t\t\tif (  self.childrenMovs[cc].get(\"MMPID\") != self.get(\"MMID\")  ){\r\n\t\t\t\t\t\t\t\t\t\t\t\tself.childrenMovs[cc].set(\"MMPID\", self.get(\"MMID\"));\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\tself.childrenMovs[cc].save({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\"useNotification\": false,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\"callback\": function(err){\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (err){\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\treject(err);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tresolve();\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\t})();\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t} // close.save.children\r\n\r\n\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\tuseNotification\r\n\t\t\t\t\t\t\t&& self.get(\"MMFlag\")\r\n\t\t\t\t\t\t\t&& self.get(\"MMID\")\r\n\t\t\t\t\t\t\t&& changedFields.indexOf(\"mmflag\") > -1\r\n\t\t\t\t\t\t){\r\n\r\n\t\t\t\t\t\t\tpromises.push(\r\n\t\t\t\t\t\t\t\tfunction(resolve, reject){\r\n\t\t\t\t\t\t\t\t\tvar docDataObj = self.get(\"DocDataObject\");\r\n\r\n\t\t\t\t\t\t\t\t\tvar talksInstance = TalksDataModel.prototype.getInstance();\r\n\r\n\t\t\t\t\t\t\t\t\ttalksInstance.postTalk({\r\n\t\t\t\t\t\t\t\t\t\t\"MMID\": self.get(\"MMID\"),\r\n\t\t\t\t\t\t\t\t\t\t\"MMFlag\": self.get(\"MMFlag\"),\r\n\t\t\t\t\t\t\t\t\t\t\"agent\": !docDataObj ? \"999\" : (docDataObj.get(\"agent\") || 999),\r\n\t\t\t\t\t\t\t\t\t\t\"callback\": function(err){\r\n\t\t\t\t\t\t\t\t\t\t\tif (err){\r\n\t\t\t\t\t\t\t\t\t\t\t\treject();\r\n\t\t\t\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\tresolve();\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t} // close.блок.прим.изм\r\n\r\n\r\n\t\t\t\t\t// -----------------------------------------------------------------\r\n\r\n\t\t\t\t\tif (  !promises.length  ){\r\n\t\t\t\t\t\tcallback(null);\r\n\t\t\t\t\t\tself.trigger(\"afterUpdate\");\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tPromise.cascade(promises)\r\n\t\t\t\t\t\t.then(function(){\r\n\t\t\t\t\t\t\tcallback(null);\r\n\t\t\t\t\t\t\tself.trigger(\"afterUpdate\");\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.catch(function(err){\r\n\t\t\t\t\t\t\tcallback(err);\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t},\r\n\r\n\r\n\t\t\"__movDataModelDefaultFields\": {\r\n\t\t\t\"MMID\":\t\t\t{\"type\": \"N\"},\r\n\t\t\t\"MMPID\":\t\t{\"type\": \"N\"},\r\n\t\t\t\"IsDraft\":\t\t{\"type\": \"N\"},\r\n\t\t\t\"Tick\":\t\t\t{\"type\": \"N\"},\r\n\t\t\t\"Doc\":\t\t\t{\"type\": \"S\"},\r\n\t\t\t\"Doc1\":\t\t\t{\"type\": \"S\"},\r\n\t\t\t\"ParentDoc\":\t{\"type\": \"S\"},\r\n\t\t\t\"MMFlag\":\t\t{\"type\": \"S\"},\r\n\t\t\t\"InOut\":\t\t\t{\"type\": \"N\"},\r\n\t\t\t\"GSDate\":\t\t{\"type\": \"D\"},\r\n\t\t\t\"GSDate2\":\t\t{\"type\": \"D\"},\r\n\t\t\t\"Mark\":\t\t\t{\"type\": \"B\"},\r\n\t\t\t\"CodeOp\":\t\t{\"type\": \"S\"},\r\n\t\t\t\"CodeDc\":\t\t{\"type\": \"S\"},\r\n\t\t\t\"ExtCode\":\t\t{\"type\": \"S\"},\r\n\t\t\t\"Storage\":\t\t{\"type\": \"S\"},\r\n\t\t\t\"GS\":\t\t\t\t{\"type\": \"S\"},\r\n\t\t\t\"GSSpec\":\t\t{\"type\": \"S\"},\r\n\t\t\t\"GSExt\":\t\t\t{\"type\": \"N\"},\r\n\t\t\t\"Consigment\":{\"type\": \"N\"},\r\n\t\t\t\"Amount\":\t\t{\"type\": \"N\"},\r\n\t\t\t\"Rest\":\t\t\t{\"type\": \"N\"},\r\n\t\t\t\"RestSum\":\t\t{\"type\": \"N\"},\r\n\t\t\t\"Price\":\t\t\t{\"type\": \"N\"},\r\n\t\t\t\"PrimeCost\":\t{\"type\": \"N\"},\r\n\t\t\t\"Sum\":\t\t\t{\"type\": \"N\"},\r\n\t\t\t\"Sum2\":\t\t\t{\"type\": \"N\"},\r\n\t\t\t\"FirmProduct\":{\"type\": \"N\"},\r\n\t\t\t\"Remark\":\t\t{\"type\": \"S\"},\r\n\t\t\t\"NameAVR\":\t{\"type\": \"S\"},\r\n\t\t\t\"Agent2\":\t\t{\"type\": \"N\"},\r\n\t\t\t\"Manager2\":\t{\"type\": \"N\"},\r\n\t\t\t\"Performer\":\t{\"type\": \"N\"}\r\n\t\t},\r\n\r\n\r\n\t\t\"save\": function(A){\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tif (typeof A != \"object\") A = Object.create(null);\r\n\r\n\t\t\t// Ответ\r\n\t\t\t// var callback = (typeof A.callback == \"function\" ? A.callback : function(){});\r\n\r\n\t\t\t// Подключение к БД\r\n\t\t\tvar dbawws = getContextDB.call(this); // DBModel.prototype.getInstance();\r\n\r\n\t\t\tvar DBq = [\r\n\t\t\t\t\"SELECT MMID, GSDate FROM Movement WHERE MMID = \" + ( isNaN(this.get(\"MMID\")) ? '-1' : this.get(\"MMID\") ) ,\r\n\t\t\t\t\"SELECT MAX(MMID)+1 as NEW_MMID FROM Movement\"\r\n\t\t\t\t// \"SELECT ExtClass FROM Ps_property WHERE ExtClass IS NOT NULL AND pid = \" + this.get(\"MMID\")\r\n\t\t\t];\r\n\r\n\t\t\t/**\r\n\t\t\t * Проверка: есть ли записи с указанным MMID, если уже есть, выполнить обновление\r\n\t\t\t * При отсутствии выполняется новая запись.\r\n\t\t\t */\r\n\t\t\tdbawws.dbquery({\r\n\t\t\t\t\"query\" : DBq.join(\";\"),\r\n\t\t\t\t\"callback\" : function(dbres){\r\n\r\n\t\t\t\t\tif (!dbres[0].recs.length){\r\n\t\t\t\t\t\t// Новая запись\r\n\t\t\t\t\t\tconsole.log(\"INSERT\");\r\n\r\n\t\t\t\t\t\tself.set(\"MMID\",dbres[1].recs[0].NEW_MMID);\r\n\r\n\t\t\t\t\t\tself.insert(A);\r\n\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// Обновление\r\n\t\t\t\t\t\tconsole.log(\"UPDATE\");\r\n\t\t\t\t\t\tself.update(A);\r\n\r\n\t\t\t\t\t} // close.if.update\r\n\r\n\t\t\t\t} // close.callback\r\n\r\n\t\t\t}); // close.dbquery\r\n\t\t}\r\n\r\n\r\n\t}\r\n);\r\n\r\nmodule.exports = MovDataModel;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./fabula-object-model/data-models/MovDataModel.js\n ** module id = 7\n ** module chunks = 0\n **/","// ------------------------------------------------------\r\n// Прототип модели данных\r\n\r\nvar InterfaceEvents = require(\"./InterfaceEvents\");\r\n\r\nvar _objectsPrototyping = function(){\r\n\tvar tmp, c, prop;\r\n\r\n\tif (arguments.length < 2) return;\r\n\r\n\tvar main = arguments[0];\r\n\r\n\tfor(c=1; c<arguments.length; c++) {\r\n\r\n\t\tif (typeof arguments[c] != \"object\") continue;\r\n\r\n\t\ttmp = {};\r\n\r\n\t\t// var ownProps = Object.getOwnPropertyNames(arguments[c]);\r\n\t\t// var enumOwnProps = Object.keys(arguments[c]);\r\n\r\n\t\tfor(prop in arguments[c]){\r\n\r\n\t\t\tif (  !arguments[c].hasOwnProperty(prop)  ) continue;\r\n\r\n\t\t\ttmp[prop] = {\r\n\t\t\t\t\"writable\": true,\r\n\t\t\t\t\"configurable\": true,\r\n\t\t\t\t\"enumerable\": true,\r\n\t\t\t\t\"value\": arguments[c][prop]\r\n\t\t\t};\r\n\r\n\t\t}\r\n\r\n\t\tmain = Object.create(main, tmp);\r\n\r\n\t}\r\n\r\n\treturn main;\r\n};\r\n\r\nvar DefaultDataModel = function(){\r\n\r\n\tthis.props \t\t\t\t\t\t= Object.create(null);\r\n\tthis.aliases \t\t\t\t\t\t= Object.create(null);\r\n\tthis.aliases.get \t\t\t\t= Object.create(null);\r\n\tthis.aliases.getMethods \t= Object.create(null);\r\n\tthis.aliases.set \t\t\t\t= Object.create(null);\r\n\tthis.aliases.setMethods \t= Object.create(null);\r\n\tthis.propsChanged \t\t\t= Object.create(null);\r\n\r\n\tthis._DataModelSettings = {\r\n\t\t\"caseSensitiveProps\": false\r\n\t};\r\n\r\n\tInterfaceEvents.call(this);\r\n\r\n\tthis.on(\"set\", this._defaultEventSet);\r\n\r\n\tthis.on(\"get\", this._defaultEventGet);\r\n\r\n\tthis.clearChanged();\r\n\r\n};\r\n\r\n// TODO Пересмотреть алиасы. добавить return\r\nDefaultDataModel.prototype = _objectsPrototyping(\r\n\tInterfaceEvents.prototype,\r\n\t{\r\n\r\n\t\t\"_objectsPrototyping\": _objectsPrototyping,\r\n\r\n\r\n\t\t\"_defaultEventSet\": function(obj, e){\r\n\t\t\tthis.trigger(e.type, e);\r\n\t\t},\r\n\r\n\r\n\t\t\"_defaultEventGet\": function(obj, e){\r\n\t\t\tthis.trigger(e.type, e);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * @param {String} purpose\r\n\t\t * @param {String} key - старый ключ\r\n\t\t * @param {String,Function} alias - новый ключ\r\n\t\t * */\r\n\t\t\"setAlias\": function(purpose, key, alias){\r\n\t\t\t// key - старый ключ\r\n\t\t\t// alias - новый ключ\r\n\r\n\t\t\tif (typeof purpose != \"string\") return;\r\n\t\t\t// if (typeof alias != \"string\") return;\r\n\t\t\tif (typeof key != \"string\") return;\r\n\r\n\t\t\tif (!this._DataModelSettings.caseSensitiveProps){\r\n\t\t\t\tkey = key.toLowerCase();\r\n\t\t\t\tif (typeof alias == \"string\"){\r\n\t\t\t\t\talias = alias.toLowerCase();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (purpose == \"get\") {\r\n\t\t\t\tthis.aliases.get[alias] = key;\r\n\r\n\t\t\t} else if (\r\n\t\t\t\tpurpose == \"getMethod\"\r\n\t\t\t\t&& typeof alias == \"function\"\r\n\t\t\t){\r\n\t\t\t\tthis.aliases.getMethods[key] = alias;\r\n\r\n\t\t\t} else if ( purpose == \"set\" ) {\r\n\t\t\t\tthis.aliases.set[alias] = key;\r\n\r\n\t\t\t} else if (\r\n\t\t\t\tpurpose == \"setMethod\"\r\n\t\t\t\t&& typeof alias == \"function\"\r\n\t\t\t) {\r\n\t\t\t\tthis.aliases.setMethods[key] = alias;\r\n\r\n\t\t\t}\r\n\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * @param {String} key\r\n\t\t * @param {Object} arg\r\n\t\t * @param {*} useEvent\r\n\t\t * */\r\n\t\t\"get\" : function(key, arg, useEvent){\r\n\r\n\t\t\tif (typeof key != \"string\") return;\r\n\r\n\t\t\tif (!this._DataModelSettings.caseSensitiveProps){\r\n\t\t\t\tkey = key.toLowerCase();\r\n\t\t\t}\r\n\r\n\t\t\tif ( typeof this.aliases.get[key] == \"string\" ) {\r\n\t\t\t\tkey = this.aliases.get[key];\r\n\t\t\t}\r\n\r\n\t\t\tif (  typeof useEvent == \"undefined\"  ) useEvent = true;\r\n\r\n\t\t\tif (  useEvent  ){\r\n\t\t\t\tthis.trigger(\"get:\"+key);\r\n\t\t\t}\r\n\r\n\t\t\tif ( typeof this.aliases.getMethods[key] != \"undefined\" ) {\r\n\r\n\t\t\t\tif (typeof arg == \"undefined\") arg = Object.create(null);\r\n\r\n\t\t\t\tif (  typeof this.aliases.getMethods[key] == \"string\"  ){\r\n\r\n\t\t\t\t\tkey = this.aliases.getMethods[key];\r\n\r\n\t\t\t\t\tif (typeof this[key] != \"function\") return;\r\n\r\n\t\t\t\t\treturn this[key].apply(this, [arg]);\r\n\r\n\t\t\t\t} else if (  typeof this.aliases.getMethods[key] == \"function\"  ) {\r\n\r\n\t\t\t\t\treturn this.aliases.getMethods[key].apply(this, [arg]);\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( typeof this.props[key] != \"undefined\" ) {\r\n\t\t\t\treturn this.props[key];\r\n\t\t\t}\r\n\t\t},\r\n\r\n\r\n\t\t/**\r\n\t\t * @param {String} key - ключ\r\n\t\t * @param value - значение\r\n\t\t * @param {Object} arg - доп. аргументы, к примеру, на случай если ключ возвращается из функции.\r\n\t\t * @param {*} useEvent\r\n\t\t * */\r\n\t\t\"set\" : function(key, value, arg, useEvent){\r\n\r\n\t\t\tif (typeof key == \"undefined\") return false;\r\n\r\n\t\t\t// Множественное присваивание\r\n\t\t\tif ( typeof key == \"object\" ){\r\n\t\t\t\tvar return_ = Object.create(null);\r\n\t\t\t\tfor(var prop in key){\r\n\t\t\t\t\tif (!key.hasOwnProperty(prop)) continue;\r\n\t\t\t\t\treturn_[prop] = this.set(prop, key[prop]);\r\n\t\t\t\t}\r\n\t\t\t\treturn return_;\r\n\t\t\t}\r\n\r\n\t\t\tif (typeof key != \"string\") return false;\r\n\r\n\t\t\tif (!this._DataModelSettings.caseSensitiveProps){\r\n\t\t\t\tkey = key.toLowerCase();\r\n\t\t\t}\r\n\r\n\t\t\tif ( typeof this.aliases.set[key] == \"string\" ) {\r\n\t\t\t\tkey = this.aliases.set[key];\r\n\t\t\t}\r\n\r\n\t\t\t// ........................................\r\n\r\n\t\t\tif (  typeof useEvent == \"undefined\"  ) useEvent = true;\r\n\r\n\t\t\tif (useEvent) {\r\n\t\t\t\tvar eventBefore = this._createEvent(\"set:\" + key, {\"value\": value, \"argument\": arg}); // createEvent(\"set:\" + key);\r\n\t\t\t\tvar eventAfter = this._createEvent(\"afterset:\" + key, {\"value\": value, \"argument\": arg}); // createEvent(\"afterset:\" + key);\r\n\t\t\t\tthis.trigger(eventBefore.type, eventBefore);\r\n\t\t\t}\r\n\r\n\t\t\t// ........................................\r\n\r\n\t\t\t/*\r\n\t\t\t* Логичный вопрос: почему не присваивать\r\n\t\t\t* результат работы метод-алиса по передаваемому в аргументе ключу?\r\n\t\t\t* Ответ: результат работы метода может быть не одно значение\r\n\t\t\t* и присваиваться оно может не по собственному ключу а сразу по нескольким\r\n\t\t\t* */\r\n\t\t\tvar ret = true;\r\n\r\n\t\t\tif (  typeof this.aliases.setMethods[key] != \"undefined\"  ) {\r\n\r\n\t\t\t\tif (typeof arg == \"undefined\") arg = Object.create(null);\r\n\r\n\t\t\t\tif (typeof this.aliases.setMethods[key] == \"string\") {\r\n\t\t\t\t\tvar methodKey = this.aliases.setMethods[key];\r\n\t\t\t\t\tif (typeof this[methodKey] != \"function\") {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.propsChanged[key] = true;\r\n\t\t\t\t\tret = this[methodKey].apply(this, [value, arg]);\r\n\r\n\t\t\t\t} else if (  typeof this.aliases.setMethods[key] == \"function\"  ) {\r\n\t\t\t\t\tthis.propsChanged[key] = true;\r\n\t\t\t\t\tret = this.aliases.setMethods[key].apply(this, [value, arg]);\r\n\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn false\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\t\t\t\tthis.propsChanged[key] = true;\r\n\t\t\t\tthis.props[key] = value;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif (useEvent){\r\n\t\t\t\tthis.trigger(eventAfter.type, eventAfter);\r\n\t\t\t}\r\n\r\n\t\t\treturn ret || true;\r\n\t\t},\r\n\r\n\r\n\t\t\"getChanged\": function(){\r\n\t\t\tvar tmp = [];\r\n\t\t\tfor(var prop in this.propsChanged){\r\n\t\t\t\tif (typeof this.propsChanged.hasOwnProperty == \"function\"){\r\n\t\t\t\t\tif (!this.propsChanged.hasOwnProperty(prop)) continue;\r\n\t\t\t\t}\r\n\t\t\t\ttmp.push(prop);\r\n\t\t\t}\r\n\t\t\treturn tmp;\r\n\t\t},\r\n\r\n\r\n\t\t\"clearChanged\": function(){\r\n\t\t\tthis.propsChanged = Object.create(null);\r\n\t\t}\r\n\r\n\r\n\t}\r\n);\r\n\r\nmodule.exports = DefaultDataModel;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./fabula-object-model/data-models/DefaultDataModel.js\n ** module id = 8\n ** module chunks = 0\n **/","var IEvent = require(\"./IEvent\");\r\n\r\n// Хак для nodejs\r\nif (typeof CustomEvent == \"undefined\") var CustomEvent = IEvent;\r\nif (typeof Event == \"undefined\") var Event = IEvent;\r\n\r\nvar EventsInterface = function(){\r\n\tthis._events = {};\r\n};\r\n\r\nEventsInterface.prototype = {\r\n\r\n\t\"trigger\": function(eventName, e){\r\n\r\n\t\tif (typeof eventName != \"string\") return false;\r\n\r\n\t\teventName = eventName.toLowerCase();\r\n\r\n\t\tif (\r\n\t\t\ttypeof this._events[eventName] == \"object\"\r\n\t\t\t&& Array.isArray(this._events[eventName])\r\n\t\t){\r\n\r\n\t\t\tif (\r\n\t\t\t\te instanceof IEvent\r\n\t\t\t\t&& e instanceof CustomEvent === false\r\n\t\t\t\t&& e instanceof Event === false\r\n\t\t\t){\r\n\t\t\t\te = this._createEvent(eventName);\r\n\t\t\t}\r\n\r\n\t\t\tvar events = this._events[eventName];\r\n\r\n\t\t\tfor(var c=0; c<events.length; c++){\r\n\r\n\t\t\t\tif (typeof events[c] != \"function\") continue;\r\n\r\n\t\t\t\tvar event = events[c];\r\n\r\n\t\t\t\tif (events[c].isOnce){\r\n\t\t\t\t\tthis._removeListener(eventName, events[c]._unique_id);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tevent.apply(this,[this, e]);\r\n\r\n\t\t\t\tevent = null;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\r\n\t\"on\": function(eventName, fx){\r\n\t\t// var c, self = this;\r\n\r\n\t\tif (\r\n\t\t\ttypeof eventName != \"string\"\r\n\t\t\t|| typeof fx != \"function\"\r\n\t\t) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\teventName = eventName.toLowerCase();\r\n\r\n\t\tif (\r\n\t\t\ttypeof this._events[eventName] != \"object\"\r\n\t\t\t|| !Array.isArray(this._events[eventName])\r\n\t\t){\r\n\r\n\t\t\tthis._events[eventName] = [];\r\n\r\n\t\t}\r\n\r\n\t\tfx._unique_id = Math.round(Math.random() * Math.pow(10,18));\r\n\r\n\t\tif (  typeof fx.isOnce == \"undefined\"  ) fx.isOnce = false;\r\n\r\n\t\tthis._events[eventName].push(fx);\r\n\r\n\t\treturn true;\r\n\r\n\t},\r\n\r\n\r\n\t\"_removeListener\": function(eventName, _unique_id){\r\n\t\tif (typeof _unique_id == \"undefined\"){\r\n\t\t\tthis._events[eventName] = [];\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (\r\n\t\t\ttypeof this._events[eventName] == \"object\"\r\n\t\t\t&& Array.isArray(this._events[eventName])\r\n\t\t){\r\n\t\t\tvar tmp = [];\r\n\t\t\tvar events = this._events[eventName];\r\n\t\t\tfor(var c=0; c<events.length; c++){\r\n\t\t\t\tif (events[c]._unique_id == _unique_id){\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\ttmp.push(events[c])\r\n\t\t\t}\r\n\t\t\tthis._events[eventName] = tmp;\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t/**\r\n\t * ������� �������\r\n\t * @param {String} name\r\n\t * @param {Object=} param\r\n\t * */\r\n\t\"_createEvent\": function(name, param){\r\n\t\tif (  typeof document != \"object\"  ){\r\n\t\t\treturn new IEvent(name);\r\n\t\t}\r\n\t\tvar EventConstructor = CustomEvent || Event;\r\n\t\tvar event = new EventConstructor(name);\r\n\r\n\t\tif (typeof param == \"object\"){\r\n\t\t\tfor(var prop in param){\r\n\t\t\t\tif (  param.hasOwnProperty  ){\r\n\t\t\t\t\tif (  !param.hasOwnProperty(prop)  ) continue;\r\n\t\t\t\t}\r\n\t\t\t\tevent[prop] = param[prop];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn event;\r\n\t},\r\n\r\n\r\n\t\"getListeners\": function(eventName){\r\n\t\tif (typeof eventName != \"string\"){\r\n\t\t\treturn [];\r\n\t\t}\r\n\t\tif (  typeof this._events[eventName] != \"object\"  ){\r\n\t\t\treturn [];\r\n\t\t}\r\n\t\treturn this._events[eventName];\r\n\t},\r\n\r\n\r\n\t\"once\": function(eventName, fx){\r\n\t\tif (\r\n\t\t\ttypeof fx != \"function\"\r\n\t\t\t|| typeof eventName != \"string\"\r\n\t\t){\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tfx.isOnce = true;\r\n\t\tthis.on(eventName, fx);\r\n\t\treturn true;\r\n\t}\r\n\r\n};\r\n\r\nmodule.exports = EventsInterface;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./fabula-object-model/data-models/InterfaceEvents.js\n ** module id = 9\n ** module chunks = 0\n **/","// TODO IEvent\r\n\r\nvar IEvent = function(type){\r\n\tif (typeof type != \"string\"){\r\n\t\tthrow new Error(\"1st argument suppose to be String\");\r\n\t}\r\n\tthis.type\t\t\t\t\t= type;\r\n\tthis.timestamp\t\t\t= Date.now();\r\n\tthis.currentTarget\t\t= null;\r\n\tthis.cancelable\t\t\t\t= false;\r\n\tthis.detail\t\t\t\t\t= null;\r\n\tthis.eventPhase\t\t\t= null;\r\n\tthis.target\t\t\t\t\t= null;\r\n};\r\n\r\nmodule.exports = IEvent;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./fabula-object-model/data-models/IEvent.js\n ** module id = 10\n ** module chunks = 0\n **/","var InterfaceEvents = require(\"./InterfaceEvents\");\r\nvar DefaultDataModel = require(\"./DefaultDataModel\");\r\nvar ObjectA = require(\"./ObjectA\");\r\n\r\nvar propUtils = {\r\n\t\"duplicateProperty\": function(property){\r\n\t\tvar keys = Object.getOwnPropertyNames(property);\r\n\t\tvar duplicate = {};\r\n\t\tfor(var c=0; c<keys.length; c++){\r\n\t\t\tduplicate[keys[c]] = property[keys[c]];\r\n\t\t}\r\n\t},\r\n\r\n\t\"toLowerCaseKeys\": function(property){\r\n\t\tvar keys = Object.getOwnPropertyNames(property);\r\n\t\tvar lowerProperty = {};\r\n\t\tfor(var c=0; c<keys.length; c++){\r\n\t\t\tlowerProperty[keys[c].toLowerCase()] = property[keys[c]];\r\n\t\t}\r\n\t\treturn lowerProperty;\r\n\t},\r\n\r\n\t// Запускается через изм. контекст call, apply\r\n\t\"setChanged\": function(property){\r\n\t\tvar propName;\r\n\r\n\t\tif (  typeof property == \"string\"  ) {\r\n\t\t\tpropName = property;\r\n\r\n\t\t} else if (  typeof property == \"object\"  ){\r\n\t\t\tproperty = propUtils.toLowerCaseKeys(property);\r\n\r\n\t\t\tif (  typeof property.property == \"string\"  ){\r\n\t\t\t\tpropName = property.property;\r\n\r\n\t\t\t} else {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tpropName = propName.toLowerCase();\r\n\r\n\t\tif (  this._changedFProperty.indexOf(propName) == -1  ){\r\n\t\t\tthis._changedFProperty.push(propName);\r\n\t\t}\r\n\t}\r\n};\r\n\r\nvar InterfaceFProperty = function(){\r\n\tthis._property = [];\r\n\tthis._changedFProperty = [];\r\n\r\n\tInterfaceEvents.call(this);\r\n};\r\n\r\nInterfaceFProperty.prototype = DefaultDataModel.prototype._objectsPrototyping(\r\n\tInterfaceEvents.prototype,\r\n\t{\r\n\r\n\t\t\"_interfaceFPropertyFields\": {\r\n\t\t\t\"uid\"\t\t\t:{\"type\":\"integer\"},\r\n\t\t\t\"pid\"\t\t\t:{\"type\":\"integer\"},\r\n\t\t\t\"sort\"\t\t\t:{\"type\":\"integer\"},\r\n\t\t\t\"value\"\t\t:{\"type\":\"string\"},\r\n\t\t\t\"valuetype\":{\"type\":\"string\"},\r\n\t\t\t\"extclass\"\t:{\"type\":\"string\"},\r\n\t\t\t\"extid\"\t\t:{\"type\":\"string\"},\r\n\t\t\t\"property\"\t:{\"type\":\"string\"},\r\n\t\t\t\"tick\"\t\t\t:{\"type\":\"integer\"}\r\n\t\t},\r\n\r\n\r\n\t\t\"splitProperty\": function(property){\r\n\t\t\tif (  typeof property != \"object\"  ) return null;\r\n\r\n\t\t\t/*\r\n\t\t\tvar dFn = function(str, d){\r\n\t\t\t\tstr = str+\"\";\r\n\t\t\t\tvar\r\n\t\t\t\t\ttmp = [],\r\n\t\t\t\t\tstr_ = \"\",\r\n\t\t\t\t\tb = Math.floor(str.length / d);\r\n\t\t\t\tfor(var c=0; c<str.length; c++){\r\n\t\t\t\t\tstr_ += str[c];\r\n\t\t\t\t\tif (str_.length >= b || c == str.length - 1){\r\n\t\t\t\t\t\ttmp.push(str_);\r\n\t\t\t\t\t\tstr_ = \"\";\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn tmp;\r\n\t\t\t};\r\n\t\t\t*/\r\n\r\n\t\t\tvar dFn = function(str, L){\r\n\t\t\t\tstr = str+\"\";\r\n\t\t\t\tvar\r\n\t\t\t\t\ttmp = [],\r\n\t\t\t\t\tstr_ = \"\";\r\n\t\t\t\tfor(var c=0; c<str.length; c++){\r\n\t\t\t\t\tstr_ += str[c];\r\n\t\t\t\t\tif (str_.length >= L || c == str.length - 1){\r\n\t\t\t\t\t\ttmp.push(str_);\r\n\t\t\t\t\t\tstr_ = \"\";\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn tmp;\r\n\t\t\t};\r\n\r\n\t\t\tvar c, value, tmp;\r\n\t\t\tvar limit = 120;\r\n\r\n\t\t\tvar lowProperty = propUtils.toLowerCaseKeys(property);\r\n\r\n\t\t\tif (  !lowProperty.hasOwnProperty(\"value\")  ) {\r\n\t\t\t\tlowProperty.value = \"\";\r\n\t\t\t\tvalue = \"\";\r\n\t\t\t} else {\r\n\t\t\t\tvalue = lowProperty.value;\r\n\t\t\t}\r\n\r\n\t\t\tvar words = [];\r\n\t\t\tvar props = [];\r\n\t\t\tvar count = 0;\r\n\t\t\tvar dProperty;\r\n\r\n\t\t\tvalue = value.split(\" \");\r\n\r\n\t\t\ttmp = [];\r\n\r\n\t\t\tfor(c=0; c<value.length; c++){\r\n\t\t\t\tif (  value[c].length > limit  ){\r\n\t\t\t\t\ttmp = tmp.concat(dFn(value[c], limit));\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\ttmp.push(value[c]);\r\n\t\t\t}\r\n\r\n\t\t\tvalue = tmp;\r\n\r\n\t\t\tfor(c=0; c<value.length; c++){\r\n\t\t\t\twords.push(value[c]);\r\n\t\t\t\tcount+=value[c].length;\r\n\t\t\t\tif (\r\n\t\t\t\t\tcount + (value.hasOwnProperty(c+1) ? value[c+1].length : 0) > limit\r\n\t\t\t\t\t|| c == value.length - 1\r\n\t\t\t\t){\r\n\t\t\t\t\tdProperty = propUtils.toLowerCaseKeys(lowProperty);\r\n\t\t\t\t\tdProperty.value = words.join(\" \");\r\n\t\t\t\t\tprops.push(dProperty);\r\n\t\t\t\t\twords = [];\r\n\t\t\t\t\tcount = 0;\r\n\t\t\t\t}\r\n\t\t\t\tcount+=value[c].length;\r\n\t\t\t}\r\n\r\n\t\t\treturn props;\r\n\t\t},\r\n\r\n\r\n\t\t\"addProperty\": function(property){\r\n\r\n\t\t\tvar existsFields = [], prop, type, value, lowName;\r\n\r\n\t\t\tvar tmp = {};\r\n\r\n\t\t\tthis.trigger(\"addProperty\");\r\n\r\n\t\t\tif (!property || typeof property != \"object\") return false;\r\n\r\n\t\t\tif (  Array.isArray(property)  ){\r\n\t\t\t\tfor(var c=0; c<property.length; c++){\r\n\t\t\t\t\tthis.addProperty(property[c]);\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\tfor(prop in property){\r\n\t\t\t\tif (typeof property.hasOwnProperty == \"function\"){\r\n\t\t\t\t\tif (  !property.hasOwnProperty(prop)  ) continue;\r\n\t\t\t\t}\r\n\t\t\t\tif (typeof property[prop] == \"undefined\") continue;\r\n\r\n\t\t\t\tlowName = prop.toLowerCase();\r\n\t\t\t\texistsFields.push(lowName);\r\n\r\n\t\t\t\tif (  !this._interfaceFPropertyFields.hasOwnProperty(lowName)  ) continue;\r\n\r\n\t\t\t\ttype = this._interfaceFPropertyFields[lowName].type;\r\n\t\t\t\tvalue = property[prop];\r\n\r\n\t\t\t\tif (type == \"integer\" && typeof value == \"string\"){\r\n\t\t\t\t\tif (  value.match(/\\D/g)  ) continue;\r\n\t\t\t\t\tif ((value+\"\").trim() === \"\") continue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttmp[lowName] = value;\r\n\t\t\t}\r\n\r\n\t\t\tfor(prop in this._interfaceFPropertyFields){\r\n\t\t\t\tif (!this._interfaceFPropertyFields.hasOwnProperty(prop)) continue;\r\n\t\t\t\tlowName = prop.toLowerCase();\r\n\t\t\t\tif (  !tmp.hasOwnProperty(lowName)  ) tmp[lowName] = null;\r\n\t\t\t}\r\n\r\n\t\t\tproperty = tmp;\r\n\r\n\t\t\tif (  !property.hasOwnProperty(\"valuetype\") || !property.valuetype  ){\r\n\t\t\t\tif (  isNaN(property.value)  ){\r\n\t\t\t\t\tproperty.valuetype = \"C\";\r\n\t\t\t\t} else {\r\n\t\t\t\t\tproperty.valuetype = \"N\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Изменен\r\n\t\t\tpropUtils.setChanged.call(this, property);\r\n\r\n\t\t\tthis._property.push(property);\r\n\t\t},\r\n\r\n\r\n\t\t\"appendProperty\": function(){\r\n\t\t\tthis.addProperty.apply(this, arguments);\r\n\t\t},\r\n\r\n\r\n\t\t\"updateProperty\": function(getKeyValue, setKeyValue){\r\n\t\t\tif (typeof getKeyValue != \"object\" || !getKeyValue) return;\r\n\t\t\tif (typeof setKeyValue != \"object\" || !setKeyValue) return;\r\n\t\t\tvar setKeyValue_ = {};\r\n\t\t\tvar c, v, keys, lowKey;\r\n\r\n\t\t\tkeys = Object.getOwnPropertyNames(setKeyValue);\r\n\t\t\tfor(c=0; c<keys.length; c++){\r\n\t\t\t\tlowKey = keys[c].toLowerCase();\r\n\t\t\t\tsetKeyValue_[lowKey] = setKeyValue[keys[c]];\r\n\t\t\t}\r\n\r\n\t\t\tvar props = this.getProperty(getKeyValue);\r\n\t\t\tvar isUpdated = false;\r\n\r\n\t\t\tfor(c=0; c<props.length; c++){\r\n\t\t\t\tkeys = Object.getOwnPropertyNames(props[c]);\r\n\t\t\t\tfor(v=0; v<keys.length; v++){\r\n\t\t\t\t\tlowKey = keys[v].toLowerCase();\r\n\t\t\t\t\tif (  !setKeyValue_.hasOwnProperty(lowKey)  ) continue;\r\n\t\t\t\t\tisUpdated = true;\r\n\t\t\t\t\tprops[c][keys[v]] = setKeyValue_[lowKey];\r\n\t\t\t\t}\r\n\t\t\t\t// Изменен\r\n\t\t\t\tpropUtils.setChanged.call(this, props[c]);\r\n\t\t\t}\r\n\r\n\t\t\treturn isUpdated;\r\n\t\t},\r\n\r\n\r\n\t\t\"upsertProperty\": function(getKeyValue, insProperty){\r\n\t\t\tvar filterProps = function(pr){\r\n\t\t\t\tvar tmp = [];\r\n\t\t\t\tfor(var c=0; c<pr.length; c++){\r\n\t\t\t\t\tif (typeof pr[c] != \"object\" || !pr[c]) continue;\r\n\t\t\t\t\ttmp.push(pr[c]);\r\n\t\t\t\t}\r\n\t\t\t\treturn tmp;\r\n\t\t\t};\r\n\r\n\t\t\tvar ownProperty, keys, c, v, lowKey, insProperty_;\r\n\r\n\t\t\tif (  arguments.length < 2  ) return false;\r\n\r\n\t\t\t// ------------------------------------------------------------------------------------\r\n\r\n\t\t\tif (  !Array.isArray(insProperty) && typeof insProperty == \"object\"  ){\r\n\t\t\t\tinsProperty = [insProperty];\r\n\r\n\t\t\t} else if (  Array.isArray(insProperty)  ) {\r\n\r\n\t\t\t} else {\r\n\t\t\t\treturn false;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// ------------------------------------------------------------------------------------\r\n\r\n\t\t\townProperty = this.getProperty(getKeyValue);\r\n\r\n\t\t\tinsProperty = filterProps(insProperty);\r\n\r\n\t\t\tfor(  c=0; ; c++  ){\r\n\r\n\t\t\t\t// Условие выхода из цикла\r\n\t\t\t\tif (\r\n\t\t\t\t\ttypeof insProperty[c] == \"undefined\"\r\n\t\t\t\t\t&& typeof ownProperty[c] == \"undefined\"\r\n\t\t\t\t){\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (\r\n\t\t\t\t\ttypeof insProperty[c] == \"object\"\r\n\t\t\t\t\t&& typeof ownProperty[c] == \"object\"\r\n\t\t\t\t){\r\n\r\n\t\t\t\t\tinsProperty_ = propUtils.toLowerCaseKeys(insProperty[c]);\r\n\r\n\t\t\t\t\tkeys = Object.getOwnPropertyNames(ownProperty[c]);\r\n\r\n\t\t\t\t\tfor(v=0; v<keys.length; v++){\r\n\t\t\t\t\t\tlowKey= keys[v].toLocaleLowerCase();\r\n\t\t\t\t\t\tif (  !insProperty_.hasOwnProperty(lowKey)  ) continue;\r\n\t\t\t\t\t\townProperty[c][keys[v]] = insProperty_[lowKey];\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Изменен\r\n\t\t\t\t\tpropUtils.setChanged.call(this, ownProperty[c]);\r\n\r\n\t\t\t\t} else if (  typeof insProperty[c] == \"object\"  ) {\r\n\r\n\t\t\t\t\tthis.addProperty(insProperty[c]);\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn true;\r\n\r\n\t\t},\r\n\r\n\r\n\t\t/**\r\n\t\t * @return {Array}\r\n\t\t * @param {Object} keyValue\r\n\t\t * */\r\n\t\t\"getProperty\": function(keyValue){\r\n\t\t\tvar props = [];\r\n\r\n\t\t\tvar caseSens = false;\r\n\r\n\t\t\tvar skip, value1, value2, c, v, key, keys;\r\n\r\n\t\t\tthis.trigger(\"getProperty\");\r\n\r\n\t\t\tif (\r\n\t\t\t\t!arguments.length\r\n\t\t\t\t|| !keyValue\r\n\t\t\t\t|| !Object.getOwnPropertyNames(keyValue).length\r\n\t\t\t){\r\n\t\t\t\treturn this._property;\r\n\t\t\t}\r\n\r\n\t\t\tif (typeof keyValue != \"object\") {\r\n\t\t\t\tthrow new Error(\"1st argument suppose to be type \\\"Object\\\"\");\r\n\t\t\t}\r\n\r\n\t\t\tfor(c=0; c<this._property.length; c++){\r\n\t\t\t\tskip = 0;\r\n\r\n\t\t\t\tif (\r\n\t\t\t\t\ttypeof this._property[c] != \"object\"\r\n\t\t\t\t\t|| !this._property[c]\r\n\t\t\t\t){\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar propObjA = new ObjectA(this._property[c]);\r\n\r\n\t\t\t\tkeys = Object.getOwnPropertyNames(keyValue);\r\n\r\n\t\t\t\tfor(v=0; v<keys.length; v++){\r\n\t\t\t\t\tkey = keys[v].toLowerCase();\r\n\r\n\t\t\t\t\tif (  !propObjA.has(key)  ) skip = 1;\r\n\r\n\t\t\t\t\tvalue1 = propObjA.get(key);\r\n\t\t\t\t\tvalue2 = keyValue[keys[v]];\r\n\r\n\t\t\t\t\tif (!caseSens){\r\n\t\t\t\t\t\tvalue1 = typeof value1 == \"string\" ? value1.toLowerCase() : value1;\r\n\t\t\t\t\t\tvalue2 = typeof value2 == \"string\" ? value2.toLowerCase() : value2;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (  value1 != value2  ) skip = 1;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (skip) continue;\r\n\r\n\t\t\t\tprops.push(this._property[c]);\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn props;\r\n\t\t},\r\n\r\n\r\n\t\t\"getChangedProperty\": function(){\r\n\t\t\treturn this._changedFProperty;\r\n\t\t},\r\n\r\n\r\n\t\t\"clearChangedProperty\": function(){\r\n\t\t\tthis._changedFProperty = [];\r\n\t\t},\r\n\r\n\r\n\t\t\"removeProperty\": function(keyValue){\r\n\t\t\tvar props = [];\r\n\r\n\t\t\tif (typeof keyValue != \"object\") return false;\r\n\r\n\t\t\tvar skip, existsFields, prop, value1, value2;\r\n\r\n\t\t\tvar caseSens = false;\r\n\r\n\t\t\tthis.trigger(\"removeProperty\");\r\n\r\n\t\t\tif (\r\n\t\t\t\t!arguments.length\r\n\t\t\t\t|| !keyValue\r\n\t\t\t\t|| !Object.getOwnPropertyNames(keyValue).length\r\n\t\t\t){\r\n\t\t\t\tthis._property = [];\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\tfor(var c=0; c<this._property.length; c++){\r\n\t\t\t\tskip = 1;\r\n\r\n\t\t\t\texistsFields = {};\r\n\r\n\t\t\t\tfor(prop in this._property[c]){\r\n\t\t\t\t\tif (  typeof this._property[c].hasOwnProperty == \"function\"  ){\r\n\t\t\t\t\t\tif (  !this._property[c].hasOwnProperty(prop)  ) continue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (typeof this._property[c][prop] == \"undefined\") continue;\r\n\t\t\t\t\texistsFields[prop.toLowerCase()] = this._property[c][prop];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor(prop in keyValue){\r\n\t\t\t\t\tif (  typeof keyValue.hasOwnProperty == \"function\"  ){\r\n\t\t\t\t\t\tif (  !keyValue.hasOwnProperty(prop)  ) continue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (typeof keyValue[prop] == \"undefined\") continue;\r\n\r\n\t\t\t\t\tif (  !existsFields.hasOwnProperty(prop.toLowerCase())  ) continue;\r\n\r\n\t\t\t\t\tvalue1 = existsFields[prop.toLowerCase()];\r\n\t\t\t\t\tvalue2 = keyValue[prop];\r\n\r\n\t\t\t\t\tif (!caseSens){\r\n\t\t\t\t\t\tvalue1 = typeof value1 == \"string\" ? value1.toLowerCase() : value1;\r\n\t\t\t\t\t\tvalue2 = typeof value2 == \"string\" ? value2.toLowerCase() : value2;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (  value1 != value2  ) skip = 0;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Изменен\r\n\t\t\t\tpropUtils.setChanged.call(this, this._property[c]);\r\n\r\n\t\t\t\tif (skip) continue;\r\n\r\n\t\t\t\tprops.push(this._property[c]);\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar isDeleted = this._property.length != props.length;\r\n\r\n\t\t\tthis._property = props;\r\n\r\n\t\t\treturn isDeleted;\r\n\t\t},\r\n\r\n\t\t\"deleteProperty\": function(){\r\n\t\t\treturn this.removeProperty.apply(this, arguments);\r\n\t\t}\r\n\r\n\t}\r\n);\r\n\r\nmodule.exports = InterfaceFProperty;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./fabula-object-model/data-models/InterfaceFProperty.js\n ** module id = 11\n ** module chunks = 0\n **/","/**\r\n * @Constructor\r\n * @param {Object} obj\r\n * */\r\nvar ObjectA = function(obj){\r\n\r\n\tif (this instanceof ObjectA === false){\r\n\t\tthrow new Error(\"Wrong context\");\r\n\t}\r\n\r\n\tthis._props = Object.create(null);\r\n\r\n\tif (!arguments.length) return;\r\n\r\n\tif (typeof obj != \"object\") {\r\n\t\tthrow new Error(\"Argument suppose to be type \\\"Object\\\"\");\r\n\t}\r\n\r\n\tvar keys = Object.getOwnPropertyNames(obj);\r\n\r\n\tfor(var c=0; c<keys.length; c++){\r\n\t\tthis.set(keys[c], obj[keys[c]]);\r\n\t}\r\n\r\n};\r\n\r\n/**\r\n * @param {Object} obj\r\n * */\r\nObjectA.create = function(obj){\r\n\r\n\treturn new ObjectA(obj);\r\n\r\n};\r\n\r\nObjectA.prototype = {\r\n\r\n\t/**\r\n\t * Возвращает все присвоенные ключи в объекте\r\n\t * */\r\n\t\"getKeys\": function(){\r\n\t\treturn Object.getOwnPropertyNames(this._props);\r\n\t},\r\n\r\n\t/**\r\n\t * Возвращает количество ключей\r\n\t * */\r\n\t\"getLength\": function(){\r\n\t\treturn this.getKeys().length;\r\n\t},\r\n\r\n\t/**\r\n\t * Возвращает значение по ключу\r\n\t * @param {String} key\r\n\t * */\r\n\t\"get\": function(key){\r\n\r\n\t\tif (typeof key != \"string\"){\r\n\t\t\tthrow new Error(\"Argument suppose to be type \\\"String\\\"\");\r\n\t\t}\r\n\r\n\t\tkey = key.toLowerCase();\r\n\r\n\t\treturn this.has(key) ? this._props[key] : void 0;\r\n\r\n\t},\r\n\r\n\t/**\r\n\t * Присваивает значенеи по ключу\r\n\t * @param {String} key\r\n\t * @param {all} value\r\n\t * */\r\n\t\"set\": function(key, value){\r\n\r\n\t\tif (arguments.length < 2){\r\n\t\t\tthrow new Error(\"Suppose to be 2 arguments\");\r\n\t\t}\r\n\r\n\t\tif (typeof key != \"string\"){\r\n\t\t\tthrow new Error(\"Argument suppose to be type \\\"String\\\"\");\r\n\t\t}\r\n\r\n\t\tthis._props[key.toLowerCase()] = value;\r\n\r\n\t},\r\n\r\n\t/**\r\n\t * Проверяет наличие ключа\r\n\t * @param {String} key\r\n\t * */\r\n\t\"has\": function(key){\r\n\t\tif (typeof key != \"string\"){\r\n\t\t\tthrow new Error(\"Argument suppose to be type \\\"String\\\"\");\r\n\t\t}\r\n\t\treturn Boolean(Object.getOwnPropertyDescriptor(this._props, key.toLowerCase()));\r\n\t},\r\n\r\n\t/**\r\n\t * Удаляет ключ\r\n\t * @param {String} key\r\n\t * */\r\n\t\"remove\": function(key){\r\n\t\tif (typeof key != \"string\"){\r\n\t\t\tthrow new Error(\"Argument suppose to be type \\\"String\\\"\");\r\n\t\t}\r\n\t\tdelete this._props[key.toLowerCase()];\r\n\t}\r\n\r\n};\r\n\r\nmodule.exports = ObjectA;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./fabula-object-model/data-models/ObjectA.js\n ** module id = 12\n ** module chunks = 0\n **/","var _utils = require(\"./../utils\");\r\n\r\n// Для совместимости\r\nvar getContextDB = function(){\r\n\tvar FabulaObjectModel = require(\"./../_FabulaObjectModel.js\");\r\n\tvar DBModel = FabulaObjectModel.prototype.DBModel;\r\n\r\n\tif (  this._fabulaInstance ){\r\n\t\treturn this._fabulaInstance.getDBInstance();\r\n\t}\r\n\treturn DBModel.prototype.getInstance();\r\n};\r\n\r\nvar TalksDataModel = function(){\r\n\r\n\tthis.instances.push(this);\r\n\t// this.db = DBModel.prototype.getInstance();\r\n\r\n};\r\n\r\nTalksDataModel.prototype = {\r\n\r\n\t\"instances\": [],\r\n\r\n\t\"postTalk\": function(A){\r\n\r\n\t\tif (typeof A != \"object\") A = Object.create(null);\r\n\t\t// var self\t\t\t\t= this;\r\n\t\tvar MMID\t\t\t= typeof A.MMID == \"undefined\" || isNaN(A.agent) ? null : parseInt(A.MMID);\r\n\t\tvar message\t\t= typeof A.message == \"string\" ? A.message : \"\" ;\r\n\t\tvar newMMFlag\t= typeof A.MMFlag == \"string\" ? A.MMFlag : \"\";\r\n\t\tvar agent\t\t\t= typeof A.agent == \"undefiend\" || isNaN(A.agent) ? 999 : A.agent ;\r\n\t\tvar callback\t\t\t= typeof A.callback == \"function\" ? A.callback : function(){};\r\n\r\n\t\tvar db = getContextDB.call(this);\r\n\r\n\t\tif (!db) {\r\n\t\t\tcallback(\"!db\");\r\n\t\t\tconsole.error(\"!db\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (typeof db.dbquery != \"function\") {\r\n\t\t\tcallback(\"!db\");\r\n\t\t\tconsole.error(\"!db\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (!MMID) return;\r\n\r\n\t\tdb.dbquery({\r\n\t\t\t\"query\": \"SELECT Txt FROM Talk WHERE Txt LIKE '%&rArr;%' AND MM = \" + MMID + \" ORDER BY TalkID DESC\",\r\n\t\t\t\"callback\": function(dbres){\r\n\r\n\t\t\t\tvar err = [];\r\n\r\n\t\t\t\tif (dbres.info.errors){\r\n\r\n\t\t\t\t\tif (\r\n\t\t\t\t\t\tArray.isArray(dbres.info.errors)\r\n\t\t\t\t\t\t&& dbres.info.errors.length\r\n\t\t\t\t\t){\r\n\t\t\t\t\t\terr = err.concat(dbres.info.errors);\r\n\r\n\t\t\t\t\t} else if (  typeof dbres.info.errors == \"string\"  ) {\r\n\t\t\t\t\t\terr.push(dbres.info.errors);\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcallback(err);\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar prevMMFlag = \"\";\r\n\r\n\t\t\t\tif (!dbres.recs.length){\r\n\t\t\t\t\tif (newMMFlag) prevMMFlag = newMMFlag;\r\n\r\n\t\t\t\t} else {\r\n\t\t\t\t\tprevMMFlag = dbres.recs[0].Txt.match(/(&rArr;).[0-9]/g);\r\n\t\t\t\t\tif (prevMMFlag){\r\n\t\t\t\t\t\tprevMMFlag = prevMMFlag[0];\r\n\t\t\t\t\t\tprevMMFlag = prevMMFlag[prevMMFlag.length - 1];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (!newMMFlag) newMMFlag = prevMMFlag;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tdb.dbquery({\r\n\t\t\t\t\t\"query\": \"\" +\r\n\t\t\t\t\t\"INSERT INTO Talk (Dt, Txt, Agent, [MM], [Tm], [Key]) \" +\r\n\t\t\t\t\t\"VALUES (DATE(), '\"+(!newMMFlag ? \"\" : \"Фаза: \" + prevMMFlag + ' &rArr; ' + newMMFlag )+'<br>'+_utils.DBSecureStr(message)+\"', \"+agent+\", \"+MMID+\",  FORMAT(TIME(),'HH:MM'), NOW())\",\r\n\r\n\t\t\t\t\t\"callback\": function(dbres){\r\n\t\t\t\t\t\tif (dbres.info.errors){\r\n\t\t\t\t\t\t\tif (Array.isArray(dbres.info.errors) && dbres.info.errors.length){\r\n\t\t\t\t\t\t\t\terr = err.concat(dbres.info.errors);\r\n\r\n\t\t\t\t\t\t\t} else if (typeof dbres.info.errors == \"string\") {\r\n\t\t\t\t\t\t\t\terr.push(dbres.info.errors);\r\n\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tcallback(err.length ? err : null);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t} // close.db.callback\r\n\t\t});\r\n\t},\r\n\r\n\r\n\t\"getTalks\": function(){},\r\n\r\n\r\n\t\"getInstance\": function(){\r\n\t\treturn this.instances.length ? this.instances[0] : new TalksDataModel();\r\n\t}\r\n};\r\n\r\nmodule.exports = TalksDataModel;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./fabula-object-model/data-models/TalksDataModel.js\n ** module id = 13\n ** module chunks = 0\n **/","var _utils = require(\"./../utils\");\r\nvar DefaultDataModel = require(\"./DefaultDataModel\");\r\nvar InterfaceFProperty = require(\"./InterfaceFProperty\");\r\nvar MovDataModel = require(\"./MovDataModel\");\r\n\r\n// Для совместимости\r\nvar getContextDB = function(){\r\n\tvar FabulaObjectModel = require(\"./../_FabulaObjectModel.js\");\r\n\tvar DBModel = FabulaObjectModel.prototype.DBModel;\r\n\r\n\tif (  this._fabulaInstance ){\r\n\t\treturn this._fabulaInstance.getDBInstance();\r\n\t}\r\n\treturn DBModel.prototype.getInstance();\r\n};\r\n\r\n// TODO пересмотреть алиасы\r\nvar DocDataModel = function(){\r\n\tDefaultDataModel.call(this);\r\n\tInterfaceFProperty.call(this);\r\n\r\n\t// var self = this;\r\n\r\n\tthis.set({\r\n\t\t\"Agent\":\t\t\tnull, // Integer\r\n\t\t\"Manager\":\t\t\tnull, // Integer\r\n\t\t\"Person\":\t\t\tnull, // String\r\n\t\t\"FirmContract\":\tnull, // Integer\r\n\t\t\"Sum1\":\t\t\t\tnull, // Float\r\n\t\t\"Debt\":\t\t\t\tnull, // Float\r\n\t\t\"DocID\":\t\t\tnull, // String\r\n\t\t\"DocType\":\t\t\tnull, // String\r\n\t\t\"Comment\":\t\tnull, // String\r\n\t\t\"Note\":\t\t\t\tnull // String\r\n\t});\r\n\r\n\t// this.setAlias(\"get\",\"Doc\",\"DocID\");\r\n\t// this.setAlias(\"set\",\"Doc\",\"DocID\");\r\n\r\n\tthis.on(\"set:docid\", this._eventSetDocID);\r\n\tthis.on(\"set:company\", this._eventSetCompany);\r\n\tthis.on(\"set:doctype\", this._eventSetDocType);\r\n\r\n\tthis.movs = [];\r\n\r\n\tthis.set(\"_unique_sid\", Math.random() * Math.pow(10,17));\r\n\r\n\tthis.clearChanged();\r\n\r\n\tif (  !this._RB_DOC_CACHE.length  ){\r\n\t\tthis._initRB_DOC_CACHE();\r\n\t}\r\n\r\n};\r\n\r\nDocDataModel.prototype = DefaultDataModel.prototype._objectsPrototyping(\r\n\tDefaultDataModel.prototype,\r\n\tInterfaceFProperty.prototype,\r\n\t{\r\n\r\n\t\t\"_docIDApply\": function(){\r\n\t\t\tfor(var c=0; c<this.movs.length; c++){\r\n\t\t\t\tif (!this.movs[c]) continue;\r\n\t\t\t\tif (  this.movs[c].get(\"Doc1\") != this.get(\"DocID\")  ) {\r\n\t\t\t\t\tthis.movs[c].set(\"Doc\", this.get(\"DocID\"));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\r\n\t\t\"_eventSetDocID\": function(self, e){\r\n\t\t\tif (\r\n\t\t\t\t!e.value\r\n\t\t\t\t|| typeof e.value != \"string\"\r\n\t\t\t\t|| e.value.length != 10\r\n\t\t\t){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tself = this;\r\n\t\t\tthis.parseDocID(\r\n\t\t\t\te.value,\r\n\t\t\t\tfunction(parsed){\r\n\t\t\t\t\tself.props.doctype = parsed.docType;\r\n\t\t\t\t\tself.props.company = parsed.company;\r\n\t\t\t\t\tself.propsChanged.doctype = true;\r\n\t\t\t\t\tself.propsChanged.company = true;\r\n\t\t\t\t\tself.movSet(\"Doc\", e.value);\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t},\r\n\r\n\r\n\t\t\"_eventSetCompany\": function(self, e){\r\n\t\t\tself = this;\r\n\t\t\tthis.parseDocID(\r\n\t\t\t\tthis.get(\"DocID\"),\r\n\t\t\t\tfunction(p){\r\n\t\t\t\t\tself.set(\"DocID\", e.value + p.year + p.prefix + p.code);\r\n\t\t\t\t\tself.movSet(\"Doc\", self.get(\"DocID\"));\r\n\t\t\t\t}\r\n\t\t\t)\r\n\t\t},\r\n\r\n\r\n\t\t\"_eventSetDocType\": function(self, e){\r\n\t\t\tself = this;\r\n\t\t\tthis.parseDocID(\r\n\t\t\t\tthis.get(\"DocID\"),\r\n\t\t\t\tfunction(p){\r\n\t\t\t\t\tvar docType = e.value;\r\n\t\t\t\t\tvar prefix = null;\r\n\t\t\t\t\tvar RBDOC = self._RB_DOC_CACHE;\r\n\t\t\t\t\tfor(var c=0; c<RBDOC.length; c++) {\r\n\t\t\t\t\t\tif (RBDOC[c].ID4.toLowerCase() == docType.toLowerCase()) {\r\n\t\t\t\t\t\t\tprefix = RBDOC[c].Prefix;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (!prefix) return;\r\n\t\t\t\t\tself.set(\"DocID\", p.company + p.year + prefix + p.code);\r\n\t\t\t\t\tself.movSet(\"Doc\", self.get(\"DocID\"));\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t},\r\n\r\n\r\n\t\t\"_eventSetID\": function(){\r\n\r\n\t\t},\r\n\r\n\r\n\t\t\"movSet\": function(){\r\n\t\t\tfor(var c=0; c<this.movs.length; c++){\r\n\t\t\t\tif (typeof this.movs[c] != \"object\") continue;\r\n\t\t\t\tthis.movs[c].set.apply(this.movs[c], arguments);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\r\n\t\t/**\r\n\t\t * @return {Array}\r\n\t\t * @param {Object=} fieldsArg\r\n\t\t * @param {Object=} propertyArg\r\n\t\t * */\r\n\t\t\"getMov\": function (fieldsArg, propertyArg) {\r\n\r\n\t\t\tif (!arguments.length) return this.movs;\r\n\r\n\t\t\tif (typeof fieldsArg != \"object\" || !fieldsArg) fieldsArg = {};\r\n\t\t\tif (typeof propertyArg != \"object\" || !propertyArg) propertyArg = {};\r\n\r\n\t\t\tvar c;\r\n\r\n\t\t\tif (  fieldsArg instanceof  MovDataModel  ){\r\n\r\n\t\t\t\tfor(c=0; c<this.movs.length; c++){\r\n\t\t\t\t\tif (  this.movs[c].get(\"_unique_sid\") == fieldsArg.get(\"_unique_sid\")  ){\r\n\t\t\t\t\t\treturn [this.movs[c]];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\treturn this.movs.filter(\r\n\t\t\t\t\tfunction(mov){\r\n\t\t\t\t\t\tif (!mov) return false;\r\n\t\t\t\t\t\tif (typeof mov != \"object\") return false;\r\n\r\n\t\t\t\t\t\tvar keys, c, ret = true;\r\n\r\n\t\t\t\t\t\tkeys = Object.getOwnPropertyNames(fieldsArg);\r\n\t\t\t\t\t\tfor(c=0; c<keys.length; c++){\r\n\t\t\t\t\t\t\tif (  mov.get(keys[c]) != fieldsArg[keys[c]]  ) ret = false;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tkeys = Object.getOwnPropertyNames(propertyArg);\r\n\t\t\t\t\t\tif (keys.length) {\r\n\t\t\t\t\t\t\tif (!mov.getProperty(propertyArg).length) ret = false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn ret;\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn [];\r\n\r\n\t\t},\r\n\r\n\r\n\t\t\"addMov\": function (mov) {\r\n\t\t\t// TODO необходимо проверять тип\r\n\t\t\tmov.set(\"DocDataObject\", this);\r\n\t\t\tif (  mov.get(\"Doc1\") != this.get(\"DocID\")  ){\r\n\t\t\t\tmov.set(\"Doc\", this.get(\"DocID\"));\r\n\t\t\t}\r\n\t\t\tthis.movs.push(mov);\r\n\t\t},\r\n\r\n\r\n\t\t\"deleteMov\": function (keyValue) {\r\n\t\t\tif (typeof keyValue != \"object\") return null;\r\n\r\n\t\t\tif (  keyValue instanceof MovDataModel ){\r\n\t\t\t\tthis.movs = this.movs.filter(\r\n\t\t\t\t\tfunction(mov){\r\n\t\t\t\t\t\tif (  !mov  ) return false;\r\n\t\t\t\t\t\tif (  typeof mov != \"object\"  ) return false;\r\n\t\t\t\t\t\treturn mov.get(\"_unique_sid\") != keyValue.get(\"_unique_sid\");\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t\t\treturn true;\r\n\r\n\t\t\t} else {\r\n\t\t\t\tthis.movs = this.movs.filter(\r\n\t\t\t\t\tfunction(mov){\r\n\t\t\t\t\t\tif (  !mov  ) return false;\r\n\t\t\t\t\t\tif (  typeof mov != \"object\"  ) return false;\r\n\t\t\t\t\t\tvar keys = Object.getOwnPropertyNames(keyValue);\r\n\t\t\t\t\t\tfor(var c=0; c<keys.length; c++){\r\n\t\t\t\t\t\t\tif (  mov.get(keys[c]) != keyValue[keys[c]]  ) return true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn true;\r\n\t\t},\r\n\r\n\r\n\t\t\"deleteAllMovs\": function () {\r\n\t\t\tthis.movs = []\r\n\t\t},\r\n\r\n\r\n\t\t\"removeMov\": function () {\r\n\t\t\treturn this.deleteMov.apply(this, arguments);\r\n\t\t},\r\n\r\n\r\n\t\t\"removeAllMovs\": function () {\r\n\t\t\treturn this.deleteAllMovs();\r\n\t\t},\r\n\r\n\r\n\t\t\"save\": function(arg){\r\n\t\t\tvar saveMethod = null, self = this, selfArguments = arguments;\r\n\r\n\t\t\tif (typeof arg != \"object\") arg = Object.create(null);\r\n\r\n\t\t\tvar dbawws = getContextDB.call(this); // DBModel.prototype.getInstance();\r\n\r\n\t\t\tvar callback = (typeof arg.callback == \"function\" ? arg.callback : new Function() );\r\n\r\n\t\t\tnew Promise(\r\n\t\t\t\tfunction(resolve, reject){\r\n\r\n\t\t\t\t\tvar\r\n\t\t\t\t\t\tGSID = null,\r\n\t\t\t\t\t\tdocType = null,\r\n\t\t\t\t\t\tcompanyID = null,\r\n\t\t\t\t\t\tc;\r\n\r\n\t\t\t\t\tif (typeof arg.GSID == \"string\"){\r\n\t\t\t\t\t\tGSID = arg.GSID;\r\n\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tfor (c = 0; c < self.movs.length; c++) {\r\n\t\t\t\t\t\t\tGSID = self.movs[c].get(\"GSID\");\r\n\t\t\t\t\t\t\tif (!GSID) {\r\n\t\t\t\t\t\t\t\tGSID = null;\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tdocType = self.get(\"DocType\");\r\n\r\n\t\t\t\t\tcompanyID = self.get(\"Company\");\r\n\r\n\t\t\t\t\tif ( !self.get(\"DocID\") ){\r\n\t\t\t\t\t\tself.getNewDocID({\r\n\t\t\t\t\t\t\t\"GSID\": GSID,\r\n\t\t\t\t\t\t\t\"docType\": docType,\r\n\t\t\t\t\t\t\t\"companyID\": companyID,\r\n\t\t\t\t\t\t\t\"callback\": function(err,Doc){\r\n\t\t\t\t\t\t\t\tif (err){\r\n\t\t\t\t\t\t\t\t\treject(err);\r\n\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tself.set(\"DocID\",Doc);\r\n\t\t\t\t\t\t\t\tsaveMethod = self.insert;\r\n\t\t\t\t\t\t\t\tresolve();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tdbawws.dbquery({\r\n\t\t\t\t\t\t\t\"query\": \"SELECT ID, DocID FROM DOCS WHERE DocID = '\" + self.get(\"DocID\") + \"' OR id = \" + self.get(\"ID\"),\r\n\t\t\t\t\t\t\t\"callback\": function(dbres){\r\n\t\t\t\t\t\t\t\tif (!dbres.recs.length){\r\n\t\t\t\t\t\t\t\t\tself.getNewDocID({\r\n\t\t\t\t\t\t\t\t\t\t\"GSID\": GSID,\r\n\t\t\t\t\t\t\t\t\t\t\"docType\": docType,\r\n\t\t\t\t\t\t\t\t\t\t\"companyID\": companyID,\r\n\t\t\t\t\t\t\t\t\t\t\"callback\": function(err,Doc){\r\n\t\t\t\t\t\t\t\t\t\t\tif (err){\r\n\t\t\t\t\t\t\t\t\t\t\t\treject(err);\r\n\t\t\t\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\tself.set(\"ID\", null);\r\n\t\t\t\t\t\t\t\t\t\t\tself.set(\"DocID\",Doc);\r\n\t\t\t\t\t\t\t\t\t\t\tsaveMethod = self.insert;\r\n\t\t\t\t\t\t\t\t\t\t\tresolve();\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tself.set(\"ID\", dbres.recs[0].ID);\r\n\t\t\t\t\t\t\t\tsaveMethod = self.update;\r\n\t\t\t\t\t\t\t\tresolve();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t)\r\n\t\t\t.then(\r\n\t\t\t\tfunction(){\r\n\t\t\t\t\tsaveMethod.apply(self, selfArguments);\r\n\t\t\t\t}\r\n\t\t\t).catch(\r\n\t\t\t\tfunction(reason){\r\n\t\t\t\t\tcallback(reason);\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t},\r\n\r\n\r\n\t\t\"insert\": function(arg){\r\n\t\t\tvar self = this, c, prop;\r\n\r\n\t\t\tif (typeof arg != \"object\") arg = Object.create(null);\r\n\r\n\t\t\tvar callback = (typeof arg.callback == \"function\" ? arg.callback : function(){} );\r\n\r\n\t\t\tvar dbawws = getContextDB.call(this); // DBModel.prototype.getInstance();\r\n\r\n\t\t\tvar err = [];\r\n\r\n\t\t\tvar ownProps = this.getProperty(null);\r\n\r\n\t\t\tvar dbq = [];\r\n\r\n\t\t\t// -------------------------------------------------------------------------------------------\r\n\t\t\t// Поля по-умолчанию\r\n\r\n\t\t\tvar defaultFelds = _utils.objectKeysToLowerCase(this.__docDataModelsDefaultFields);\r\n\t\t\tvar disabledFields = [\"id\"];\r\n\r\n\t\t\tvar values = [], fields = [], value;\r\n\r\n\t\t\tfor(prop in defaultFelds){\r\n\t\t\t\tif (  !defaultFelds.hasOwnProperty(prop)  ) continue;\r\n\t\t\t\tif (  disabledFields.indexOf(prop) > -1 ) continue;\r\n\r\n\t\t\t\tvalue = defaultFelds[prop].value || this.get(prop);\r\n\r\n\t\t\t\tif (!value) continue;\r\n\r\n\t\t\t\tif (value instanceof Date){\r\n\t\t\t\t\tvalue = \"\"\r\n\t\t\t\t\t\t+ [value.getDate(), value.getMonth()-1, value.getFullYear()].join(\".\")\r\n\t\t\t\t\t\t+ \" \"\r\n\t\t\t\t\t\t+ [value.getHours(),value.getMinutes(),value.getSeconds()].join(\";\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (  defaultFelds[prop].type == \"S\"  ) {\r\n\t\t\t\t\tvalues.push(!value ? \"NULL\" : \"\\\"\"+_utils.DBSecureStr(value)+\"\\\"\");\r\n\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvalues.push(!value ? \"NULL\" : value);\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfields.push(\"[\"+prop+\"]\");\r\n\t\t\t}\r\n\r\n\t\t\tdbq.push(\"INSERT INTO DOCS (\"+fields.join(\",\")+\") VALUES (\"+values.join(\",\")+\")\");\r\n\r\n\t\t\t// -------------------------------------------------------------------------------------------\r\n\t\t\t// Запись свойств\r\n\r\n\t\t\tdbq.push(\"DELETE FROM Property WHERE ExtClass = 'DOCS' AND ExtID = '\"+this.get(\"DocID\")+\"' \");\r\n\r\n\t\t\tvar property, type;\r\n\r\n\t\t\tfor(c=0; c<ownProps.length; c++){\r\n\t\t\t\tproperty = ownProps[c];\r\n\r\n\t\t\t\tvalues = [];\r\n\t\t\t\tfields = [];\r\n\r\n\t\t\t\tif (  typeof property != \"object\"  ) continue;\r\n\r\n\t\t\t\t// ........... снижение регистра существующих полей\r\n\t\t\t\tproperty = _utils.objectKeysToLowerCase(property);\r\n\r\n\t\t\t\t// .......................................................................\r\n\r\n\t\t\t\tproperty.pid = 0;\r\n\r\n\t\t\t\tif (  !property.hasOwnProperty(\"property\") || !property.property ){\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (  !property.hasOwnProperty(\"value\")  ){\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (  !property.hasOwnProperty(\"extclass\") || !property.extclass  ){\r\n\t\t\t\t\tproperty.extclass = \"DOCS\";\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (\r\n\t\t\t\t\t(\r\n\t\t\t\t\t\t!property.hasOwnProperty(\"extid\")\r\n\t\t\t\t\t\t|| !property.extid\r\n\t\t\t\t\t)\r\n\t\t\t\t\t&& self.get(\"DocID\")\r\n\t\t\t\t){\r\n\t\t\t\t\tproperty.extid = self.get(\"DocID\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor(prop in property){\r\n\t\t\t\t\tif (  !property.hasOwnProperty(prop)  ) continue;\r\n\r\n\t\t\t\t\ttype = null;\r\n\t\t\t\t\tvalue = property[prop];\r\n\r\n\t\t\t\t\tif (  value === null || typeof value == \"undefined\"  ) continue;\r\n\r\n\t\t\t\t\tfields.push(\"[\"+prop+\"]\");\r\n\r\n\t\t\t\t\tif (  InterfaceFProperty.prototype._interfaceFPropertyFields.hasOwnProperty(prop.toLowerCase())  ){\r\n\t\t\t\t\t\ttype = InterfaceFProperty\r\n\t\t\t\t\t\t\t.prototype\r\n\t\t\t\t\t\t\t._interfaceFPropertyFields[prop.toLowerCase()]\r\n\t\t\t\t\t\t\t.type;\r\n\t\t\t\t\t\ttype = type.toLowerCase();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (type == \"string\"){\r\n\t\t\t\t\t\tvalue = \"\\\"\"+_utils.DBSecureStr(value)+\"\\\"\";\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvalues.push(value);\r\n\r\n\t\t\t\t}\r\n\t\t\t\tdbq.push(\r\n\t\t\t\t\t\"INSERT INTO Property (\"+fields.join(\",\")+\") VALUES (\"+values.join(\",\")+\")\"\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\t// -----------------------------------------------------------------\r\n\r\n\t\t\tif (err.length) {\r\n\t\t\t\tcallback(err);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// -----------------------------------------------------------------\r\n\r\n\t\t\tvar promises = [];\r\n\r\n\t\t\tif (dbq.length) {\r\n\t\t\t\tpromises.push(\r\n\t\t\t\t\tfunction (resolve, reject) {\r\n\t\t\t\t\t\tdbawws.dbquery({\r\n\t\t\t\t\t\t\t\"query\": dbq.join(\"; \"),\r\n\t\t\t\t\t\t\t\"callback\": function (dbres) {\r\n\t\t\t\t\t\t\t\tvar tmpErr = [];\r\n\t\t\t\t\t\t\t\tfor (var c = 0; c < dbres.length; c++) {\r\n\t\t\t\t\t\t\t\t\tif (dbres[c].info.errors.length) {\r\n\t\t\t\t\t\t\t\t\t\ttmpErr = tmpErr.concat(tmpErr, dbres[c].info.errors);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif (tmpErr.length) {\r\n\t\t\t\t\t\t\t\t\terr = err.concat(tmpErr);\r\n\t\t\t\t\t\t\t\t\treject(err);\r\n\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tresolve();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\tfor(c=0; c<self.movs.length; c++){\r\n\t\t\t\t(function(){\r\n\t\t\t\t\tvar cc = c;\r\n\t\t\t\t\tpromises.push(\r\n\t\t\t\t\t\tfunction(resolve, reject){\r\n\t\t\t\t\t\t\tif (  self.movs[cc].get(\"Doc1\") != self.get(\"DocID\")  ){\r\n\t\t\t\t\t\t\t\tself.movs[cc].set(\"Doc\", self.get(\"DocID\"));\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tself.movs[cc].save({\r\n\t\t\t\t\t\t\t\t\"callback\": function(err_b){\r\n\t\t\t\t\t\t\t\t\tif (err_b){\r\n\t\t\t\t\t\t\t\t\t\terr = err.concat(err_b);\r\n\t\t\t\t\t\t\t\t\t\treject(err);\r\n\t\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tresolve();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t);\r\n\t\t\t\t})();\r\n\t\t\t}\r\n\r\n\t\t\tif (  !promises.length  ){\r\n\t\t\t\tcallback(null);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tPromise.cascade(promises, {\"stackSize\":1,\"interval\":1000})\r\n\t\t\t\t.then(function(){\r\n\t\t\t\t\tcallback(null);\r\n\t\t\t\t})\r\n\t\t\t\t.catch(function(err){\r\n\t\t\t\t\tcallback(err);\r\n\t\t\t\t});\r\n\r\n\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * @param {Object} ownArg\t\t\t\t\t\t// Аргументы для сохр. заявки\r\n\t\t * @param {Function} ownArg.callback\r\n\t\t * @param {Array} ownArg.excludeMovs\t\t// Игнорировать изменения в перечисленных подчиненных задачах. Массив из MMID (integer)\r\n\t\t * @param {Object} parentArg\t\t\t\t\t// Аргументы сохранения родительской заявки, если такая есть\r\n\t\t * @param {Object} childrenArg\t\t\t\t\t// Аргумент сохр. подчиненной заявки, если такие есть\r\n\t\t * @param {Object} movArg\t\t\t\t\t\t// Аргументы сохранения подчиненных задач // см. MovDataModel\r\n\t\t* */\r\n\t\t\"update\": function(ownArg, parentArg, childrenArg, movArg){\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tif (typeof ownArg != \"object\") ownArg = Object.create(null);\r\n\r\n\t\t\tif (typeof movArg != \"object\") movArg = Object.create(null);\r\n\r\n\t\t\tif (  !_utils.objectHasOwnProperty(movArg, \"callback\")  ) movArg.callback = new Function();\r\n\r\n\t\t\tvar callback = typeof ownArg.callback == \"function\" ? ownArg.callback : new Function();\r\n\r\n\t\t\t// var useNotification = typeof ownArg.useNotification == \"undefined\" ? true : Boolean(ownArg.useNotification);\r\n\r\n\t\t\t// var saveChildren = typeof ownArg.saveChildren == \"undefined\" ? true : Boolean(ownArg.saveChildren);\r\n\r\n\t\t\t// var saveParent = typeof ownArg.saveParent == \"undefined\" ? true : Boolean(ownArg.saveParent);\r\n\r\n\t\t\tvar excludeMovs = _utils.parseArg({\r\n\t\t\t\t\t\"value\":\t\t\ttypeof ownArg.excludeMovs == \"undefined\"? null : ownArg.excludeMovs,\r\n\t\t\t\t\t\"into\":\t\t\t\"array\",\r\n\t\t\t\t\t\"isInt\":\t\t\ttrue,\r\n\t\t\t\t\t\"toInt\":\t\t\ttrue,\r\n\t\t\t\t\t\"kickEmpty\":\ttrue,\r\n\t\t\t\t\t\"delimiters\":\t[\",\",\";\"]\r\n\t\t\t\t}) || [];\r\n\r\n\t\t\t/*\r\n\t\t\tvar includeMovs = _utils.parseArg({\r\n\t\t\t\t\t\"value\": typeof ownArg.includeMovs == \"undefined\"? null : ownArg.includeMovs,\r\n\t\t\t\t\t\"into\":\t\t\t\"array\",\r\n\t\t\t\t\t\"isInt\":\t\t\ttrue,\r\n\t\t\t\t\t\"toInt\":\t\t\ttrue,\r\n\t\t\t\t\t\"kickEmpty\":\ttrue,\r\n\t\t\t\t\t\"delimiters\":\t[\",\",\";\"]\r\n\t\t\t\t}) || [];\r\n\t\t\t*/\r\n\r\n\t\t\t// var onlyChanged = typeof ownArg.onlyChanged == \"undefined\" ? true : Boolean(ownArg.onlyChanged);\r\n\r\n\t\t\tvar dbawws = getContextDB.call(this); // DBModel.prototype.getInstance();\r\n\r\n\t\t\t// ----------------------------------------------------------------------------\r\n\t\t\t// Запись полей\r\n\r\n\t\t\tdbawws.dbquery({\r\n\t\t\t\t\"query\": [\r\n\t\t\t\t\t\"SELECT uid, property, [value], ExtID  \" +\r\n\t\t\t\t\t\" FROM Property \" +\r\n\t\t\t\t\t\" WHERE \" +\r\n\t\t\t\t\t\t\" pid = 0\" +\r\n\t\t\t\t\t\t\" AND ExtClass = 'DOCS' \" +\r\n\t\t\t\t\t\t\" AND ExtID IN (SELECT DocID FROM DOCS WHERE ID = \"+self.get(\"ID\")+\")\",\r\n\r\n\t\t\t\t\t\"SELECT MMID FROM Movement WHERE Doc IN (SELECT DocID FROM DOCS WHERE ID = \"+self.get(\"ID\")+\") \"\r\n\t\t\t\t].join(\"; \"),\r\n\t\t\t\t\"callback\": function(dbres){\r\n\r\n\t\t\t\t\tvar changedFields = self.getChanged();\r\n\t\t\t\t\tvar defaultFields = _utils.objectKeysToLowerCase(self.__docDataModelsDefaultFields);\r\n\t\t\t\t\tvar disabledFields = [\"id\",\"regdate\",\"datenew\",\"useredit\",\"dateedit\"];\r\n\r\n\t\t\t\t\tvar dbProps = dbres[0].recs;\r\n\t\t\t\t\tvar dbMovs = dbres[1].recs;\r\n\r\n\t\t\t\t\tvar\r\n\t\t\t\t\t\tvalues = [],\r\n\t\t\t\t\t\tvalue,\r\n\t\t\t\t\t\tfields = [],\r\n\t\t\t\t\t\tlowName,\r\n\t\t\t\t\t\ttype,\r\n\t\t\t\t\t\tc,\r\n\t\t\t\t\t\t//tmp = [],\r\n\t\t\t\t\t\tprop,\r\n\t\t\t\t\t\tlowerName;\r\n\r\n\t\t\t\t\tvar dbq = [];\r\n\r\n\t\t\t\t\t// -----------------------------------------------------------------\r\n\t\t\t\t\t// Обновление полей в строке\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tfor(c=0; c<changedFields.length; c++){\r\n\t\t\t\t\t\t\tlowName = changedFields[c].toLowerCase();\r\n\r\n\t\t\t\t\t\t\tif (  !defaultFields.hasOwnProperty(lowName)  ) continue;\r\n\t\t\t\t\t\t\tif (  disabledFields.indexOf(lowName) > -1  ) continue;\r\n\r\n\t\t\t\t\t\t\tvalue = self.get(lowName);\r\n\t\t\t\t\t\t\ttype = defaultFields[lowName].type;\r\n\r\n\t\t\t\t\t\t\tif (value instanceof Date){\r\n\t\t\t\t\t\t\t\tvalue = \"\"\r\n\t\t\t\t\t\t\t\t\t+ [value.getDate(), value.getMonth()-1, value.getFullYear()].join(\".\")\r\n\t\t\t\t\t\t\t\t\t+ \" \"\r\n\t\t\t\t\t\t\t\t\t+ [value.getHours(),value.getMinutes(),value.getSeconds()].join(\";\");\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif (  type == \"S\"  ) {\r\n\t\t\t\t\t\t\t\tvalues.push((\"[\"+lowName+\"]=\") + (!value ? \"NULL\" : \"\\\"\"+_utils.DBSecureStr(value)+\"\\\"\"));\r\n\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tvalues.push((\"[\"+lowName+\"]=\") + (!value ? \"NULL\" : value));\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (  values.length  ){\r\n\t\t\t\t\t\t\tdbq.push(\"UPDATE DOCS SET \"+ values.join(\", \") +\" WHERE ID = \" + self.get(\"ID\"));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// -----------------------------------------------------------------\r\n\t\t\t\t\t// Обработка свойств\r\n\t\t\t\t\t// Ссылки на собственные свойства\r\n\r\n\t\t\t\t\tvar dbPropRef = {};\r\n\t\t\t\t\tvar selfPropRef = {};\r\n\t\t\t\t\tvar property;\r\n\t\t\t\t\ttmp = [];\r\n\r\n\t\t\t\t\tfor(c=0; c<self._property.length; c++){\r\n\t\t\t\t\t\tif (typeof self._property[c] != \"object\" || !self._property[0]) continue;\r\n\r\n\t\t\t\t\t\tproperty = _utils.objectKeysToLowerCase(self._property[c]);\r\n\r\n\t\t\t\t\t\tif (  !property.hasOwnProperty(\"value\") || property.value === null  ) continue;\r\n\r\n\t\t\t\t\t\ttmp.push(property);\r\n\r\n\t\t\t\t\t\tproperty.pid = 0;\r\n\t\t\t\t\t\tproperty.extid = self.get(\"DocID\");\r\n\t\t\t\t\t\tproperty.extclass = \"DOCS\";\r\n\r\n\t\t\t\t\t\tif (  !property.hasOwnProperty(\"uid\") || !property.uid  ) continue;\r\n\r\n\t\t\t\t\t\tselfPropRef[property.uid] = property;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tself._property = tmp;\r\n\r\n\t\t\t\t\t// ........................................................\r\n\t\t\t\t\t// Ссылки на свойства в БД\r\n\t\t\t\t\tfor(c=0; c<dbProps.length; c++){\r\n\t\t\t\t\t\tproperty = _utils.objectKeysToLowerCase(dbProps[c]);\r\n\r\n\t\t\t\t\t\tif (  !property.hasOwnProperty(\"uid\") || !property.uid  ) continue;\r\n\r\n\t\t\t\t\t\tdbPropRef[property.uid] = property;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// ........................................................\r\n\t\t\t\t\t// INSERT\r\n\r\n\t\t\t\t\tvar _interfaceFPropertyFields = InterfaceFProperty.prototype._interfaceFPropertyFields;\r\n\r\n\t\t\t\t\tfor(c=0; c< self._property.length; c++){\r\n\r\n\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\t!self._property[c].uid\r\n\t\t\t\t\t\t\t|| !dbPropRef.hasOwnProperty(self._property[c].uid)\r\n\t\t\t\t\t\t){\r\n\t\t\t\t\t\t\tfields = [];\r\n\t\t\t\t\t\t\tvalues = [];\r\n\r\n\t\t\t\t\t\t\tfor(prop in self._property[c]){\r\n\t\t\t\t\t\t\t\tif (  !self._property[c].hasOwnProperty(prop)  ) continue;\r\n\r\n\t\t\t\t\t\t\t\tvalue = self._property[c][prop];\r\n\t\t\t\t\t\t\t\tlowerName = prop.toLowerCase();\r\n\t\t\t\t\t\t\t\ttype = null;\r\n\r\n\r\n\t\t\t\t\t\t\t\tif (value === null) continue;\r\n\r\n\t\t\t\t\t\t\t\tif (  !_interfaceFPropertyFields.hasOwnProperty(lowerName)  ) continue;\r\n\t\t\t\t\t\t\t\ttype = _interfaceFPropertyFields[lowerName].type;\r\n\t\t\t\t\t\t\t\ttype = type.toLowerCase();\r\n\r\n\t\t\t\t\t\t\t\tif (type == \"string\"){\r\n\t\t\t\t\t\t\t\t\tvalue = (  value === null || value === \"\" ? \"NULL\" : \"\\\"\"+_utils.DBSecureStr(value)+\"\\\"\"  );\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tvalues.push(value);\r\n\t\t\t\t\t\t\t\tfields.push(\"[\"+lowerName+\"]\");\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif (fields.length != values.length || !fields.length) continue;\r\n\r\n\t\t\t\t\t\t\tdbq.push( \"INSERT INTO Property (\"+fields.join(\",\")+\") VALUES (\"+values.join(\",\")+\")\" );\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// ........................................................\r\n\t\t\t\t\t// UPDATE & DELETE\r\n\t\t\t\t\tvar deletedProps = [];\r\n\r\n\t\t\t\t\tfor(c=0; c<dbProps.length; c++){\r\n\t\t\t\t\t\tif (  !selfPropRef.hasOwnProperty(dbProps[c].uid)  ){\r\n\t\t\t\t\t\t\tdeletedProps.push(dbProps[c].uid);\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\tselfPropRef[dbProps[c].uid].value != dbProps[c].value\r\n\t\t\t\t\t\t\t|| dbProps[c].ExtID != self.get(\"DocID\")\r\n\t\t\t\t\t\t){\r\n\t\t\t\t\t\t\tdbq.push(\r\n\t\t\t\t\t\t\t\t\"UPDATE Property \" +\r\n\t\t\t\t\t\t\t\t\" SET \" +\r\n\t\t\t\t\t\t\t\t\t[\r\n\t\t\t\t\t\t\t\t\t\t\"[value]=\\\"\"+_utils.DBSecureStr(selfPropRef[dbProps[c].uid].value)+\"\\\"\",\r\n\t\t\t\t\t\t\t\t\t\t\"[ExtID]='\"+self.get(\"DocID\")+\"'\",\r\n\t\t\t\t\t\t\t\t\t\t\"[ExtClass]='DOCS'\"\r\n\t\t\t\t\t\t\t\t\t].join(\", \")+\r\n\t\t\t\t\t\t\t\t\" WHERE \" +\r\n\t\t\t\t\t\t\t\t\t\" property = '\"+dbProps[c].property+\"' \" +\r\n\t\t\t\t\t\t\t\t\t\" AND uid = \"+ dbProps[c].uid\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// ------------------------------------------------------------------\r\n\r\n\t\t\t\t\tvar deletedChildren = [];\r\n\t\t\t\t\tvar selfMovsRef = {};\r\n\r\n\t\t\t\t\tfor(var v=0; v<self.movs.length; v++){\r\n\t\t\t\t\t\tif (typeof self.movs[v] != \"object\") continue;\r\n\t\t\t\t\t\tselfMovsRef[self.movs[v].get(\"MMID\")] = self.movs[v];\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfor(c=0; c<dbMovs.length; c++){\r\n\t\t\t\t\t\tif (  !selfMovsRef.hasOwnProperty(dbMovs[c].MMID)  ){\r\n\t\t\t\t\t\t\tdeletedChildren.push(dbMovs[c].MMID);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// ------------------------------------------------------------------\r\n\r\n\t\t\t\t\tif (  deletedProps.length  ){\r\n\t\t\t\t\t\tdbq.push(\"DELETE FROM Property WHERE uid IN (\"+deletedProps.join(\",\")+\")\");\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (  deletedChildren.length  ){\r\n\t\t\t\t\t\tdbq.push(\"DELETE FROM Movement WHERE MMID IN (\"+deletedChildren.join(\",\")+\")\");\r\n\t\t\t\t\t\tdbq.push(\"DELETE FROM Property WHERE pid IN (\"+deletedChildren.join(\",\")+\")\")\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// ----------------------------------------------------------------------------\r\n\r\n\t\t\t\t\tvar promises = [];\r\n\r\n\t\t\t\t\tif (dbq.length) {\r\n\t\t\t\t\t\tpromises.push(\r\n\t\t\t\t\t\t\tfunction (resolve, reject) {\r\n\t\t\t\t\t\t\t\tdbawws.dbquery({\r\n\t\t\t\t\t\t\t\t\t\"query\": dbq.join(\"; \"),\r\n\t\t\t\t\t\t\t\t\t\"callback\": function (dbres) {\r\n\t\t\t\t\t\t\t\t\t\tvar tmpErr = [];\r\n\t\t\t\t\t\t\t\t\t\tfor (var c = 0; c < dbres.length; c++) {\r\n\t\t\t\t\t\t\t\t\t\t\tif (dbres[c].info.errors.length) {\r\n\t\t\t\t\t\t\t\t\t\t\t\ttmpErr = tmpErr.concat(tmpErr, dbres[c].info.errors);\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\tif (tmpErr.length) {\r\n\t\t\t\t\t\t\t\t\t\t\t// err = err.concat(tmpErr);\r\n\t\t\t\t\t\t\t\t\t\t\treject(tmpErr);\r\n\t\t\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\tresolve();\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}\r\n\r\n\r\n\t\t\t\t\tfor(c=0; c<self.movs.length; c++) {\r\n\t\t\t\t\t\t(function () {\r\n\r\n\t\t\t\t\t\t\tvar cc = c;\r\n\r\n\t\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\t\t!self.movs[cc].getChanged().length\r\n\t\t\t\t\t\t\t\t&& !self.movs[cc].getChangedProperty().length\r\n\t\t\t\t\t\t\t){\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (  deletedChildren.indexOf(self.movs[cc].get(\"MMID\")) > -1  ){\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (  excludeMovs.indexOf(self.movs[cc].get(\"MMID\")) > -1  ){\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (  self.movs[cc].get(\"Doc1\") != self.get(\"DocID\")  ){\r\n\t\t\t\t\t\t\t\tself.movs[cc].set(\"Doc\", self.get(\"DocID\"));\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tpromises.push(\r\n\t\t\t\t\t\t\t\tfunction (resolve, reject) {\r\n\r\n\t\t\t\t\t\t\t\t\tvar movCallback = movArg.callback;\r\n\r\n\t\t\t\t\t\t\t\t\tmovArg.callback = function(err){\r\n\t\t\t\t\t\t\t\t\t\tmovCallback(err);\r\n\t\t\t\t\t\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\t\t\t\t\t\t// err = err.concat(err_b);\r\n\t\t\t\t\t\t\t\t\t\t\treject(err);\r\n\t\t\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\tresolve();\r\n\t\t\t\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\t\t\t\tself.movs[cc].save(movArg)\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t})();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (  !promises.length  ){\r\n\t\t\t\t\t\tcallback(null);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tPromise.cascade(promises, {\"stackSize\":1,\"interval\":1000})\r\n\t\t\t\t\t\t.then(\r\n\t\t\t\t\t\tfunction(){\r\n\t\t\t\t\t\t\tcallback(null);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t)\r\n\t\t\t\t\t\t.catch(\r\n\t\t\t\t\t\tfunction(err){\r\n\t\t\t\t\t\t\tcallback(err);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t},\r\n\r\n\r\n\t\t\"getJSON\": function(){\r\n\t\t\tvar keys = Object.getOwnPropertyNames(this.props);\r\n\t\t\tvar defaultFields = _utils.objectKeysToLowerCase(this.__docDataModelsDefaultFields);\r\n\t\t\tvar lowKey, json = {};\r\n\t\t\tfor(var c=0; c<keys.length; c++){\r\n\t\t\t\tlowKey = keys[c].toLowerCase();\r\n\t\t\t\tif (  !defaultFields.hasOwnProperty(lowKey)  ) continue;\r\n\t\t\t\tjson[lowKey] = this.props[keys[c]];\r\n\t\t\t}\r\n\t\t\treturn json;\r\n\t\t},\r\n\r\n\r\n\t\t\"load\": function (arg) {\r\n\r\n\t\t\tif (typeof arg != \"object\") arg = Object.create(null);\r\n\r\n\t\t\tvar self = this, err = [];\r\n\r\n\t\t\tvar callback = typeof arg.callback == \"function\" ? arg.callback : new Function();\r\n\r\n\t\t\t// var MMID = (typeof arg.MMID != \"undefined\" && !isNaN(arg.MMID) ? parseInt(arg.MMID) : null );\r\n\r\n\t\t\tvar DocID = typeof arg.DocID == \"string\" && arg.DocID.length == 10 ? arg.DocID : self.get(\"DocID\");\r\n\r\n\t\t\tvar taskModel = typeof arg.taskModel == \"function\" ? arg.taskModel : null ;\r\n\r\n\t\t\tif (typeof arg.movModel == \"function\") taskModel = arg.movModel;\r\n\r\n\t\t\tvar excludeGSID = typeof arg.excludeGSID == \"object\" ? arg.excludeGSID : [];\r\n\r\n\t\t\tvar includeGSID = typeof arg.includeGSID == \"object\" ? arg.includeGSID : [];\r\n\r\n\t\t\tvar useSubMovs = typeof arg.useSubMovs == \"undefined\" ? false : Boolean(arg.useSubMovs);\r\n\r\n\t\t\t// TODO var fields = typeof arg.fields == \"undefined\"\r\n\r\n\t\t\tvar fields = _utils.parseArg({\r\n\t\t\t\t\"value\": arg.fields ? A.fields : null,\r\n\t\t\t\t\"into\": \"array\",\r\n\t\t\t\t\"kickEmpty\": true,\r\n\t\t\t\t\"toLowerCase\": true,\r\n\t\t\t\t\"delimiters\": [\";\",\",\"]\r\n\t\t\t});\r\n\r\n\t\t\tif (  !fields || !fields.length  ){\r\n\t\t\t\tfields = [\r\n\t\t\t\t\t\"ID\",\r\n\t\t\t\t\t\"DocID\",\r\n\t\t\t\t\t\"Agent\",\r\n\t\t\t\t\t\"Manager\",\r\n\t\t\t\t\t\"User\",\r\n\t\t\t\t\t\"Person\",\r\n\t\t\t\t\t\"FirmContract\",\r\n\t\t\t\t\t\"[Sum1]\",\r\n\t\t\t\t\t\"[Debt]\",\r\n\t\t\t\t\t\"Company\",\r\n\t\t\t\t\t\"DocType\",\r\n\t\t\t\t\t\"Status\",\r\n\t\t\t\t\t\"Format(RegDate,'yyyy-mm-dd Hh:Nn:Ss') as RegDate\"\r\n\t\t\t\t];\r\n\t\t\t}\r\n\r\n\t\t\tvar DBq = [\r\n\t\t\t\t\"SELECT \"+fields.join(\",\")+\" FROM DOCS WHERE DocID = '\" + DocID + \"' \",\r\n\r\n\t\t\t\t\"SELECT MMID, GS FROM Movement WHERE Doc = '\"+DocID+\"' \"+(useSubMovs ? \" OR ParentDoc = '\"+DocID+\"' \" : \"\"),\r\n\r\n\t\t\t\t\"SELECT uid, extClass, extID, property, value FROM Property WHERE pid = 0 AND ExtClass = 'DOCS' AND ExtID = '\"+DocID+\"' \"\r\n\t\t\t];\r\n\r\n\t\t\tvar dbawws = getContextDB.call(this); // DBModel.prototype.getInstance();\r\n\r\n\t\t\tdbawws.dbquery({\r\n\t\t\t\t\"query\": DBq.join(\"; \"),\r\n\t\t\t\t\"callback\": function (dbres) {\r\n\t\t\t\t\tvar task, c, prop, tmp;\r\n\r\n\t\t\t\t\tif (  !dbres[0].recs.length  ){\r\n\t\t\t\t\t\tcallback([\"!doc.length\"]);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar doc = dbres[0].recs[0];\r\n\t\t\t\t\tvar movs = dbres[1].recs;\r\n\t\t\t\t\tvar props  = dbres[2].recs;\r\n\r\n\t\t\t\t\t// ------------------------------------------------------------------------------------------\r\n\r\n\t\t\t\t\tfor(prop in doc){\r\n\t\t\t\t\t\tif (  !doc.hasOwnProperty(prop)  ) continue;\r\n\t\t\t\t\t\tself.set(prop, doc[prop]);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ttmp = [];\r\n\r\n\t\t\t\t\tfor(c=0; c<props.length; c++){\r\n\t\t\t\t\t\ttmp.push(props[c]);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tself.addProperty(tmp);\r\n\r\n\t\t\t\t\tself.clearChanged();\r\n\r\n\t\t\t\t\t// ------------------------------------------------------------------------------------------\r\n\r\n\t\t\t\t\tif (typeof taskModel != \"function\") {\r\n\r\n\t\t\t\t\t\tcallback(err.length ? err : null);\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tvar movIDs = [];\r\n\r\n\t\t\t\t\t\tfor (c = 0; c < movs.length; c++) {\r\n\t\t\t\t\t\t\tif (  !parseInt(movs[c].MMID)  ) continue;\r\n\t\t\t\t\t\t\tif (  movIDs.indexOf(movs[c].MMID) > -1  ) continue;\r\n\t\t\t\t\t\t\tif (  includeGSID.length && includeGSID.indexOf(movs[c].GS) == -1  ) continue;\r\n\t\t\t\t\t\t\tif (  excludeGSID.length && excludeGSID.indexOf(movs[c].GS) > -1  ) continue;\r\n\r\n\t\t\t\t\t\t\tmovIDs.push(movs[c].MMID);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tvar promises = [];\r\n\r\n\t\t\t\t\t\tfor (c = 0; c < movIDs.length; c++) {\r\n\r\n\t\t\t\t\t\t\t(function () {\r\n\r\n\t\t\t\t\t\t\t\tvar movID = movIDs[c];\r\n\r\n\t\t\t\t\t\t\t\tpromises.push(\r\n\t\t\t\t\t\t\t\t\tnew Promise(\r\n\t\t\t\t\t\t\t\t\t\tfunction (resolve) {\r\n\t\t\t\t\t\t\t\t\t\t\ttask = new taskModel();\r\n\t\t\t\t\t\t\t\t\t\t\ttask.set(\"MMID\", movID);\r\n\t\t\t\t\t\t\t\t\t\t\tself.addMov(task);\r\n\t\t\t\t\t\t\t\t\t\t\ttask.load({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\"callback\": function (err) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t// TODO Решить: пропускать данную ошибку, или сообщать и блокировать выполнение.\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tconsole.error(new Error(err.join(\";\\n\")));\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tself.removeMov({\"MMID\": task.get(\"MMID\")});\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tresolve();\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\t\t})();\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tPromise.all(promises)\r\n\t\t\t\t\t\t\t.then(\r\n\t\t\t\t\t\t\tfunction () {\r\n\t\t\t\t\t\t\t\t/*\r\n\t\t\t\t\t\t\t\t * Одни и те же записи инициализированные в разном контексте (DocDM или MovDM),\r\n\t\t\t\t\t\t\t\t * имеют разные уникальные номера, и потому не определяются как одинаковые\r\n\t\t\t\t\t\t\t\t * => изменения не сквозные и происходят в разных объектах\r\n\t\t\t\t\t\t\t\t * */\r\n\t\t\t\t\t\t\t\tvar movs = self.getMov();\r\n\t\t\t\t\t\t\t\tvar cMovs, mov;\r\n\r\n\t\t\t\t\t\t\t\t// Взаимозамена одинаковых записей\r\n\t\t\t\t\t\t\t\tfor(var c=0; c<movs.length; c++){\r\n\t\t\t\t\t\t\t\t\tcMovs = movs[c].childrenMovs;\r\n\t\t\t\t\t\t\t\t\tfor(var v=0; v<cMovs.length; v++){\r\n\t\t\t\t\t\t\t\t\t\tmov = self.getMov({\"MMID\": cMovs[v].get(\"MMID\")});\r\n\t\t\t\t\t\t\t\t\t\tif (  mov.length  ){\r\n\t\t\t\t\t\t\t\t\t\t\tcMovs[v] = mov[0];\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t// ---------------------------------------------------------------------------------\r\n\r\n\t\t\t\t\t\t\t\tself.clearChanged();\r\n\t\t\t\t\t\t\t\tself.clearChangedProperty();\r\n\t\t\t\t\t\t\t\tcallback(err.length ? err : null, self);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t.catch(\r\n\t\t\t\t\t\t\tfunction (reason) {\r\n\t\t\t\t\t\t\t\tconsole.log(reason);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t},\r\n\r\n\r\n\t\t\"remove\": function(arg){\r\n\t\t\tif (typeof arg != \"object\") arg = Object.create(null);\r\n\r\n\t\t\tvar callback = typeof arg.callback == \"function\" ? arg.callback : new Function();\r\n\r\n\t\t\tif (!this.get(\"DocID\")){\r\n\t\t\t\tcallback(\"!DocID\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tvar dbawws = getContextDB.call(this);\r\n\r\n\t\t\tdbawws.dbquery({\r\n\t\t\t\t\"query\": \"DELETE FROM DOCS WHERE DocID='\" + this.get(\"DocID\") + \"'\",\r\n\t\t\t\t\"callback\": function(dbres){\r\n\t\t\t\t\tif (dbres.info.errors.length){\r\n\t\t\t\t\t\tcallback(dbres.info.errors);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcallback(null);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\r\n\r\n\t\t\"_RB_DOC_CACHE\": [],\r\n\r\n\r\n\t\t\"_initRB_DOC_CACHE\": function(callback){\r\n\t\t\tvar dbawws = getContextDB.call(this); // DBModel.prototype.getInstance();\r\n\t\t\tvar self = this;\r\n\t\t\tdbawws.dbquery({\r\n\t\t\t\t\"query\":\"SELECT ID4, DocName, Prefix, GSFilter, Sort FROM RB_DOC ORDER BY Sort ASC\",\r\n\t\t\t\t\"callback\": function(dbres){\r\n\t\t\t\t\tObject.getPrototypeOf(self)._RB_DOC_CACHE = dbres.recs;\r\n\t\t\t\t\tif (typeof callback == \"function\"){\r\n\t\t\t\t\t\tcallback(self._RB_DOC_CACHE);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\r\n\r\n\t\t\"parseDocID\": function(DocID, callback){\r\n\t\t\tif (typeof DocID != \"string\") return;\r\n\r\n\t\t\tvar arg = arguments;\r\n\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tvar res = {\r\n\t\t\t\t\"code\":\t\t\tDocID.slice(5),\r\n\t\t\t\t\"prefix\":\t\t\tDocID.slice(3,5),\r\n\t\t\t\t\"company\":\t\tDocID.slice(0,2),\r\n\t\t\t\t\"year\":\t\t\tDocID[2],\r\n\t\t\t\t\"docType\":\t\tnull\r\n\t\t\t};\r\n\r\n\t\t\tif (  !this._RB_DOC_CACHE.length  ){\r\n\t\t\t\tObject.getPrototypeOf(this)._initRB_DOC_CACHE(function(){\r\n\t\t\t\t\tif (  !self._RB_DOC_CACHE.length  ) return;\r\n\t\t\t\t\tself.parseDocID.apply(self, arg);\r\n\t\t\t\t})\r\n\t\t\t}\r\n\r\n\t\t\tvar RBDOC = this._RB_DOC_CACHE;\r\n\r\n\t\t\tfor(var c=0; c<RBDOC.length; c++){\r\n\t\t\t\tif (  RBDOC[c].Prefix.toLowerCase() == res.prefix.toLowerCase()  ){\r\n\t\t\t\t\tres.docType = RBDOC[c].ID4;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (typeof callback != \"function\") return;\r\n\r\n\t\t\tcallback(res);\r\n\t\t},\r\n\r\n\r\n\t\t\"getNewDocID\": function (arg) {\r\n\r\n\t\t\tif (typeof arg != \"object\") return;\r\n\r\n\t\t\tif (typeof arg.callback != \"function\") return;\r\n\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tvar callback = arg.callback;\r\n\r\n\t\t\tvar dbawws = getContextDB.call(this); // DBModel.prototype.getInstance();\r\n\r\n\t\t\tvar GSID = typeof arg.GSID == \"string\" ? arg.GSID : null;\r\n\r\n\t\t\tvar docType = typeof arg.docType == \"string\" ? arg.docType : null;\r\n\r\n\t\t\tvar companyID = typeof arg.companyID == \"string\" ? arg.companyID : null;\r\n\r\n\t\t\tif (!companyID){\r\n\t\t\t\tcallback([\"!arg.companyID\"], null);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tvar DBq = [\r\n\t\t\t\t\"SELECT TOP 10 mid(DocID,6,5) as nDocID FROM DOCS WHERE right(Year(Date()),1) = mid(DocID,3,1) AND LEN(DocID) = 10 ORDER BY mid(DocID,6,5) DESC\",\r\n\t\t\t\t\"SELECT right(Year(Date()),1) as _year\",\r\n\t\t\t\t\"SELECT ID4, DocName, Prefix, GSFilter, Sort FROM RB_DOC ORDER BY Sort ASC\"\r\n\t\t\t];\r\n\r\n\t\t\tdbawws.dbquery({\r\n\t\t\t\t\"query\": DBq.join(\"; \"),\r\n\t\t\t\t\"callback\": function (dbres) {\r\n\t\t\t\t\tvar newDocID, c, v, tmp;\r\n\t\t\t\t\tvar docTypePrefix = null;\r\n\r\n\t\t\t\t\tif (  !dbres[2].recs.length  ){\r\n\r\n\t\t\t\t\t\t// Выборка из таблицы RB_DOC пуста\r\n\t\t\t\t\t\tcallback([\"!RB_DOC.length\"]);\r\n\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tvar RBDOC = dbres[2].recs;\r\n\r\n\t\t\t\t\t\tself._RB_DOC_CACHE = RBDOC;\r\n\r\n\t\t\t\t\t\tif (  docType  ){\r\n\r\n\t\t\t\t\t\t\tfor(c=0; c<RBDOC.length; c++) {\r\n\t\t\t\t\t\t\t\tif (RBDOC[c].ID4.toLowerCase() == docType.toLowerCase()) {\r\n\t\t\t\t\t\t\t\t\tdocTypePrefix = RBDOC[c].Prefix;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t} else if (  GSID  ) {\r\n\r\n\t\t\t\t\t\t\tfor(c=0; c<dbres[2].recs.length; c++){\r\n\t\t\t\t\t\t\t\ttmp = dbres[2].recs[c].GSFilter.split(\";\");\r\n\t\t\t\t\t\t\t\tfor(v=0; v<tmp.length; v++){\r\n\t\t\t\t\t\t\t\t\ttmp[v] = tmp[v].trim().toLowerCase();\r\n\t\t\t\t\t\t\t\t\tif (!tmp[v]) continue;\r\n\t\t\t\t\t\t\t\t\tif (  GSID.toLowerCase().match(new RegExp(tmp[v]))  ){\r\n\t\t\t\t\t\t\t\t\t\tdocTypePrefix = dbres[2].recs[c].Prefix;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\tcallback([\"!docType && !GSID\"]);\r\n\t\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (!docTypePrefix){\r\n\t\t\t\t\t\tcallback([\"!docTypePrefix\"], null);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// --------------------------------------------------------------------------------\r\n\t\t\t\t\t// Сборка кода заявки\r\n\r\n\t\t\t\t\tif (!dbres[0].recs.length) {\r\n\t\t\t\t\t\tnewDocID = '00001';\r\n\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tnewDocID = parseInt(dbres[0].recs[0].nDocID) + 1;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar year = dbres[1].recs[0]._year;\r\n\r\n\t\t\t\t\tvar numericRest = 5 - newDocID.toString().length;\r\n\r\n\t\t\t\t\tfor (c = 0; c < numericRest; c++) {\r\n\t\t\t\t\t\tnewDocID = \"0\" + newDocID.toString();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tcallback(null, companyID + year + docTypePrefix + newDocID);\r\n\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t},\r\n\r\n\r\n\t\t\"__docDataModelsDefaultFields\": {\r\n\t\t\t\"id\":\t\t\t\t\t\t{\"type\":\"N\"},\r\n\t\t\t\"DocID\":\t\t\t\t\t{\"type\":\"S\"},\r\n\t\t\t\"ParentDoc\":\t\t\t{\"type\":\"S\"},\r\n\t\t\t\"ParentDoc2\":\t\t\t{\"type\":\"S\"},\r\n\t\t\t\"Tick\":\t\t\t\t\t{\"type\":\"N\"},\r\n\t\t\t\"OriginalDoc\":\t\t\t{\"type\":\"S\"},\r\n\t\t\t\"Company\":\t\t\t{\"type\":\"S\"},\r\n\t\t\t\"Status\":\t\t\t\t{\"type\":\"S\"},\r\n\t\t\t\"DocType\":\t\t\t\t{\"type\":\"S\"},\r\n\t\t\t\"User\":\t\t\t\t\t{\"type\":\"S\"},\r\n\t\t\t\"RegDate\":\t\t\t\t{\"type\":\"D\",\"value\": \"NOW()\"},\r\n\t\t\t\"DateAVR\":\t\t\t\t{\"type\":\"D\"},\r\n\t\t\t\"DateAcc\":\t\t\t\t{\"type\":\"D\"},\r\n\t\t\t\"TxtAcc\":\t\t\t\t{\"type\":\"S\"},\r\n\t\t\t\"WorkName\":\t\t\t{\"type\":\"S\"},\r\n\t\t\t\"Agent\":\t\t\t\t{\"type\":\"S\"},\r\n\t\t\t\"Manager\":\t\t\t\t{\"type\":\"S\"},\r\n\t\t\t\"FirmContract\":\t\t{\"type\":\"N\"},\r\n\t\t\t\"Person\":\t\t\t\t{\"type\":\"S\"},\r\n\t\t\t\"FirmCustomer\":\t\t{\"type\":\"N\"},\r\n\t\t\t\"PayType\":\t\t\t\t{\"type\":\"S\"},\r\n\t\t\t\"Discount\":\t\t\t\t{\"type\":\"N\"},\r\n\t\t\t\"Disc_Text\":\t\t\t{\"type\":\"S\"},\r\n\t\t\t\"Margin\":\t\t\t\t{\"type\":\"N\"},\r\n\t\t\t\"Marg_Text\":\t\t\t{\"type\":\"S\"},\r\n\t\t\t\"CurRate\":\t\t\t\t{\"type\":\"N\"},\r\n\t\t\t\"Currency\":\t\t\t\t{\"type\":\"S\"},\r\n\t\t\t\"Sum1\":\t\t\t\t\t{\"type\":\"N\"},\r\n\t\t\t\"Sum2\":\t\t\t\t\t{\"type\":\"N\"},\r\n\t\t\t\"Debt\":\t\t\t\t\t{\"type\":\"N\"},\r\n\t\t\t\"SumExt\":\t\t\t\t{\"type\":\"N\"},\r\n\t\t\t\"SumExt2\":\t\t\t\t{\"type\":\"N\"},\r\n\t\t\t\"SumExt3\":\t\t\t\t{\"type\":\"N\"},\r\n\t\t\t\"SumExtNDS\":\t\t\t{\"type\":\"N\"},\r\n\t\t\t\"RateNDS\":\t\t\t\t{\"type\":\"N\"},\r\n\t\t\t\"RateSpecTax\":\t\t{\"type\":\"N\"},\r\n\t\t\t\"SumNDS\":\t\t\t\t{\"type\":\"N\"},\r\n\t\t\t\"SumSpecTax\":\t\t{\"type\":\"N\"},\r\n\t\t\t\"Notice\":\t\t\t\t{\"type\":\"S\"},\r\n\t\t\t\"DocFlag\":\t\t\t\t{\"type\":\"S\"},\r\n\t\t\t\"FilterGS\":\t\t\t\t{\"type\":\"S\"},\r\n\t\t\t\"IsDeleted\":\t\t\t{\"type\":\"N\"},\r\n\t\t\t\"DateNew\":\t\t\t{\"type\":\"D\"},\r\n\t\t\t\"UserNew\":\t\t\t\t{\"type\":\"S\"},\r\n\t\t\t\"DateEdit\":\t\t\t\t{\"type\":\"D\", \"value\": \"NOW()\"},\r\n\t\t\t\"UserEdit\":\t\t\t\t{\"type\":\"S\"},\r\n\t\t\t\"TextAVR\":\t\t\t\t{\"type\":\"S\"},\r\n\t\t\t\"Addr\":\t\t\t\t\t{\"type\":\"S\"},\r\n\t\t\t\"Debt2\":\t\t\t\t{\"type\":\"N\"},\r\n\t\t\t\"SumExt4\":\t\t\t\t{\"type\":\"N\"}\r\n\t\t}\r\n\r\n\r\n\t}\r\n);\r\n\r\nmodule.exports = DocDataModel;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./fabula-object-model/data-models/DocDataModel.js\n ** module id = 14\n ** module chunks = 0\n **/","// ------------------------------------------------------\r\n// Номенклатура\r\n\r\n// Для совместимости\r\nvar getContextDB = function(){\r\n\tvar FabulaObjectModel = require(\"./../_FabulaObjectModel.js\");\r\n\tvar DBModel = FabulaObjectModel.prototype.DBModel;\r\n\r\n\tif (  this._fabulaInstance ){\r\n\t\treturn this._fabulaInstance.getDBInstance();\r\n\t}\r\n\treturn DBModel.prototype.getInstance();\r\n};\r\n\r\nvar GandsDataModel = function(){\r\n\tthis.init();\r\n};\r\n\r\nGandsDataModel.prototype = {\r\n\t\"init\" : function(){\r\n\r\n\t\tthis.dbModel = null;\r\n\r\n\t\tthis.data = [];\r\n\r\n\t\tthis.instances.push(this);\r\n\r\n\t\tthis.GSUnits = Object.create(null);\r\n\r\n\t\tthis.state = 0;\r\n\r\n\t},\r\n\r\n\t\"instances\" : [],\r\n\r\n\t\"getInstance\" : function(){\r\n\t\tif (this.instances.length){\r\n\t\t\treturn this.instances[0];\r\n\t\t}\r\n\t\treturn new GandsDataModel();\r\n\t},\r\n\r\n\t\"load\" : function(A){\r\n\t\tif (typeof A == \"undefined\") A = Object.create(null);\r\n\t\tvar callback = (typeof A.callback == \"function\" ? A.callback : function(){} );\r\n\t\tvar db = getContextDB.call(this);\r\n\t\tvar self = this;\r\n\r\n\t\tvar dbq = [\r\n\t\t\t\"SELECT * FROM Gands \" \t\t\t+\r\n\t\t\t\"WHERE \" \t\t\t\t\t\t\t\t+\r\n\t\t\t\t\"GSCOP LIKE '87%' \"\t\t\t+\r\n\t\t\t\t\"OR GSCOP LIKE '17%' \"\t\t+\r\n\t\t\t\t\"OR GSCOP LIKE '27%' \"\t\t+\r\n\t\t\t\t\"OR GSCOP LIKE '07%' \",\r\n\r\n\t\t\t\"SELECT * FROM GandsExt \"\t\t\t\t\t\t+\r\n\t\t\t\"WHERE \"\t\t\t\t\t\t\t\t\t\t\t\t+\r\n\t\t\t\"GSExID IN (\"\t\t\t\t\t\t\t\t\t\t\t+\r\n\t\t\t\t\"SELECT GSID FROM Gands WHERE \"\t\t+\r\n\t\t\t\t\"GSCOP LIKE '87%' \"\t\t\t\t\t\t\t+\r\n\t\t\t\t\"OR GSCOP LIKE '17%' \"\t\t\t\t\t\t+\r\n\t\t\t\t\"OR GSCOP LIKE '27%' \"\t\t\t\t\t\t+\r\n\t\t\t\t\"OR GSCOP LIKE '07%'\"\t\t\t\t\t\t+\r\n\t\t\t\")\"\r\n\t\t];\r\n\r\n\t\tif (db){\r\n\t\t\tdb.dbquery({\r\n\t\t\t\t\"query\" : dbq.join(\"; \"),\r\n\t\t\t\t\"callback\" : function(res){\r\n\t\t\t\t\tself.data = res[0].recs;\r\n\t\t\t\t\tself.state = 1;\r\n\r\n\t\t\t\t\tvar c, L, gandsRef = Object.create(null);\r\n\r\n\t\t\t\t\tfor(c=0; c<self.data.length; c++){\r\n\t\t\t\t\t\tgandsRef[self.data[c].GSID] = self.data[c];\r\n\t\t\t\t\t\tself.data[c].gandsExtRef = [];\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tself.dataReferences = gandsRef;\r\n\r\n\t\t\t\t\tvar gandsExt = res[1].recs;\r\n\r\n\t\t\t\t\tfor(c=0; c<gandsExt.length; c++){\r\n\t\t\t\t\t\tif (  typeof gandsRef[gandsExt[c].GSExID] == \"undefined\"  ) continue;\r\n\t\t\t\t\t\tgandsRef[gandsExt[c].GSExID].gandsExtRef.push(gandsExt[c]);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfor(c= 0, L=self.data.length; c<L; c++){\r\n\t\t\t\t\t\tif (typeof self.GSUnits[self.data[c].GSID] == \"undefined\") {\r\n\t\t\t\t\t\t\tself.GSUnits[self.data[c].GSID] = self.data[c].GSUnit\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tcallback(self.data);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\r\n\t\"get\" : function(A){\r\n\t\tif (typeof A != \"object\") A = Object.create(null);\r\n\t\tvar type = (typeof A.type != \"object\" ? [] : A.type );\r\n\t\tvar cop = typeof A.cop != \"object\" ? [] : A.cop;\r\n\r\n\t\tif (!type.length && !cop.length) return this.data;\r\n\r\n\t\tvar tmp = [], c, v;\r\n\r\n\t\tfor (c = 0; c < this.data.length; c++) {\r\n\r\n\t\t\tif (  tmp.indexOf(this.data[c]) > -1  ) continue;\r\n\r\n\t\t\t// Соответсвует ТМЦ / Бумага\r\n\t\t\t// Сюда могут быть включены: картон, самокопирка и пр.\r\n\t\t\tif (\r\n\t\t\t\ttype.indexOf(\"material-paper\") > -1\r\n\t\t\t\t&& this.data[c].GSID.toLowerCase().match(/тцбу/gi)\r\n\t\t\t\t&& this.data[c].GSID.length > 4\r\n\t\t\t) {\r\n\t\t\t\ttmp.push(this.data[c]);\r\n\t\t\t}\r\n\r\n\t\t\t// Выбирает из ТМЦ / Бумага только конкретно бумагу\r\n\t\t\tif (\r\n\t\t\t\ttype.indexOf(\"paper\") > -1\r\n\t\t\t\t&& this.data[c].GSID.toLowerCase().match(/тцбуме|тцбуоф|тцбуса|тцбуск|тцбуцп|тцбуфб/gi)\r\n\t\t\t) {\r\n\t\t\t\ttmp.push(this.data[c]);\r\n\t\t\t}\r\n\r\n\t\t\tif (\r\n\t\t\t\ttype.indexOf(\"materials:print\") > -1\r\n\t\t\t\t&& this.data[c].GSID.match(/тцмп/gi)\r\n\t\t\t){\r\n\t\t\t\tif (\r\n\t\t\t\t\tthis.data[c].GSID.match(/тцмпбг|тцмпкк|тцмпкл|тцмпкр|тцмпкт|тцмпрс|тцмпс1|тцмпск|тцмпто/gi)\r\n\t\t\t\t\t|| this.data[c].GSID.length <= 6\r\n\t\t\t\t){\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\ttmp.push(this.data[c]);\r\n\t\t\t}\r\n\r\n\t\t\tif (\r\n\t\t\t\ttype.indexOf(\"carton\") > -1\r\n\t\t\t\t&& this.data[c].GSID.toLowerCase().match(/тцбуд1|тцбуд3|тцбукр|тцбупр/gi)\r\n\t\t\t) {\r\n\t\t\t\ttmp.push(this.data[c]);\r\n\t\t\t}\r\n\r\n\t\t\tif (\r\n\t\t\t\ttype.indexOf(\"envelope\") > -1\r\n\t\t\t\t&& this.data[c].GSID.toLowerCase().match(/тцбуко/)\r\n\t\t\t) {\r\n\t\t\t\ttmp.push(this.data[c]);\r\n\t\t\t}\r\n\r\n\t\t\tif (type.indexOf(\"products\") > -1) {\r\n\t\t\t\tif (\r\n\t\t\t\t\tthis.data[c].GSCOP.match(/17/)\r\n\t\t\t\t\t|| this.data[c].GSCOP.match(/27/)\r\n\t\t\t\t) {\r\n\t\t\t\t\tif (!this.data[c].GSCOP.match(/276|176/)) {\r\n\t\t\t\t\t\ttmp.push(this.data[c]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (type.indexOf(\"print\") > -1) {\r\n\t\t\t\tif (\r\n\t\t\t\t\tthis.data[c].GSCOP.match(/17/)\r\n\t\t\t\t\t|| this.data[c].GSCOP.match(/27/)\r\n\t\t\t\t\t|| this.data[c].GSCOP.match(/07/)\r\n\t\t\t\t) {\r\n\t\t\t\t\ttmp.push(this.data[c]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (type.indexOf(\"products:print\") > -1) {\r\n\t\t\t\tif (\r\n\t\t\t\t\tthis.data[c].GSCOP.match(/17/)\r\n\t\t\t\t\t|| this.data[c].GSCOP.match(/27/)\r\n\t\t\t\t) {\r\n\t\t\t\t\tif (!this.data[c].GSCOP.match(/276|176/)) {\r\n\t\t\t\t\t\ttmp.push(this.data[c]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t/*\r\n\t\t\tif (type.indexOf(\"postproc:COP17\") > -1) {\r\n\t\t\t\tif (  this.data[c].GSCOP == \"176\" ) {\r\n\t\t\t\t\ttmp.push(this.data[c]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (type.indexOf(\"postproc:cutting\") > -1) {\r\n\t\t\t\tif (  this.data[c].GSID.match(/ПЗРАВЫ|РУПОДП01|ДХПОДОВы/)  ) {\r\n\t\t\t\t\ttmp.push(this.data[c]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (type.indexOf(\"postproc:COP27\") > -1) {\r\n\t\t\t\tif (  this.data[c].GSCOP == \"276\" ) {\r\n\t\t\t\t\ttmp.push(this.data[c]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (type.indexOf(\"COP07\") > -1){\r\n\t\t\t\tif (  this.data[c].GSCOP == \"07\" ) {\r\n\t\t\t\t\ttmp.push(this.data[c]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t*/\r\n\r\n\t\t\tfor(v=0; v<cop.length; v++){\r\n\t\t\t\tif (  cop[v] instanceof RegExp  ){\r\n\t\t\t\t\tif (  this.data[c].GSCOP.match(cop[v])  ){\r\n\t\t\t\t\t\ttmp.push(this.data[c]);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else if (  typeof cop[v].GSCOP == \"string\"  ) {\r\n\t\t\t\t\tif (  cop[v] == this.data[c]  ){\r\n\t\t\t\t\t\ttmp.push(this.data[c]);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn tmp;\r\n\t},\r\n\r\n\t\"getGSUnit\": function(GSID){\r\n\t\tif (typeof GSID == \"undefined\") return;\r\n\r\n\t\tif (typeof this.GSUnits[GSID] == \"undefined\") return;\r\n\r\n\t\treturn this.GSUnits[GSID];\r\n\t}\r\n\r\n};\r\n\r\nmodule.exports = GandsDataModel;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./fabula-object-model/data-models/GandsDataModel.js\n ** module id = 15\n ** module chunks = 0\n **/","// ------------------------------------------------------\r\n// Данные из базы о предприятиях\r\n\r\n// Для совместимости\r\nvar getContextDB = function(){\r\n\tvar FabulaObjectModel = require(\"./../_FabulaObjectModel.js\");\r\n\tvar DBModel = FabulaObjectModel.prototype.DBModel;\r\n\r\n\tif (  this._fabulaInstance ){\r\n\t\treturn this._fabulaInstance.getDBInstance();\r\n\t}\r\n\treturn DBModel.prototype.getInstance();\r\n};\r\n\r\nvar FirmsDataModel = function(){\r\n\tthis.init();\r\n};\r\n\r\nFirmsDataModel.prototype = {\r\n\t\"init\" : function(){\r\n\r\n\t\tthis.dbModel = null;\r\n\r\n\t\tthis.data = [];\r\n\r\n\t\tthis.instances.push(this);\r\n\r\n\t\tthis.state = 0;\r\n\r\n\t},\r\n\r\n\t\"instances\" : [],\r\n\r\n\t\"getInstance\" : function(){\r\n\t\tif (this.instances.length){\r\n\t\t\treturn this.instances[0];\r\n\t\t}\r\n\t\treturn new FirmsDataModel();\r\n\t},\r\n\r\n\t\"load\" : function(A){\r\n\t\tif (typeof A == \"undefined\") A = Object.create(null);\r\n\t\tvar callback = (typeof A.callback == \"function\" ? A.callback : function(){} );\r\n\t\tvar db = getContextDB.call(this);\r\n\t\tvar self = this;\r\n\t\tif (db){\r\n\t\t\tdb.dbquery({\r\n\t\t\t\t\"query\" : \"SELECT FirmID, Name FROM Firms\",\r\n\t\t\t\t\"dbsrc\" : \"common\",\r\n\t\t\t\t\"callback\" : function(res){\r\n\t\t\t\t\tself.data = res.recs;\r\n\t\t\t\t\tself.state = 1;\r\n\t\t\t\t\tcallback(self.data);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\r\n\t\"get\" : function(){\r\n\t\treturn this.data;\r\n\t}\r\n};\r\n\r\nmodule.exports = FirmsDataModel;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./fabula-object-model/data-models/FirmsDataModel.js\n ** module id = 16\n ** module chunks = 0\n **/","// ------------------------------------------------------\r\n// Список путей\r\n\r\n// Для совместимости\r\nvar getContextDB = function(){\r\n\tvar FabulaObjectModel = require(\"./../_FabulaObjectModel.js\");\r\n\tvar DBModel = FabulaObjectModel.prototype.DBModel;\r\n\r\n\tif (  this._fabulaInstance ){\r\n\t\treturn this._fabulaInstance.getDBInstance();\r\n\t}\r\n\treturn DBModel.prototype.getInstance();\r\n};\r\n\r\nvar PathsDataModel = function(){\r\n\tthis.init();\r\n};\r\n\r\nPathsDataModel.prototype = {\r\n\t\"init\" : function(){\r\n\r\n\t\tthis.dbModel = null;\r\n\r\n\t\tthis.data = [];\r\n\r\n\t\tthis.instances.push(this);\r\n\r\n\t\tthis.state = 0;\r\n\r\n\t},\r\n\r\n\t\"instances\" : [],\r\n\r\n\t\"getInstance\" : function(){\r\n\t\tif (this.instances.length){\r\n\t\t\treturn this.instances[0];\r\n\t\t}\r\n\t\treturn new PathsDataModel();\r\n\t},\r\n\r\n\t\"load\" : function(A){\r\n\t\tif (typeof A == \"undefined\") A = Object.create(null);\r\n\t\tvar callback = (typeof A.callback == \"function\" ? A.callback : function(){} );\r\n\t\tvar db = getContextDB.call(this);\r\n\t\tvar self = this;\r\n\t\tif (db){\r\n\t\t\tdb.dbquery({\r\n\t\t\t\t\"query\" : \"SELECT Value, Property FROM Property WHERE ExtClass = 'path' \",\r\n\t\t\t\t\"callback\" : function(res){\r\n\t\t\t\t\tself.data = res.recs;\r\n\t\t\t\t\tself.state = 1;\r\n\t\t\t\t\tcallback(self.data);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\r\n\t\"get\" : function(){\r\n\t\treturn this.data;\r\n\t}\r\n};\r\n\r\nmodule.exports = PathsDataModel;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./fabula-object-model/data-models/PathsDataModel.js\n ** module id = 17\n ** module chunks = 0\n **/","var GandsDataModel = require(\"./../GandsDataModel\");\r\n\r\nvar DefaultPrintCalc = function(){\r\n\tthis.instances.push(this);\r\n};\r\n\r\n\r\nDefaultPrintCalc.prototype.instances = [];\r\n\r\n\r\nDefaultPrintCalc.prototype.getInstance = function(){\r\n\treturn this.instances.length ? this.instances[0] : new DefaultPrintCalc();\r\n};\r\n\r\n\r\n/**\r\n * @param {Object} arg\r\n * @param {Number, String} arg.amount - количество\r\n * @param {String} arg.GSID - номер в номенклатуре\r\n * */\r\nDefaultPrintCalc.prototype.calc = function(arg){\r\n\r\n\tif (typeof arg != \"object\") {\r\n\t\tthrow new Error(\"1st argument suppose to be Object\");\r\n\t}\r\n\r\n\t// ---------- Количество\r\n\tif (\r\n\t\ttypeof arg.amount == \"undefined\"\r\n\t\t|| isNaN(arg.amount)\r\n\t) {\r\n\t\tthrow new Error(\"arg.amount suppose to be Numeric\");\r\n\t}\r\n\r\n\tvar argAmount = +arg.amount;\r\n\r\n\t// ---------- Код в номенклатуре\r\n\tif (\r\n\t\ttypeof arg.GSID != \"string\"\r\n\t\t|| !arg.GSID\r\n\t){\r\n\t\tthrow new Error(\"arg.GSID suppose to be String\");\r\n\t}\r\n\r\n\tvar argGSID = arg.GSID;\r\n\r\n\t// ---------- Расход / Доход\r\n\tvar salePrice = true;\r\n\tif (typeof arg.salePrice != \"undefined\") salePrice = Boolean(arg.salePrice);\r\n\r\n\tvar gandsM = GandsDataModel.prototype.getInstance();\r\n\r\n\tif (  !gandsM.dataReferences.has(argGSID)  ){\r\n\t\treturn 0;\r\n\t}\r\n\r\n\tvar gandsRow = gandsM.dataReferences.get(argGSID);\r\n\r\n\tvar prices = {\r\n\t\t\"price\": salePrice ? gandsRow.GSCostSale : gandsRow.GSCost,\r\n\t\t\"gsCost\": gandsRow.GSCost,\r\n\t\t\"gsCostSale\": gandsRow.GSCostSale\r\n\t};\r\n\r\n\tprices.sum = prices.price * argAmount;\r\n\r\n\tvar loopPrice, loopAmount, cost = 0, kol = 0;\r\n\r\n\tgandsRow.gandsExtRef.sort(function(a, b){\r\n\t\treturn a.GSExSort - b.GSExSort;\r\n\t});\r\n\r\n\tfor(var c=0; c<gandsRow.gandsExtRef.length; c++) {\r\n\t\tloopPrice = +gandsRow.gandsExtRef[c].GSExNum;\r\n\t\tloopAmount = +gandsRow.gandsExtRef[c].GSExSort;\r\n\r\n\t\t// Цена покупки\r\n\t\tif (\r\n\t\t\t!salePrice\r\n\t\t\t&& gandsRow.gandsExtRef[c].GSExType.toLowerCase().trim() == \"цена продажи\"\r\n\t\t) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\r\n\t\t// Цена продажи\r\n\t\tif (\r\n\t\t\tsalePrice\r\n\t\t\t&& gandsRow.gandsExtRef[c].GSExType.toLowerCase().trim() != \"цена продажи\"\r\n\t\t) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\r\n\t\t// ------------------------------------------------------------\r\n\t\t// Автор блока: Миланин Альберт\r\n\t\t{\r\n\r\n\t\t\tif (argAmount >= loopAmount) {\r\n\t\t\t\tcost = loopPrice;\r\n\t\t\t\tkol = loopAmount;\r\n\r\n\t\t\t} else if (argAmount <= loopAmount) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tif (cost == 0) {\r\n\t\t\t\t\t\tcost = loopPrice / ( loopAmount || 1 ) * argAmount;\r\n\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tcost = cost + ( loopPrice - cost ) * ( argAmount - kol ) / ( loopAmount - kol );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tkol = argAmount;\r\n\t\t\t\t}\r\n\t\t\t\tcatch (ex) {\r\n\t\t\t\t\tconsole.error(ex);\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t} // close.loop\r\n\r\n\tvar ret = {\r\n\t\t\"price\": prices.price,\r\n\t\t\"sum\": prices.sum\r\n\t};\r\n\r\n\tif (  cost  ) {\r\n\t\tret.sum = cost;\r\n\t\tret.price = cost / (( argAmount > kol ) ? kol : argAmount) || 1;\r\n\t}\r\n\r\n\treturn ret;\r\n\r\n};\r\n\r\nmodule.exports = DefaultPrintCalc;\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./fabula-object-model/data-models/calc/DefaultPrintCalc.js\n ** module id = 18\n ** module chunks = 0\n **/"],"sourceRoot":""}