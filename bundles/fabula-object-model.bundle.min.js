!function(t){function e(o){if(r[o])return r[o].exports;var n=r[o]={exports:{},id:o,loaded:!1};return t[o].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var r={};return e.m=t,e.c=r,e.p="",e(0)}([function(t,e,r){!function(){var t=(r(1),r(2)),e=r(3);e.prototype.DBModel=t,e.prototype._lowMethods.dbmodel=t,e.globalize=function(){for(keys=Object.getOwnPropertyNames(this.prototype),c=0;c<keys.length;c++)window[keys[c]]=this.prototype[keys[c]]},window.FabulaObjModel=e}()},function(t,e){!function(){"undefined"!=typeof Promise&&"undefined"==typeof Promise.cascade&&(Promise.cascade=function(t,e){"object"==typeof e&&"functions"!=typeof e.join||(e=Object.create(null));var r="undefined"==typeof e.interval?0:isNaN(e.interval)?0:parseInt(e.interval),o="undefined"==typeof e.stackSize?1:isNaN(e.stackSize)?1:parseInt(e.stackSize),n=[];for(var i in t)t.hasOwnProperty(i)&&n.push(t[i]);t=n;var s=function(e,n){var i,a=[],p=[];for(i=0;i<t.length;i++)null!==t[i]&&p.push(t[i]);for(t=p,i=0;i<t.length&&("function"==typeof t[i]&&a.push(new Promise(t[i])),t[i]=null,!(a.length>=o||t.length==i+1));i++);t.length||e(),Promise.all(a).then(function(){setTimeout(function(){s(e,n)},r)})["catch"](function(t){n(t)})};return new Promise(s)})}()},function(t,e){var r=function(t,e){this.callback="function"==typeof t.callback?t.callback:new Function,this.t0=new Date;var r=JSON.stringify({query:t.query,format:"awws",dbname:t.dbname,dbsrc:t.dbsrc,uid:t.uid});return e.wsClient.readyState?void e.wsClient.send(r):void e.wsOnOpenArray.push(function(){e.wsClient.send(r)})},o=function(t){this.init(t)};o.prototype={instances:[],init:function(t){if("object"!=typeof t)throw new Error("1st argument suppose to be Object");this.wsObservers=Object.create(null),this.wsClient=null,this.wsOnOpenArray=[],this.dburl="string"==typeof t.dburl?t.dburl:location.origin+"/db/",this.dbname="string"==typeof t.dbname?t.dbname:null,this.dbsrc="string"==typeof t.dbsrc?t.dbsrc:null,this.lastError="",this.errors=[],this.logs=[];var e=new URL(this.dburl);if("ws:"==e.protocol){if("function"!=typeof WebSocket)throw new Error("!WebSocket");this.wsClient=new WebSocket(this.dburl),this.wsClient.onmessage=this._wsOnMessage.bind(this),this.wsClient.onerror=this._wsOnError,this.wsClient.onopen=this._wsOnOpen.bind(this)}this.instances.push(this)},_wsOnOpen:function(){for(var t=0;t<this.wsOnOpenArray.length;t++)this.wsOnOpenArray[t]()},_wsOnMessage:function(t){var e=JSON.parse(t.data);if("undefined"==typeof this.wsObservers[e.uid])throw new Error("!wsObserver");if("function"!=typeof this.wsObservers[e.uid].callback)throw new Error("!wsObserver.callback");this.wsObservers[e.uid].callback(e.dbres),console.log((new Date-this.wsObservers[e.uid].t0)/1e3,t),delete this.wsObservers[e.uid]},_wsOnError:function(t){throw t},getInstance:function(t){if("object"!=typeof t)return this.instances.length?this.instances[0]:new o(void 0);for(var e=0;e<this.instances.length;e++)if(("string"!=typeof t.dburl||this.instances[e].dburl==t.dburl)&&!("string"==typeof t.dbname&&this.instances[e].dbname!=t.dbname||"string"==typeof t.dbsrc&&this.instances[e].dbsrc!=t.dbsrc))return this.instances[e];return new o(t)},_convert:function(t){var e,r,o,n,i,s,a=[];for(Array.isArray(t)||(t=[t]),e=0;e<t.length;e++){var p={info:{t:-1,t_fx:-1,t_fabula:t[e].t,t_jsDecode:-1,num_rows:t[e].res.length,errors:t[e].err},recs:[]};for(r=0;r<t[e].res.length;r++){n=t[e].res[r];var c={};for(o=0;o<n.length;o++)i=n[o],s=t[e].fld[o].Name,c[s]=i;p.recs.push(c)}a.push(p)}return 1==a.length?a[0]:a},_dbquery_ws:function(t){if("object"!=typeof t)throw new Error("1st argument suppose to be Object");if("string"!=typeof t.query)throw new Error("arg.query suppose to be String");var e=this;if(t.uid=Math.random()*Math.pow(10,18),"function"==typeof t.callback){var o=t.callback;t.callback=function(t){o(e._convert(t))}}this.wsObservers[t.uid]=new r(t,this)},_dbquery_http:function(t){var e=this,r="string"==typeof t.query?t.query:null,o="string"==typeof t.dburl?t.dburl:this.dburl,n="string"==typeof t.dbname?t.dbname:this.dbname,i="string"==typeof t.dbsrc?t.dbsrc:this.dbsrc,s="function"==typeof t.callback?t.callback:new Function,a=new XMLHttpRequest;a.open("POST",o,!0),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a.onreadystatechange=function(){if(4==this.readyState){var t={err:"",t:0,recs:0,fld:[],res:[]};200!=this.status?t.err="status != 200":t=JSON.parse(this.responseText),s(e._convert(t))}};var p=["query="+encodeURIComponent(r),"dbsrc="+encodeURIComponent(i?i:""),"dbname="+encodeURIComponent(n?n:""),"format="+encodeURIComponent("awws")];p=p.join("&"),a.send(p)},dbquery:function(t){"undefined"==typeof t&&(t=Object.create(null));var e="string"==typeof t.query?t.query:null,r="function"==typeof t.callback?t.callback:new Function;if(!e)throw r({info:{errors:["!dbquery"],num_rows:0},recs:[]}),new Error("!dbquery");this.logs.length>50&&(this.logs=[]),this.logs.push(e),this.wsClient?this._dbquery_ws.apply(this,arguments):this._dbquery_http.apply(this,arguments)}},t.exports=o},function(t,e,r){var o,n,i=function(t){this._dbInstance=this.DBModel.prototype.getInstance(t),this.instances.push(this)};for(i.prototype={},i.prototype.AgentsDataModel=r(4),i.prototype.DataModelAdapters=r(5),i.prototype.DefaultDataModel=r(8),i.prototype.DocDataModel=r(13),i.prototype.FirmsDataModel=r(15),i.prototype.GandsDataModel=r(14),i.prototype.InterfaceEvents=r(10),i.prototype.InterfaceFProperty=r(10),i.prototype.MovDataModel=r(7),i.prototype.PathsDataModel=r(16),i.prototype.TalksDataModel=r(12),i.prototype.utils=r(6),i.prototype.ObjectA=r(11),i.prototype.DBModel=r(2),i.prototype._lowMethods=Object.create(null),o=Object.getOwnPropertyNames(i.prototype),n=0;n<o.length;n++)"_lowMethods"!=o[n]&&(i.prototype._lowMethods[o[n].toLowerCase()]=i.prototype[o[n]]);i.prototype.create=function(t,e){if("string"!=typeof t)throw new Error("1st argument suppose to be String");var r=t;if(t=t.toLowerCase(),"function"!=typeof this._lowMethods[t])throw new Error('Class "'+r+'" does not exist');var o,n=this._lowMethods[t];return o="function"==typeof n.prototype.getInstance?new n.prototype.getInstance:new n,o._fabulaInstance=this,o},i.prototype.getDBInstance=function(){return this._dbInstance},i.prototype.instances=[],i.prototype.getInstance=function(t){return this.instances.length?this.instances[0]:new i(t)},t.exports=i},function(t,e,r){var o=function(){var t=r(3),e=t.prototype.DBModel;return this._fabulaInstance?this._fabulaInstance.getDBInstance():e.prototype.getInstance()},n=function(){this.init()};n.prototype={init:function(){this.dbModel=null,this.data=[],this.instances.push(this),this.state=0},instances:[],getInstance:function(){return this.instances.length?this.instances[0]:new n},load:function(t){"undefined"==typeof t&&(t=Object.create(null));var e="function"==typeof t.callback?t.callback:function(){},r=o.call(this),n=this;r&&r.dbquery({query:"SELECT AgentID, FIO, NameShort, NameFull, User FROM Agents",callback:function(t){n.data=t.recs,n.state=1,e(n.data)}})},get:function(){return this.data}},t.exports=n},function(t,e,r){var o=r(6),n=r(7),i=r(13),s=r(14),a=s.prototype.getInstance(),p=Object.create(null);p._getProperty=function(t,e,r){for(var o,n=[],i=0;i<arguments.length;i++)if("object"==typeof arguments[i]&&arguments[i]){if(i)if(1==i)o=this._getParentObj();else{if(2!=i)continue;o=this._getChildrenObj()}else o=this._getSelfObj();if(o){Array.isArray(o)||(o=[o]);for(var s=0;s<o.length;s++)n=n.concat(o[s].getProperty(arguments[i]));if(2==i)break}}return n},p._updateProperty=function(t,e,r,o,n,i){for(var s,a=0,p=0;p<arguments.length;p++)if("object"==typeof arguments[p]&&arguments[p]){if(p)if(2==p)s=this._getParentObj();else{if(4!=p)continue;s=this._getChildrenObj()}else s=this._getSelfObj();if(s){Array.isArray(s)||(s=[s]);for(var c=0;c<s.length;c++)a+=s[c].updateProperty(arguments[p],arguments[p+1]);if(5==p)break}}return a>0},p._upsertProperty=function(t,e,r,s,a,p){for(var c,l,u=0,h=0;h<arguments.length;h++)if("object"==typeof arguments[h]&&arguments[h]){if(h)if(2==h)c=this._getParentObj();else{if(4!=h)continue;c=this._getChildrenObj()}else c=this._getSelfObj();if(c){Array.isArray(c)||(c=[c]);for(var f=0;f<c.length;f++)l=o.objectKeysToLowerCase(arguments[h+1]),l.hasOwnProperty("pid")&&"undefined"!=typeof l.pid&&null!==l.pid&&""!==l.pid||(c[f]instanceof n?l.pid=c[f].get("MMID"):c[f]instanceof i&&(l.pid=0)),u+=c[f].upsertProperty(arguments[h],l);if(5==h)break}}return u>0},p._deleteProperty=function(t,e,r){for(var o,n=0,i=0;i<arguments.length;i++)if("object"==typeof arguments[i]&&arguments[i]){if(i)if(1==i)o=this._getParentObj();else{if(2!=i)continue;o=this._getChildrenObj()}else o=this._getSelfObj();if(o){Array.isArray(o)||(o=[o]);for(var s=0;s<o.length;s++)n+=o[s].deleteProperty(arguments[i]);if(2==i)break}}return n>0},p._addProperty=function(t,e,r){var s,a,p,c;for(a=0;a<arguments.length;a++)if("object"==typeof arguments[a]&&arguments[a]){if(a)if(1==a)s=this._getParentObj();else{if(2!=a)continue;s=this._getChildrenObj()}else s=this._getSelfObj();if(s){for(Array.isArray(s)||(s=[s]),p=0;p<s.length;p++)c=o.objectKeysToLowerCase(arguments[a]),c.hasOwnProperty("pid")&&"undefined"!=typeof c.pid&&null!==c.pid&&""!==c.pid||(s[p]instanceof n?c.pid=s[p].get("MMID"):s[p]instanceof i&&(c.pid=0)),s[p].addProperty(c);if(2==a)break}}},p._getPropertyValue=function(){for(var t=this.getProperty.apply(this,arguments),e=0;e<t.length;e++)t[e]=t[e].value;return t},p.MovTaskAdapter=function(t){if(!arguments.length)throw new Error("arguments.length == 0");if(t instanceof n==0)throw new Error('1st argument suppose to be "MovDataModel"');this.mov=t},p.MovTaskAdapter.prototype={getProperty:p._getProperty,updateProperty:p._updateProperty,upsertProperty:p._upsertProperty,getPropertyValue:p._getPropertyValue,addProperty:p._addProperty,deleteProperty:p._deleteProperty,_getSelfObj:function(){return this.mov},_getParentObj:function(){return this.mov.parentMov},_getChildrenObj:function(){return this.mov.childrenMovs},getCuttingTemplates:function(){var t,e=[],r=a.get({type:["postproc:cutting"]});for(t=0;t<r.length;t++)r[t]=r[t].GSID.toLowerCase();var o=this.mov.childrenMovs;for(t=0;t<o.length;t++)if(o[t]&&"object"==typeof o[t]&&-1!=r.indexOf(o[t].get("GS").toLowerCase())){e=e.concat(o[t].getProperty({Property:"Макет исходящий"}));break}return e},setCuttingTemplates:function(t){var e,r,n=[];if("string"==typeof t&&(t=[t]),!Array.isArray(t))throw new Error("argument suppose to be String or Array type");for(e=0;e<t.length;e++)if("string"==typeof t[e])n.push({value:t[e],property:"Макет исходящий"});else if("object"==typeof t[e]){if(r=o.objectKeysToLowerCase(t[e]),!r.hasOwnProperty("value")||!r.value)continue;r.property="Макет исходящий",n.push(r)}var i=a.get({type:["postproc:cutting"]});for(e=0;e<i.length;e++)i[e]=i[e].GSID.toLowerCase();var s=this.mov.childrenMovs,p=!1;for(e=0;e<s.length;e++)if(s[e]&&"object"==typeof s[e]&&s[e]&&-1!=i.indexOf(s[e].get("GS").toLowerCase())){s[e].deleteProperty({Property:"Макет исходящий"}),s[e].addProperty(n),p=!0;break}return p},getComments:function(){return this.getPropertyValue({Property:"Комментарий"})},setComment:function(t){if("string"!=typeof t)throw new Error('type != "String"');this.mov.removeProperty({Property:"Комментарий"}),t.trim()&&this.mov.addProperty(this.mov.splitProperty({Property:"Комментарий",value:t}))},setPostproc:function(t){var e,r,o=this._getSelfObj(),i=[];for(r=0;r<t.length;r++)"object"==typeof t[r]&&t[r]&&(e=o.getCMov({mmid:t[r].mmid}),e.length&&t[r].mmid?e=e[0]:(e=new n,o.addChildMov(e)),e.set(t[r]),i.push(e.get("MMID")));var s=o.getCMov();for(r=0;r<s.length;r++)s[r].get("MMID")&&-1==i.indexOf(s[r].get("MMID"))&&o.removeCMov(s[r])},getPostprocMov:function(){var t,e,r=a.get({cop:[new RegExp("07","gi")]}),o=[],n=[];for(t=0;t<r.length;t++)n[t]=r[t].GSID.toLowerCase();var i=this.mov.childrenMovs;for(t=0;t<i.length;t++)e=i[t].get("GS"),"string"==typeof e&&(e=e.toLowerCase(),-1!=n.indexOf(e)&&o.push(i[t]));return o},getPostprocObject:function(){for(var t=this.getPostprocMov(),e=0;e<t.length;e++)t[e]=t[e].getJSON();return t}},p.DocAdapter=function(t){if(!arguments.length)throw new Error("!arguments.length");if(t instanceof i==0)throw new Error('1st argument suppose to be "DocDataModel"');this.doc=t},p.DocAdapter.prototype={getPropertyValue:p._getPropertyValue,_getSelfObj:function(){return this.doc},_getParentObj:function(){return null},_getChildrenObj:function(){return null},getProperty:p._getProperty,addProperty:p._addProperty,deleteProperty:p._deleteProperty,getGrossSum:function(){for(var t=this.doc.movs,e=0,r=0;r<t.length;r++)e+=t[r].get("Sum");return e},getNote:function(){return this.getPropertyValue({Property:"Примечание"})},setNote:function(t){if("string"!=typeof t)throw new Error('type != "String"');this.doc.removeProperty({Property:"Примечание"}),t.trim()&&this.doc.addProperty(this.doc.splitProperty({Property:"Примечание",value:t}))}},t.exports=p},function(t,e){var r=Object.create(null);r.DBSecureStr=function(t){if(arguments.length){if("string"!=typeof t)return t;for(var e=[[new RegExp(/["']/g),""],["№","N"]],r=0;r<e.length;r++)t=t.replace(e[r][0],e[r][1]);return t}},r.msplit=function(t,e){if("string"==typeof t)t=[t];else if(!Array.isArray(t))throw new Error('First argument suppose to be "Array" or "String"');if("string"!=typeof e)throw new Error('Second argument suppose to be "String"');var r=new RegExp("["+t.join("")+"]","g");return e=e.replace(r,t[0]),e.split(t[0])},r.split=function(t,e){this.msplit.apply(this,arguments)},r.trim=function(t,e,r){if("string"!=typeof t)throw new Error("1st argument suppose to be String");if("string"==typeof e)e=e.split("");else if(!Array.isArray(e))throw new Error("1st argument suppose to be String or Array");for("number"!=typeof r&&(r=-1),t=t.split("");t.length;)if((-1===r||0===r)&&e.indexOf(t[0])>-1)t.shift();else{if(-1!==r&&1!==r||!(e.indexOf(t[t.length-1])>-1))break;t.pop()}return t.join("")},r.ltrim=function(t,e){var r=Array.prototype.slice.call(arguments,0);return r[2]=0,this.trim.apply(this,r)},r.rtrim=function(t,e){var r=Array.prototype.slice.call(arguments,0);return r[2]=1,this.trim.apply(this,r)},r.arrayRemove=function(t,e,r){var o=t.slice((r||e)+1||t.length);return t.length=0>e?t.length+e:e,t.push.apply(t,o)},r.arrayRest=function(t,e){if("object"!=typeof t)throw new Error("1st argument suppose to be Array");if("number"!=typeof e)throw new Error("2nd argument suppose to be Number");return Array.prototype.slice.call(t,Math.abs(e))},r.objectHasOwnProperty=function(t,e){if(arguments.length<2)return!1;if("object"!=typeof t)return!1;for(var r=Object.getOwnPropertyNames(t),o=0;o<r.length;o++)if(r[o]==e)return!0;return!1},r.objectKeysToLowerCase=function(t){if("object"!=typeof t)return null;for(var e=Object.getOwnPropertyNames(t),r={},o=0;o<e.length;o++)r[e[o].toLowerCase()]=t[e[o]];return r},r.objectKeysToUpperCase=function(t){if("object"!=typeof t)return null;for(var e=Object.getOwnPropertyNames(t),r={},o=0;o<e.length;o++)r[e[o].toUpperCase()]=t[e[o]];return r},r.URLHashParse=function(){var t={};if(location.hash){var e=location.hash.replace("#","");e=e.split("&");for(var r=0;r<e.length;r++){var o=e[r].match(/=/g);if(o&&1==o.length){var n=e[r].split("=");t[n[0]]=n[1]}}}return t},r.URLHashSet=function(t){var e,r=this,o="undefined"==typeof t.newHash?!1:t.newHash,n=o?Object.create(null):r.URLHashParse();for(e in t.vars)t.vars.hasOwnProperty(e)&&(null===t.vars[e]?delete n[e]:n[e]=t.vars[e]);var i=[];for(e in n)n.hasOwnProperty(e)&&i.push(e+"="+n[e]);i="#"+i.join("&"),location.hash=i},r.URLQueryParse=function(){var t={};if(location.search){var e=location.search.replace(/^[?]/,"");e=e.split("&");for(var r=0;r<e.length;r++){var o=e[r].match(/=/g);if(o&&1==o.length){var n=e[r].split("=");t[n[0]]=n[1]}}}return t},r.URLQuerySet=function(t){var e,r="undefined"==typeof t.newQuery?!1:t.newQuery,o=r?Object.create(null):this.URLQueryParse();for(e in t.vars)t.vars.hasOwnProperty(e)&&(null===t.vars[e]?delete o[e]:o[e]=t.vars[e]);var n=[];for(e in o)o.hasOwnProperty(e)&&n.push(e+"="+o[e]);n="?"+n.join("&"),location.search=n},r.awwsBase64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(t){if(!t)return"";var e,r,o,n,i,s,a,p="",c=0;for(t=this._utf8_encode(t);c<t.length;)e=t.charCodeAt(c++),r=t.charCodeAt(c++),o=t.charCodeAt(c++),n=e>>2,i=(3&e)<<4|r>>4,s=(15&r)<<2|o>>6,a=63&o,isNaN(r)?s=a=64:isNaN(o)&&(a=64),p=p+this._keyStr.charAt(n)+this._keyStr.charAt(i)+this._keyStr.charAt(s)+this._keyStr.charAt(a);return p=(p.length>5?p.substr(5,1):"x")+p},decode:function(t){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";if(!t)return"";t=t.substr(1);var r,o,n,i,s,a,p,c="",l=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");l<t.length;)i=e.indexOf(t.charAt(l++)),s=e.indexOf(t.charAt(l++)),a=e.indexOf(t.charAt(l++)),p=e.indexOf(t.charAt(l++)),r=i<<2|s>>4,o=(15&s)<<4|a>>2,n=(3&a)<<6|p,c+=String.fromCharCode(r),64!=a&&(c+=String.fromCharCode(o)),64!=p&&(c+=String.fromCharCode(n));return c=this._utf8_decode(c)},_utf8_encode:function(t){t=t.replace(/\r\n/g,"\n");for(var e="",r=0;r<t.length;r++){var o=t.charCodeAt(r);128>o?e+=String.fromCharCode(o):o>127&&2048>o?(e+=String.fromCharCode(o>>6|192),e+=String.fromCharCode(63&o|128)):(e+=String.fromCharCode(o>>12|224),e+=String.fromCharCode(o>>6&63|128),e+=String.fromCharCode(63&o|128))}return e},_utf8_decode:function(t){for(var e="",r=0,o=0,n=0,i=0;r<t.length;)o=t.charCodeAt(r),128>o?(e+=String.fromCharCode(o),r++):o>191&&224>o?(n=t.charCodeAt(r+1),e+=String.fromCharCode((31&o)<<6|63&n),r+=2):(n=t.charCodeAt(r+1),i=t.charCodeAt(r+2),e+=String.fromCharCode((15&o)<<12|(63&n)<<6|63&i),r+=3);return e}},r.parseArg=function(t){var e="string"==typeof t.into?t.into.toLowerCase():"array",r="undefined"!=typeof t.value?t.value:null,o="boolean"==typeof t.kickEmpty?t.kickEmpty:!0,n="boolean"==typeof t.toLowerCase?t.toLowerCase:!1,i="boolean"==typeof t.toUpperCase?t.toUpperCase:!1,s="boolean"==typeof t.toInt?t.toInt:!1,a="boolean"==typeof t.toFloat?t.toFloat:!1,p="boolean"==typeof t.isInt?t.isInt:!1,c="boolean"==typeof t.isFloat?t.isFloat:!1,l=Array.isArray(t.delimiters)&&t.delimiters.length?t.delimiters:[";",","],u="undefined"==typeof t.trim?[" "]:Array.isArray(t.trim)?t.trim:"string"==typeof t.trim?t.split(""):null;if(null===r)return null;if("array"==e){if(Array.isArray(r));else if("string"==typeof r)r=this.msplit(l,r);else{if(isNaN(r))return null;r=[r]}for(var h=[],f=0;f<r.length;f++){var y=r[f];if(null!==u&&"string"==typeof y&&(y=this.trim(y,u)),!o||""!==y&&null!==y){if(n&&"string"==typeof y&&(y=y.toLowerCase()),i&&"string"==typeof y&&(y=y.toUpperCase()),p||c)if("string"!=typeof y||isNaN(y)){if(p&&y-Math.floor(y)>0)continue;if(c&&y-Math.floor(y)==0)continue}else if(y=y.trim(),c){if(y=y.replace(",","."),!y.match("/[.]/"))continue}else if(p&&(y=y.replace(",","."),y.match("/[.]/")))continue;s&&(y=parseInt(y)),a&&(y=parseFloat(y)),h.push(y)}}return h}},t.exports=r},function(t,e,r){var o=r(8),n=r(10),i=r(12),s=r(6),a=function(){var t=r(3),e=t.prototype.DBModel;return this._fabulaInstance?this._fabulaInstance.getDBInstance():e.prototype.getInstance()},p=function(){o.call(this),n.call(this);var t=this;this.set({GSDate:new Date,MMID:null,MMPID:null,Doc:null,Doc1:null,IsDraft:null,GS:null,GSSpec:null,Amount:null,Sum:null,Sum2:null,Price:null,InOut:null,CodeOp:null,MMFlag:"1",Performer:null,Manager2:null,Agent2:null}),this._property=[],this.childrenMovs=[],this.parentMov=null,this.propsChanged=Object.create(null);for(var e in t.propertyKeys)t.propertyKeys.hasOwnProperty(e)&&!function(){var r=e;t.setAlias("getMethod",e,function(e){return t.getFabPropertyAliasMethod(r,e)}),t.setAlias("setMethod",e,function(e,o){return t.setFabPropertyAliasMethod(r,e,o)})}();this.setAlias("setMethod","amount",function(e){return isNaN(e)?!1:(e=parseFloat(e),0>=e&&(e=1),t.props.amount=e,t.propsChanged.amount=!0,!0)}),this.on("set:mmid",this._eventSetMMID),this.on("set:doc",this._eventSetDoc),this.on("afterset:parentdoc",this._eventSetParentDoc),this.set("_unique_sid",Math.random()*Math.pow(10,17)),this.clearChanged()};p.prototype=o.prototype._objectsPrototyping(o.prototype,n.prototype,{_eventSetGS:function(){},_eventSetMMID:function(){for(var t=arguments[1],e=0;e<this.childrenMovs.length;e++)this.childrenMovs[e].set("MMPID",t.value)},_eventSetDoc:function(){var t,e,r,o,n,i=arguments[1],s=i.value||this.get("Doc1")||this.get("ParentDoc")||null;for(t=0;t<this.childrenMovs.length;t++)this.childrenMovs[t].get("parentDoc")||this.childrenMovs[t].set("Doc",s);for(t=0;t<this._property.length;t++)if(this._property[t]){for(r=Object.getOwnPropertyNames(this._property[t]),o=[],e=0;e<r.length;e++)n=r[e].toLowerCase(),o.push(n),"extid"==n&&(this._property[t][r[e]]=s);-1==o.indexOf("extid")&&(this._property[t].extid=i.value)}},_eventSetParentDoc:function(){var t=arguments[1];"string"==typeof t.value&&(this.set("Doc1",t.value),this.set("Doc",null))},addCMov:function(){return this.addChildMov.apply(this,arguments)},addChildMov:function(t){var e,r,o;if(Array.isArray(t));else{if("object"!=typeof t)return!1;t=[t]}for(r=0;r<t.length;r++)if("object"==typeof t[r]){if(t[r]instanceof p)e=t[r];else{e=new p;for(o in t[r])("function"!=typeof t[r].hasOwnProperty||t[r].hasOwnProperty(o))&&"undefined"!=typeof t[r][o]&&e.set(o,t[r][o])}e.set("MMPID",this.get("MMID")),this.childrenMovs.push(e)}return!0},appendChildMov:function(){return this.addChildMov.apply(this,arguments)},deleteChildMov:function(){return this.removeChilldMov.apply(this,arguments)},deleteCMov:function(){return this.removeChilldMov.apply(this,arguments)},removeCMov:function(){return this.removeChilldMov.apply(this,arguments)},removeChilldMov:function(t){return"object"!=typeof t?!1:t instanceof p?(this.childrenMovs=this.childrenMovs.filter(function(e){return e?"object"!=typeof e?!1:e.get("_unique_sid")!=t.get("_unique_sid"):!1}),!0):(this.childrenMovs=this.childrenMovs.filter(function(e){if(!e)return!1;if("object"!=typeof e)return!1;for(var r=Object.getOwnPropertyNames(t),o=0;o<r.length;o++)if(e.get(r[o])!=t[r[o]])return!0;return!1}),!0)},getCMov:function(t,e){return this.getChildrenMov.apply(this,arguments)},getChildrenMov:function(t,e){if(!arguments.length)return this.childrenMovs;"object"==typeof t&&t||(t={}),"object"==typeof e&&e||(e={});var r;if(!(t instanceof p))return this.childrenMovs.filter(function(r){if(!r)return!1;if("object"!=typeof r)return!1;var o,n,i=!0;for(n=Object.getOwnPropertyNames(t),o=0;o<n.length;o++)r.get(n[o])!=t[n[o]]&&(i=!1);return n=Object.getOwnPropertyNames(e),n.length&&(r.getProperty(e).length||(i=!1)),i});for(r=0;r<this.childrenMovs.length;r++)if(this.childrenMovs[r].get("_unique_sid")==t.get("_unique_sid"))return[this.childrenMovs[r]];return[]},getJSON:function(){for(var t,e=Object.getOwnPropertyNames(this.props),r=s.objectKeysToLowerCase(this.__movDataModelDefaultFields),o={},n=0;n<e.length;n++)t=e[n].toLowerCase(),r.hasOwnProperty(t)&&(o[t]=this.props[e[n]]);return o},load:function(t){"object"!=typeof t&&(t=Object.create(null));var e,r="function"==typeof t.callback?t.callback:new Function,o=a.call(this),n=s.parseArg({value:t.fields?t.fields:null,into:"array",kickEmpty:!0,toLowerCase:!0,delimiters:[";",","]});for(n&&n.length||(n=["MMID","MMPID","ParentDoc","Doc","Doc1","GS","GSSpec","MMFlag","Amount","Sum","Sum2","Price","CodeOp","Performer","Manager2","Agent2","Format(GSDate,'yyyy-mm-dd Hh:Nn:Ss') as GSDate"]),e=0;e<n.length;e++)["sum","sum2","price"].indexOf(n[e].toLowerCase())>-1&&(n[e]="["+n[e]+"]");var i=this,c=this.get("MMID");if(c&&!isNaN(c)){c=parseInt(c);var l=["SELECT "+n.join(",")+" FROM Movement  WHERE MMID = "+c," SELECT uid, pid, ExtClass, ExtID, property, value FROM Property WHERE pid = "+c+" ","SELECT "+n.join(",")+" FROM Movement  WHERE MMPID = "+c," SELECT uid, pid, ExtClass, ExtID, property, value  FROM Property WHERE pid IN ( SELECT MMID FROM Movement WHERE MMPID = "+c+"  ) "];o.dbquery({query:l.join("; "),callback:function(t){var e,o,n;for(e=0;e<t.length;e++)t[e].info.errors&&console.error("DBDataModel."+t[e].info.errors);if(!t[0].recs.length)return void r(["!mov.length"]);var s=t[0].recs[0];for(o in s)s.hasOwnProperty(o)&&i.set(o,s[o]);i.addProperty(t[1].recs.length?t[1].recs:[]);var a,c,l=t[2].recs,u={};for(e=0;e<l.length;e++){c=l[e],a=new p,a.set("MMID",c.MMID),a.parentMov=i;for(o in c)c.hasOwnProperty(o)&&a.set(o,c[o]);u[a.get("MMID")]=a}var h=t[3].recs;for(e=0;e<h.length;e++)u.hasOwnProperty(h[e].pid)&&u[h[e].pid].addProperty(h[e]);n=[];for(o in u)("function"!=typeof u.hasOwnProperty||u.hasOwnProperty(o))&&n.push(u[o]);i.addChildMov(n),i.clearChanged(),i.clearChangedProperty(),r(null,i)}})}},remove:function(t){"object"!=typeof t&&(t=Object.create(null));var e="function"==typeof t.callback?t.callback:new Function;if(!this.get("MMID"))return void e("!MMID");var r=a.call(this);r.dbquery({query:"DELETE FROM Movement WHERE MMID='"+this.get("MMID")+"'",callback:function(t){return t.info.errors.length?void e(t.info.errors):void e(null)}})},insert:function(t){"object"!=typeof t&&(t={});var e=a.call(this),r=this,o="function"==typeof t.callback?t.callback:new Function,p=this.get("MMID"),c=s.objectKeysToLowerCase(r.__movDataModelDefaultFields);c.gsdate.value="NOW()";var l,u,h,f,y,d=[],g=[];r.trigger("beforeInsert");for(h in c)c.hasOwnProperty(h)&&(y=h.toLowerCase(),l=c[h].value||this.get(h),l&&(l instanceof Date&&(l=""+[l.getDate(),l.getMonth()-1,l.getFullYear()].join(".")+" "+[l.getHours(),l.getMinutes(),l.getSeconds()].join(";")),"S"==c[h].type?d.push(l?'"'+s.DBSecureStr(l)+'"':"NULL"):d.push(l?l:"NULL"),g.push("["+h+"]")));var v=["INSERT INTO Movement ("+g.join(",")+") VALUES ("+d.join(",")+")"];v.push("DELETE FROM Property WHERE ExtClass = 'DOCS' AND pid = "+p);var D,b=n.prototype._interfaceFPropertyFields;for(u=0;u<this._property.length;u++)if("object"==typeof this._property[u]&&(D=s.objectKeysToLowerCase(this._property[u]),d=[],g=[],D.pid=r.get("MMID"),D.hasOwnProperty("property")&&D.hasOwnProperty("value"))){D.extclass="DOCS",D.extid=r.get("Doc");for(h in D)D.hasOwnProperty(h)&&(f=null,l=D[h],y=h.toLowerCase(),null!==l&&"undefined"!=typeof l&&(g.push("["+h+"]"),b.hasOwnProperty(h)&&(f=b[y].type,f=f.toLowerCase(),"string"==f&&(l='"'+s.DBSecureStr(l)+'"'),d.push(l))));v.push("INSERT INTO Property ("+g.join(",")+") VALUES ("+d.join(",")+")")}var M=[function(t,r){e.dbquery({query:v.join("; "),callback:function(e){for(var o=[],n=0;n<e.length;n++)e[n].info.errors&&o.push(e[n].info.errors);return o.length?void r(o):void t()}})}];for(u=0;u<this.childrenMovs.length;u++)!function(){var t=u;M.push(function(e,o){r.childrenMovs[t].set("MMPID",r.get("MMID")),r.childrenMovs[t].save({callback:function(t){return t?void o(t):void e()}})})}();return r.get("MMFlag")&&r.get("MMID")&&M.push(function(t,e){var o=r.get("DocDataObject"),n=i.prototype.getInstance();n.postTalk({MMID:r.get("MMID"),MMFlag:r.get("MMFlag"),agent:o?o.get("agent")||999:"999",callback:function(r){return r?void e():void t()}})}),M.length?void Promise.cascade(M).then(function(){o(null),r.trigger("afterInsert")})["catch"](function(t){o(t)}):void o(null)},update:function(t){"object"!=typeof t&&(t={});var e=a.call(this),r=this,o="function"==typeof t.callback?t.callback:new Function,p="undefined"==typeof t.useNotification?!0:Boolean(t.useNotification),c="undefined"==typeof t.saveChildren?!0:Boolean(t.saveChildren),l=s.parseArg({value:"undefined"==typeof t.excludeMovs?null:t.excludeMovs,into:"array",isInt:!0,toInt:!0,kickEmpty:!0,delimiters:[",",";"]})||[],u=(s.parseArg({value:"undefined"==typeof t.includeMovs?null:t.includeMovs,into:"array",isInt:!0,toInt:!0,kickEmpty:!0,delimiters:[",",";"]})||[],this.get("MMID")),h=["SELECT MMID FROM Movement WHERE MMID = "+u," SELECT uid, pid, ExtClass, ExtID, property, [value] FROM Property WHERE pid = "+u+" "," SELECT MMID FROM Movement WHERE MMPID = "+u];r.trigger("beforeUpdate"),e.dbquery({query:h.join("; "),callback:function(t){var a,h,f,y,d,g,v,D,b=[],M=r.getChanged(),O=["gsdate","mmid"];if(!t[0].recs.length)return void o(["!movs.length"]);var m=s.objectKeysToLowerCase(r.__movDataModelDefaultFields),w=t[1].recs,C=t[2].recs,S=[],I=[],P=[],E=[],_=[],j={},L={},N={};for(a=0;a<r.childrenMovs.length;a++)f=r.childrenMovs[a].get("MMID"),N[f]=r.childrenMovs[a];for(a=0;a<C.length;a++)N.hasOwnProperty(C[a].MMID)||_.push(C[a].MMID);var A;for(f=[],a=0;a<r._property.length;a++)"object"==typeof r._property[a]&&r._property[a]&&(A=s.objectKeysToLowerCase(r._property[a]),A.hasOwnProperty("property")&&A.hasOwnProperty("value")&&(r._property[a].pid=r.get("MMID"),r._property[a].extclass="DOCS",r._property[a].extid=r.get("Doc"),f.push(r._property[a]),A.hasOwnProperty("uid")&&(j[A.uid]=r._property[a])));for(r._property=f,a=0;a<w.length;a++)L[w[a].uid]=w[a],j.hasOwnProperty(w[a].uid)?j[w[a].uid].value!=w[a].value&&(E.push(w[a]),b.push("UPDATE Property  SET "+['[value]="'+s.DBSecureStr(j[w[a].uid].value)+'"',"[ExtClass]='DOCS'","[ExtID]="+(r.get("Doc")?'"'+r.get("Doc")+'"':"NULL")].join(", ")+" WHERE  property = '"+w[a].property+"'  AND uid = "+w[a].uid)):P.push(w[a].uid);var R=n.prototype._interfaceFPropertyFields;for(a=0;a<r._property.length;a++)if(!L.hasOwnProperty(r._property[a].uid)){I.push(r._property[a]),y=[],d=[];for(h in r._property[a])r._property[a].hasOwnProperty(h)&&(v=null,g=r._property[a][h],D=h.toLowerCase(),null!==g&&(y.push("["+h+"]"),R.hasOwnProperty(D)&&(v=R[D].type,v=v.toLowerCase(),"string"==v&&(g=null===g||""===g?"NULL":'"'+s.DBSecureStr(g)+'"'),d.push(g))));if(y.length!=d.length||!y.length)continue;b.push("INSERT INTO Property ("+y.join(",")+") VALUES ("+d.join(",")+")")}for(P.length&&b.push("DELETE FROM Property WHERE uid IN ("+P.join(",")+")"),_.length&&(b.push("DELETE FROM Movement WHERE MMID IN ("+_.join(",")+")"),b.push("DELETE FROM Property WHERE pid IN ("+_.join(",")+")")),d=[],a=0;a<M.length;a++)D=M[a].toLowerCase(),m.hasOwnProperty(D)&&(O.indexOf(D)>-1||(g=r.get(D),v=m[D].type,g instanceof Date&&(g=""+[g.getDate(),g.getMonth()-1,g.getFullYear()].join(".")+" "+[g.getHours(),g.getMinutes(),g.getSeconds()].join(";")),"S"==v?d.push("["+D+"]="+(g?"'"+s.DBSecureStr(g)+"'":"NULL")):d.push("["+D+"]="+(g?g:"NULL"))));if(d.length&&b.push("UPDATE Movement SET "+d.join(", ")+" WHERE MMID = "+u),!b.length&&!S.length)return void o(null);if(S.push(function(t,r){e.dbquery({query:b.join("; "),callback:function(e){for(var o=[],n=0;n<e.length;n++)e[n].info.errors&&o.push(e[n].info.errors);return o.length?void r(o):void t()}})}),c)for(a=0;a<r.childrenMovs.length;a++)!function(){var t=a;l.indexOf(r.childrenMovs[t].get("MMID"))>-1||(r.childrenMovs[t].getChanged().length||r.childrenMovs[t].getChangedProperty().length)&&(_.indexOf(r.childrenMovs[t].get("MMID"))>-1||S.push(function(e,o){r.childrenMovs[t].get("MMPID")!=r.get("MMID")&&r.childrenMovs[t].set("MMPID",r.get("MMID")),r.childrenMovs[t].save({useNotification:!1,callback:function(t){return t?void o(t):void e()}})}))}();return p&&r.get("MMFlag")&&r.get("MMID")&&M.indexOf("mmflag")>-1&&S.push(function(t,e){var o=r.get("DocDataObject"),n=i.prototype.getInstance();n.postTalk({MMID:r.get("MMID"),MMFlag:r.get("MMFlag"),agent:o?o.get("agent")||999:"999",callback:function(r){return r?void e():void t()}})}),S.length?void Promise.cascade(S).then(function(){o(null),r.trigger("afterUpdate")})["catch"](function(t){o(t)}):(o(null),void r.trigger("afterUpdate"))}})},__movDataModelDefaultFields:{MMID:{type:"N"},MMPID:{type:"N"},IsDraft:{type:"N"},Tick:{type:"N"},Doc:{type:"S"},Doc1:{type:"S"},ParentDoc:{type:"S"},MMFlag:{type:"S"},InOut:{type:"N"},GSDate:{type:"D"},GSDate2:{type:"D"},Mark:{type:"B"},CodeOp:{type:"S"},CodeDc:{type:"S"},ExtCode:{type:"S"},Storage:{type:"S"},GS:{type:"S"},GSSpec:{type:"S"},GSExt:{type:"N"},Consigment:{type:"N"},Amount:{type:"N"},Rest:{type:"N"},RestSum:{type:"N"},Price:{type:"N"},PrimeCost:{type:"N"},Sum:{type:"N"},Sum2:{type:"N"},FirmProduct:{type:"N"},Remark:{type:"S"},NameAVR:{type:"S"},Agent2:{type:"N"},Manager2:{type:"N"},Performer:{
type:"N"}},save:function(t){var e=this;"object"!=typeof t&&(t=Object.create(null));var r=a.call(this),o=["SELECT MMID, GSDate FROM Movement WHERE MMID = "+(isNaN(this.get("MMID"))?"-1":this.get("MMID")),"SELECT MAX(MMID)+1 as NEW_MMID FROM Movement"];r.dbquery({query:o.join(";"),callback:function(r){r[0].recs.length?(console.log("UPDATE"),e.update(t)):(console.log("INSERT"),e.set("MMID",r[1].recs[0].NEW_MMID),e.insert(t))}})}}),t.exports=p},function(t,e,r){var o=r(9),n=function(){var t,e,r;if(!(arguments.length<2)){var o=arguments[0];for(e=1;e<arguments.length;e++)if("object"==typeof arguments[e]){t={};for(r in arguments[e])arguments[e].hasOwnProperty(r)&&(t[r]={writable:!0,configurable:!0,enumerable:!0,value:arguments[e][r]});o=Object.create(o,t)}return o}},i=function(){this.props=Object.create(null),this.aliases=Object.create(null),this.aliases.get=Object.create(null),this.aliases.getMethods=Object.create(null),this.aliases.set=Object.create(null),this.aliases.setMethods=Object.create(null),this.propsChanged=Object.create(null),this._DataModelSettings={caseSensitiveProps:!1},o.call(this),this.on("set",this._defaultEventSet),this.on("get",this._defaultEventGet),this.clearChanged()};i.prototype=n(o.prototype,{_objectsPrototyping:n,_defaultEventSet:function(t,e){this.trigger(e.type,e)},_defaultEventGet:function(t,e){this.trigger(e.type,e)},setAlias:function(t,e,r){"string"==typeof t&&"string"==typeof e&&(this._DataModelSettings.caseSensitiveProps||(e=e.toLowerCase(),"string"==typeof r&&(r=r.toLowerCase())),"get"==t?this.aliases.get[r]=e:"getMethod"==t&&"function"==typeof r?this.aliases.getMethods[e]=r:"set"==t?this.aliases.set[r]=e:"setMethod"==t&&"function"==typeof r&&(this.aliases.setMethods[e]=r))},get:function(t,e,r){if("string"==typeof t){if(this._DataModelSettings.caseSensitiveProps||(t=t.toLowerCase()),"string"==typeof this.aliases.get[t]&&(t=this.aliases.get[t]),"undefined"==typeof r&&(r=!0),r&&this.trigger("get:"+t),"undefined"!=typeof this.aliases.getMethods[t]){if("undefined"==typeof e&&(e=Object.create(null)),"string"==typeof this.aliases.getMethods[t]){if(t=this.aliases.getMethods[t],"function"!=typeof this[t])return;return this[t].apply(this,[e])}return"function"==typeof this.aliases.getMethods[t]?this.aliases.getMethods[t].apply(this,[e]):void 0}return"undefined"!=typeof this.props[t]?this.props[t]:void 0}},set:function(t,e,r,o){if("undefined"==typeof t)return!1;if("object"==typeof t){var n=Object.create(null);for(var i in t)t.hasOwnProperty(i)&&(n[i]=this.set(i,t[i]));return n}if("string"!=typeof t)return!1;this._DataModelSettings.caseSensitiveProps||(t=t.toLowerCase()),"string"==typeof this.aliases.set[t]&&(t=this.aliases.set[t]),"undefined"==typeof o&&(o=!0);var s=Event||CustomEvent,a=function(t){var o=new s(t);return o.value=e,o.argument=r||null,o};if(o){var p=a("set:"+t),c=a("afterset:"+t);this.trigger(p.type,p)}var l=!0;if("undefined"!=typeof this.aliases.setMethods[t])if("undefined"==typeof r&&(r=Object.create(null)),"string"==typeof this.aliases.setMethods[t]){var u=this.aliases.setMethods[t];if("function"!=typeof this[u])return!1;this.propsChanged[t]=!0,l=this[u].apply(this,[e,r])}else{if("function"!=typeof this.aliases.setMethods[t])return!1;this.propsChanged[t]=!0,l=this.aliases.setMethods[t].apply(this,[e,r])}else this.propsChanged[t]=!0,this.props[t]=e;return o&&this.trigger(c.type,c),l||!0},getChanged:function(){var t=[];for(var e in this.propsChanged)("function"!=typeof this.propsChanged.hasOwnProperty||this.propsChanged.hasOwnProperty(e))&&t.push(e);return t},clearChanged:function(){this.propsChanged=Object.create(null)}}),t.exports=i},function(t,e){var r=function(){this._events={}};r.prototype={trigger:function(t,e){var r=Event||CustomEvent;if("string"!=typeof t)return!1;if(t=t.toLowerCase(),"object"==typeof this._events[t]&&Array.isArray(this._events[t])){e instanceof CustomEvent==0&&e instanceof Event==0&&(e=new r(t));for(var o=this._events[t],n=0;n<o.length;n++)if("function"==typeof o[n]){var i=o[n];o[n].isOnce&&this._removeListener(t,o[n]._unique_id),i.apply(this,[this,e]),i=null}}},on:function(t,e){return"string"!=typeof t||"function"!=typeof e?!1:(t=t.toLowerCase(),"object"==typeof this._events[t]&&Array.isArray(this._events[t])||(this._events[t]=[]),e._unique_id=Math.round(Math.random()*Math.pow(10,18)),"undefined"==typeof e.isOnce&&(e.isOnce=!1),this._events[t].push(e),!0)},_removeListener:function(t,e){if("undefined"==typeof e)return void(this._events[t]=[]);if("object"==typeof this._events[t]&&Array.isArray(this._events[t])){for(var r=[],o=this._events[t],n=0;n<o.length;n++)o[n]._unique_id!=e&&r.push(o[n]);this._events[t]=r}},getListeners:function(t){return"string"!=typeof t?[]:"object"!=typeof this._events[t]?[]:this._events[t]},once:function(t,e){return"function"!=typeof e||"string"!=typeof t?!1:(e.isOnce=!0,this.on(t,e),!0)}},t.exports=r},function(t,e,r){var o=r(9),n=r(8),i=r(11),s={duplicateProperty:function(t){for(var e=Object.getOwnPropertyNames(t),r={},o=0;o<e.length;o++)r[e[o]]=t[e[o]]},toLowerCaseKeys:function(t){for(var e=Object.getOwnPropertyNames(t),r={},o=0;o<e.length;o++)r[e[o].toLowerCase()]=t[e[o]];return r},setChanged:function(t){var e;if("string"==typeof t)e=t;else{if("object"!=typeof t)return;if(t=s.toLowerCaseKeys(t),"string"!=typeof t.property)return;e=t.property}e=e.toLowerCase(),-1==this._changedFProperty.indexOf(e)&&this._changedFProperty.push(e)}},a=function(){this._property=[],this._changedFProperty=[],o.call(this)};a.prototype=n.prototype._objectsPrototyping(o.prototype,{_interfaceFPropertyFields:{uid:{type:"integer"},pid:{type:"integer"},sort:{type:"integer"},value:{type:"string"},valuetype:{type:"string"},extclass:{type:"string"},extid:{type:"string"},property:{type:"string"},tick:{type:"integer"}},splitProperty:function(t){if("object"!=typeof t)return null;var e,r,o,n=function(t,e){t+="";for(var r=[],o="",n=0;n<t.length;n++)o+=t[n],(o.length>=e||n==t.length-1)&&(r.push(o),o="");return r},i=120,a=s.toLowerCaseKeys(t);a.hasOwnProperty("value")?r=a.value:(a.value="",r="");var p,c=[],l=[],u=0;for(r=r.split(" "),o=[],e=0;e<r.length;e++)r[e].length>i?o=o.concat(n(r[e],i)):o.push(r[e]);for(r=o,e=0;e<r.length;e++)c.push(r[e]),u+=r[e].length,(u+(r.hasOwnProperty(e+1)?r[e+1].length:0)>i||e==r.length-1)&&(p=s.toLowerCaseKeys(a),p.value=c.join(" "),l.push(p),c=[],u=0),u+=r[e].length;return l},addProperty:function(t){var e,r,o,n,i=[],a={};if(this.trigger("addProperty"),!t||"object"!=typeof t)return!1;if(Array.isArray(t)){for(var p=0;p<t.length;p++)this.addProperty(t[p]);return!0}for(e in t)if(("function"!=typeof t.hasOwnProperty||t.hasOwnProperty(e))&&"undefined"!=typeof t[e]&&(n=e.toLowerCase(),i.push(n),this._interfaceFPropertyFields.hasOwnProperty(n))){if(r=this._interfaceFPropertyFields[n].type,o=t[e],"integer"==r&&"string"==typeof o){if(o.match(/\D/g))continue;if(""===(o+"").trim())continue}a[n]=o}for(e in this._interfaceFPropertyFields)this._interfaceFPropertyFields.hasOwnProperty(e)&&(n=e.toLowerCase(),a.hasOwnProperty(n)||(a[n]=null));t=a,t.hasOwnProperty("valuetype")&&t.valuetype||(isNaN(t.value)?t.valuetype="C":t.valuetype="N"),s.setChanged.call(this,t),this._property.push(t)},appendProperty:function(){this.addProperty.apply(this,arguments)},updateProperty:function(t,e){if("object"==typeof t&&t&&"object"==typeof e&&e){var r,o,n,i,a={};for(n=Object.getOwnPropertyNames(e),r=0;r<n.length;r++)i=n[r].toLowerCase(),a[i]=e[n[r]];var p=this.getProperty(t),c=!1;for(r=0;r<p.length;r++){for(n=Object.getOwnPropertyNames(p[r]),o=0;o<n.length;o++)i=n[o].toLowerCase(),a.hasOwnProperty(i)&&(c=!0,p[r][n[o]]=a[i]);s.setChanged.call(this,p[r])}return c}},upsertProperty:function(t,e){var r,o,n,i,a,p,c=function(t){for(var e=[],r=0;r<t.length;r++)"object"==typeof t[r]&&t[r]&&e.push(t[r]);return e};if(arguments.length<2)return!1;if(Array.isArray(e)||"object"!=typeof e){if(!Array.isArray(e))return!1}else e=[e];for(r=this.getProperty(t),e=c(e),n=0;"undefined"!=typeof e[n]||"undefined"!=typeof r[n];n++)if("object"==typeof e[n]&&"object"==typeof r[n]){for(p=s.toLowerCaseKeys(e[n]),o=Object.getOwnPropertyNames(r[n]),i=0;i<o.length;i++)a=o[i].toLocaleLowerCase(),p.hasOwnProperty(a)&&(r[n][o[i]]=p[a]);s.setChanged.call(this,r[n])}else"object"==typeof e[n]&&this.addProperty(e[n]);return!0},getProperty:function(t){var e,r,o,n,s,a,p,c=[],l=!1;if(this.trigger("getProperty"),!arguments.length||!t||!Object.getOwnPropertyNames(t).length)return this._property;if("object"!=typeof t)throw new Error('1st argument suppose to be type "Object"');for(n=0;n<this._property.length;n++)if(e=0,"object"==typeof this._property[n]&&this._property[n]){var u=new i(this._property[n]);for(p=Object.getOwnPropertyNames(t),s=0;s<p.length;s++)a=p[s].toLowerCase(),u.has(a)||(e=1),r=u.get(a),o=t[p[s]],l||(r="string"==typeof r?r.toLowerCase():r,o="string"==typeof o?o.toLowerCase():o),r!=o&&(e=1);e||c.push(this._property[n])}return c},getChangedProperty:function(){return this._changedFProperty},clearChangedProperty:function(){this._changedFProperty=[]},removeProperty:function(t){var e=[];if("object"!=typeof t)return!1;var r,o,n,i,a,p=!1;if(this.trigger("removeProperty"),!arguments.length||!t||!Object.getOwnPropertyNames(t).length)return this._property=[],!0;for(var c=0;c<this._property.length;c++){r=1,o={};for(n in this._property[c])("function"!=typeof this._property[c].hasOwnProperty||this._property[c].hasOwnProperty(n))&&"undefined"!=typeof this._property[c][n]&&(o[n.toLowerCase()]=this._property[c][n]);for(n in t)("function"!=typeof t.hasOwnProperty||t.hasOwnProperty(n))&&"undefined"!=typeof t[n]&&o.hasOwnProperty(n.toLowerCase())&&(i=o[n.toLowerCase()],a=t[n],p||(i="string"==typeof i?i.toLowerCase():i,a="string"==typeof a?a.toLowerCase():a),i!=a&&(r=0));s.setChanged.call(this,this._property[c]),r||e.push(this._property[c])}var l=this._property.length!=e.length;return this._property=e,l},deleteProperty:function(){return this.removeProperty.apply(this,arguments)}}),t.exports=a},function(t,e){var r=function(t){if(this instanceof r==0)throw new Error("Wrong context");if(this._props=Object.create(null),arguments.length){if("object"!=typeof t)throw new Error('Argument suppose to be type "Object"');for(var e=Object.getOwnPropertyNames(t),o=0;o<e.length;o++)this.set(e[o],t[e[o]])}};r.create=function(t){return new r(t)},r.prototype={getKeys:function(){return Object.getOwnPropertyNames(this._props)},getLength:function(){return this.getKeys().length},get:function(t){if("string"!=typeof t)throw new Error('Argument suppose to be type "String"');return t=t.toLowerCase(),this.has(t)?this._props[t]:void 0},set:function(t,e){if(arguments.length<2)throw new Error("Suppose to be 2 arguments");if("string"!=typeof t)throw new Error('Argument suppose to be type "String"');this._props[t.toLowerCase()]=e},has:function(t){if("string"!=typeof t)throw new Error('Argument suppose to be type "String"');return Boolean(Object.getOwnPropertyDescriptor(this._props,t.toLowerCase()))},remove:function(t){if("string"!=typeof t)throw new Error('Argument suppose to be type "String"');delete this._props[t.toLowerCase()]}},t.exports=r},function(t,e,r){var o=r(6),n=function(){var t=r(3),e=t.prototype.DBModel;return this._fabulaInstance?this._fabulaInstance.getDBInstance():e.prototype.getInstance()},i=function(){this.instances.push(this)};i.prototype={instances:[],postTalk:function(t){"object"!=typeof t&&(t=Object.create(null));var e="undefined"==typeof t.MMID||isNaN(t.agent)?null:parseInt(t.MMID),r="string"==typeof t.message?t.message:"",i="string"==typeof t.MMFlag?t.MMFlag:"",s="undefiend"==typeof t.agent||isNaN(t.agent)?999:t.agent,a="function"==typeof t.callback?t.callback:function(){},p=n.call(this);return p?"function"!=typeof p.dbquery?(a("!db"),void console.error("!db")):void(e&&p.dbquery({query:"SELECT Txt FROM Talk WHERE Txt LIKE '%&rArr;%' AND MM = "+e+" ORDER BY TalkID DESC",callback:function(t){var n=[];if(t.info.errors)return Array.isArray(t.info.errors)&&t.info.errors.length?n=n.concat(t.info.errors):"string"==typeof t.info.errors&&n.push(t.info.errors),void a(n);var c="";t.recs.length?(c=t.recs[0].Txt.match(/(&rArr;).[0-9]/g),c&&(c=c[0],c=c[c.length-1]),i||(i=c)):i&&(c=i),p.dbquery({query:"INSERT INTO Talk (Dt, Txt, Agent, [MM], [Tm], [Key]) VALUES (DATE(), '"+(i?"Фаза: "+c+" &rArr; "+i:"")+"<br>"+o.DBSecureStr(r)+"', "+s+", "+e+",  FORMAT(TIME(),'HH:MM'), NOW())",callback:function(t){t.info.errors&&(Array.isArray(t.info.errors)&&t.info.errors.length?n=n.concat(t.info.errors):"string"==typeof t.info.errors&&n.push(t.info.errors)),a(n.length?n:null)}})}})):(a("!db"),void console.error("!db"))},getTalks:function(){},getInstance:function(){return this.instances.length?this.instances[0]:new i}},t.exports=i},function(t,e,r){var o=r(6),n=r(8),i=r(10),s=r(7),a=function(){var t=r(3),e=t.prototype.DBModel;return this._fabulaInstance?this._fabulaInstance.getDBInstance():e.prototype.getInstance()},p=function(){n.call(this),i.call(this),this.set({Agent:null,Manager:null,Person:null,FirmContract:null,Sum1:null,Debt:null,DocID:null,DocType:null,Comment:null,Note:null}),this.on("set:docid",this._eventSetDocID),this.on("set:company",this._eventSetCompany),this.on("set:doctype",this._eventSetDocType),this.movs=[],this.set("_unique_sid",Math.random()*Math.pow(10,17)),this.clearChanged(),this._RB_DOC_CACHE.length||this._initRB_DOC_CACHE()};p.prototype=n.prototype._objectsPrototyping(n.prototype,i.prototype,{_docIDApply:function(){for(var t=0;t<this.movs.length;t++)this.movs[t]&&this.movs[t].get("Doc1")!=this.get("DocID")&&this.movs[t].set("Doc",this.get("DocID"))},_eventSetDocID:function(t,e){e.value&&"string"==typeof e.value&&10==e.value.length&&(t=this,this.parseDocID(e.value,function(r){t.props.doctype=r.docType,t.props.company=r.company,t.propsChanged.doctype=!0,t.propsChanged.company=!0,t.movSet("Doc",e.value)}))},_eventSetCompany:function(t,e){t=this,this.parseDocID(this.get("DocID"),function(r){t.set("DocID",e.value+r.year+r.prefix+r.code),t.movSet("Doc",t.get("DocID"))})},_eventSetDocType:function(t,e){t=this,this.parseDocID(this.get("DocID"),function(r){for(var o=e.value,n=null,i=t._RB_DOC_CACHE,s=0;s<i.length;s++)i[s].ID4.toLowerCase()==o.toLowerCase()&&(n=i[s].Prefix);n&&(t.set("DocID",r.company+r.year+n+r.code),t.movSet("Doc",t.get("DocID")))})},_eventSetID:function(){},movSet:function(){for(var t=0;t<this.movs.length;t++)"object"==typeof this.movs[t]&&this.movs[t].set.apply(this.movs[t],arguments)},getMov:function(t,e){if(!arguments.length)return this.movs;"object"==typeof t&&t||(t={}),"object"==typeof e&&e||(e={});var r;if(!(t instanceof s))return this.movs.filter(function(r){if(!r)return!1;if("object"!=typeof r)return!1;var o,n,i=!0;for(o=Object.getOwnPropertyNames(t),n=0;n<o.length;n++)r.get(o[n])!=t[o[n]]&&(i=!1);return o=Object.getOwnPropertyNames(e),o.length&&(r.getProperty(e).length||(i=!1)),i});for(r=0;r<this.movs.length;r++)if(this.movs[r].get("_unique_sid")==t.get("_unique_sid"))return[this.movs[r]];return[]},addMov:function(t){t.set("DocDataObject",this),t.get("Doc1")!=this.get("DocID")&&t.set("Doc",this.get("DocID")),this.movs.push(t)},deleteMov:function(t){return"object"!=typeof t?null:t instanceof s?(this.movs=this.movs.filter(function(e){return e?"object"!=typeof e?!1:e.get("_unique_sid")!=t.get("_unique_sid"):!1}),!0):(this.movs=this.movs.filter(function(e){if(!e)return!1;if("object"!=typeof e)return!1;for(var r=Object.getOwnPropertyNames(t),o=0;o<r.length;o++)if(e.get(r[o])!=t[r[o]])return!0;return!1}),!0)},deleteAllMovs:function(){this.movs=[]},removeMov:function(){return this.deleteMov.apply(this,arguments)},removeAllMovs:function(){return this.deleteAllMovs()},save:function(t){var e=null,r=this,o=arguments;"object"!=typeof t&&(t=Object.create(null));var n=a.call(this),i="function"==typeof t.callback?t.callback:new Function;new Promise(function(o,i){var s,a=null,p=null,c=null;if("string"==typeof t.GSID)a=t.GSID;else for(s=0;s<r.movs.length&&!(a=r.movs[s].get("GSID"));s++)a=null;p=r.get("DocType"),c=r.get("Company"),r.get("DocID")?n.dbquery({query:"SELECT ID, DocID FROM DOCS WHERE DocID = '"+r.get("DocID")+"' OR id = "+r.get("ID"),callback:function(t){return t.recs.length?(r.set("ID",t.recs[0].ID),e=r.update,void o()):void r.getNewDocID({GSID:a,docType:p,companyID:c,callback:function(t,n){return t?void i(t):(r.set("ID",null),r.set("DocID",n),e=r.insert,void o())}})}}):r.getNewDocID({GSID:a,docType:p,companyID:c,callback:function(t,n){return t?void i(t):(r.set("DocID",n),e=r.insert,void o())}})}).then(function(){e.apply(r,o)})["catch"](function(t){i(t)})},insert:function(t){var e,r,n=this;"object"!=typeof t&&(t=Object.create(null));var s,p="function"==typeof t.callback?t.callback:function(){},c=a.call(this),l=[],u=this.getProperty(null),h=[],f=o.objectKeysToLowerCase(this.__docDataModelsDefaultFields),y=["id"],d=[],g=[];for(r in f)f.hasOwnProperty(r)&&(y.indexOf(r)>-1||(s=f[r].value||this.get(r),s&&(s instanceof Date&&(s=""+[s.getDate(),s.getMonth()-1,s.getFullYear()].join(".")+" "+[s.getHours(),s.getMinutes(),s.getSeconds()].join(";")),"S"==f[r].type?d.push(s?'"'+o.DBSecureStr(s)+'"':"NULL"):d.push(s?s:"NULL"),g.push("["+r+"]"))));h.push("INSERT INTO DOCS ("+g.join(",")+") VALUES ("+d.join(",")+")"),h.push("DELETE FROM Property WHERE ExtClass = 'DOCS' AND ExtID = '"+this.get("DocID")+"' ");var v,D;for(e=0;e<u.length;e++)if(v=u[e],d=[],g=[],"object"==typeof v&&(v=o.objectKeysToLowerCase(v),v.pid=0,v.hasOwnProperty("property")&&v.property&&v.hasOwnProperty("value"))){v.hasOwnProperty("extclass")&&v.extclass||(v.extclass="DOCS"),v.hasOwnProperty("extid")&&v.extid||!n.get("DocID")||(v.extid=n.get("DocID"));for(r in v)v.hasOwnProperty(r)&&(D=null,s=v[r],null!==s&&"undefined"!=typeof s&&(g.push("["+r+"]"),i.prototype._interfaceFPropertyFields.hasOwnProperty(r.toLowerCase())&&(D=i.prototype._interfaceFPropertyFields[r.toLowerCase()].type,D=D.toLowerCase()),"string"==D&&(s='"'+o.DBSecureStr(s)+'"'),d.push(s)));h.push("INSERT INTO Property ("+g.join(",")+") VALUES ("+d.join(",")+")")}if(l.length)return void p(l);var b=[];for(h.length&&b.push(function(t,e){c.dbquery({query:h.join("; "),callback:function(r){for(var o=[],n=0;n<r.length;n++)r[n].info.errors.length&&(o=o.concat(o,r[n].info.errors));return o.length?(l=l.concat(o),void e(l)):void t()}})}),e=0;e<n.movs.length;e++)!function(){var t=e;b.push(function(e,r){n.movs[t].get("Doc1")!=n.get("DocID")&&n.movs[t].set("Doc",n.get("DocID")),n.movs[t].save({callback:function(t){return t?(l=l.concat(t),void r(l)):void e()}})})}();return b.length?void Promise.cascade(b,{stackSize:1,interval:1e3}).then(function(){p(null)})["catch"](function(t){p(t)}):void p(null)},update:function(t,e,r,n){var s=this;"object"!=typeof t&&(t=Object.create(null)),"object"!=typeof n&&(n=Object.create(null)),o.objectHasOwnProperty(n,"callback")||(n.callback=new Function);var p="function"==typeof t.callback?t.callback:new Function,c=o.parseArg({value:"undefined"==typeof t.excludeMovs?null:t.excludeMovs,into:"array",isInt:!0,toInt:!0,kickEmpty:!0,delimiters:[",",";"]})||[],l=a.call(this);l.dbquery({query:["SELECT uid, property, [value], ExtID   FROM Property  WHERE  pid = 0 AND ExtClass = 'DOCS'  AND ExtID IN (SELECT DocID FROM DOCS WHERE ID = "+s.get("ID")+")","SELECT MMID FROM Movement WHERE Doc IN (SELECT DocID FROM DOCS WHERE ID = "+s.get("ID")+") "].join("; "),callback:function(t){var e,r,a,u,h,f,y=s.getChanged(),d=o.objectKeysToLowerCase(s.__docDataModelsDefaultFields),g=["id","regdate","datenew","useredit","dateedit"],v=t[0].recs,D=t[1].recs,b=[],M=[],O=[];for(u=0;u<y.length;u++)r=y[u].toLowerCase(),d.hasOwnProperty(r)&&(g.indexOf(r)>-1||(e=s.get(r),a=d[r].type,e instanceof Date&&(e=""+[e.getDate(),e.getMonth()-1,e.getFullYear()].join(".")+" "+[e.getHours(),e.getMinutes(),e.getSeconds()].join(";")),"S"==a?b.push("["+r+"]="+(e?'"'+o.DBSecureStr(e)+'"':"NULL")):b.push("["+r+"]="+(e?e:"NULL"))));b.length&&O.push("UPDATE DOCS SET "+b.join(", ")+" WHERE ID = "+s.get("ID"));var m,w={},C={};for(tmp=[],u=0;u<s._property.length;u++)"object"==typeof s._property[u]&&s._property[0]&&(m=o.objectKeysToLowerCase(s._property[u]),m.hasOwnProperty("value")&&null!==m.value&&(tmp.push(m),m.pid=0,m.extid=s.get("DocID"),m.extclass="DOCS",m.hasOwnProperty("uid")&&m.uid&&(C[m.uid]=m)));for(s._property=tmp,u=0;u<v.length;u++)m=o.objectKeysToLowerCase(v[u]),m.hasOwnProperty("uid")&&m.uid&&(w[m.uid]=m);var S=i.prototype._interfaceFPropertyFields;for(u=0;u<s._property.length;u++)if(!s._property[u].uid||!w.hasOwnProperty(s._property[u].uid)){M=[],b=[];for(h in s._property[u])s._property[u].hasOwnProperty(h)&&(e=s._property[u][h],f=h.toLowerCase(),a=null,null!==e&&S.hasOwnProperty(f)&&(a=S[f].type,a=a.toLowerCase(),"string"==a&&(e=null===e||""===e?"NULL":'"'+o.DBSecureStr(e)+'"'),b.push(e),M.push("["+f+"]")));if(M.length!=b.length||!M.length)continue;O.push("INSERT INTO Property ("+M.join(",")+") VALUES ("+b.join(",")+")")}var I=[];for(u=0;u<v.length;u++)C.hasOwnProperty(v[u].uid)?C[v[u].uid].value==v[u].value&&v[u].ExtID==s.get("DocID")||O.push("UPDATE Property  SET "+['[value]="'+o.DBSecureStr(C[v[u].uid].value)+'"',"[ExtID]='"+s.get("DocID")+"'","[ExtClass]='DOCS'"].join(", ")+" WHERE  property = '"+v[u].property+"'  AND uid = "+v[u].uid):I.push(v[u].uid);for(var P=[],E={},_=0;_<s.movs.length;_++)"object"==typeof s.movs[_]&&(E[s.movs[_].get("MMID")]=s.movs[_]);for(u=0;u<D.length;u++)E.hasOwnProperty(D[u].MMID)||P.push(D[u].MMID);I.length&&O.push("DELETE FROM Property WHERE uid IN ("+I.join(",")+")"),P.length&&(O.push("DELETE FROM Movement WHERE MMID IN ("+P.join(",")+")"),O.push("DELETE FROM Property WHERE pid IN ("+P.join(",")+")"));var j=[];for(O.length&&j.push(function(t,e){l.dbquery({query:O.join("; "),callback:function(r){for(var o=[],n=0;n<r.length;n++)r[n].info.errors.length&&(o=o.concat(o,r[n].info.errors));return o.length?void e(o):void t()}})}),u=0;u<s.movs.length;u++)!function(){var t=u;(s.movs[t].getChanged().length||s.movs[t].getChangedProperty().length)&&(P.indexOf(s.movs[t].get("MMID"))>-1||c.indexOf(s.movs[t].get("MMID"))>-1||(s.movs[t].get("Doc1")!=s.get("DocID")&&s.movs[t].set("Doc",s.get("DocID")),j.push(function(e,r){var o=n.callback;n.callback=function(t){return o(t),t?void r(t):void e()},s.movs[t].save(n)})))}();return j.length?void Promise.cascade(j,{stackSize:1,interval:1e3}).then(function(){p(null)})["catch"](function(t){p(t)}):void p(null)}})},getJSON:function(){for(var t,e=Object.getOwnPropertyNames(this.props),r=o.objectKeysToLowerCase(this.__docDataModelsDefaultFields),n={},i=0;i<e.length;i++)t=e[i].toLowerCase(),r.hasOwnProperty(t)&&(n[t]=this.props[e[i]]);return n},load:function(t){"object"!=typeof t&&(t=Object.create(null));var e=this,r=[],n="function"==typeof t.callback?t.callback:new Function,i="string"==typeof t.DocID&&10==t.DocID.length?t.DocID:e.get("DocID"),s="function"==typeof t.taskModel?t.taskModel:null;"function"==typeof t.movModel&&(s=t.movModel);var p="object"==typeof t.excludeGSID?t.excludeGSID:[],c="object"==typeof t.includeGSID?t.includeGSID:[],l="undefined"==typeof t.useSubMovs?!1:Boolean(t.useSubMovs),u=o.parseArg({value:t.fields?A.fields:null,into:"array",kickEmpty:!0,toLowerCase:!0,delimiters:[";",","]});u&&u.length||(u=["ID","DocID","Agent","Manager","User","Person","FirmContract","[Sum1]","[Debt]","Company","DocType","Status","Format(RegDate,'yyyy-mm-dd Hh:Nn:Ss') as RegDate"]);var h=["SELECT "+u.join(",")+" FROM DOCS WHERE DocID = '"+i+"' ","SELECT MMID, GS FROM Movement WHERE Doc = '"+i+"' "+(l?" OR ParentDoc = '"+i+"' ":""),"SELECT uid, extClass, extID, property, value FROM Property WHERE pid = 0 AND ExtClass = 'DOCS' AND ExtID = '"+i+"' "],f=a.call(this);f.dbquery({query:h.join("; "),callback:function(t){var o,i,a,l;if(!t[0].recs.length)return void n(["!doc.length"]);var u=t[0].recs[0],h=t[1].recs,f=t[2].recs;for(a in u)u.hasOwnProperty(a)&&e.set(a,u[a]);for(l=[],i=0;i<f.length;i++)l.push(f[i]);if(e.addProperty(l),e.clearChanged(),"function"!=typeof s)n(r.length?r:null);else{var y=[];for(i=0;i<h.length;i++)parseInt(h[i].MMID)&&(y.indexOf(h[i].MMID)>-1||c.length&&-1==c.indexOf(h[i].GS)||p.length&&p.indexOf(h[i].GS)>-1||y.push(h[i].MMID));var d=[];for(i=0;i<y.length;i++)!function(){var t=y[i];d.push(new Promise(function(r){o=new s,o.set("MMID",t),e.addMov(o),o.load({callback:function(t){t&&(console.error(new Error(t.join(";\n"))),e.removeMov({MMID:o.get("MMID")})),r()}})}))}();Promise.all(d).then(function(){for(var t,o,i=e.getMov(),s=0;s<i.length;s++){t=i[s].childrenMovs;for(var a=0;a<t.length;a++)o=e.getMov({MMID:t[a].get("MMID")}),o.length&&(t[a]=o[0])}e.clearChanged(),e.clearChangedProperty(),n(r.length?r:null,e)})["catch"](function(t){console.log(t)})}}})},remove:function(t){"object"!=typeof t&&(t=Object.create(null));var e="function"==typeof t.callback?t.callback:new Function;if(!this.get("DocID"))return void e("!DocID");var r=a.call(this);r.dbquery({query:"DELETE FROM DOCS WHERE DocID='"+this.get("DocID")+"'",callback:function(t){return t.info.errors.length?void e(t.info.errors):void e(null)}})},_RB_DOC_CACHE:[],_initRB_DOC_CACHE:function(t){var e=a.call(this),r=this;e.dbquery({query:"SELECT ID4, DocName, Prefix, GSFilter, Sort FROM RB_DOC ORDER BY Sort ASC",callback:function(e){Object.getPrototypeOf(r)._RB_DOC_CACHE=e.recs,"function"==typeof t&&t(r._RB_DOC_CACHE)}})},parseDocID:function(t,e){if("string"==typeof t){var r=arguments,o=this,n={code:t.slice(5),prefix:t.slice(3,5),company:t.slice(0,2),year:t[2],docType:null};this._RB_DOC_CACHE.length||Object.getPrototypeOf(this)._initRB_DOC_CACHE(function(){o._RB_DOC_CACHE.length&&o.parseDocID.apply(o,r)});for(var i=this._RB_DOC_CACHE,s=0;s<i.length;s++)i[s].Prefix.toLowerCase()==n.prefix.toLowerCase()&&(n.docType=i[s].ID4);"function"==typeof e&&e(n)}},getNewDocID:function(t){if("object"==typeof t&&"function"==typeof t.callback){var e=this,r=t.callback,o=a.call(this),n="string"==typeof t.GSID?t.GSID:null,i="string"==typeof t.docType?t.docType:null,s="string"==typeof t.companyID?t.companyID:null;if(!s)return void r(["!arg.companyID"],null);var p=["SELECT TOP 10 mid(DocID,6,5) as nDocID FROM DOCS WHERE right(Year(Date()),1) = mid(DocID,3,1) AND LEN(DocID) = 10 ORDER BY mid(DocID,6,5) DESC","SELECT right(Year(Date()),1) as _year","SELECT ID4, DocName, Prefix, GSFilter, Sort FROM RB_DOC ORDER BY Sort ASC"];o.dbquery({query:p.join("; "),callback:function(t){var o,a,p,c,l=null;if(!t[2].recs.length)return void r(["!RB_DOC.length"]);var u=t[2].recs;if(e._RB_DOC_CACHE=u,i)for(a=0;a<u.length;a++)u[a].ID4.toLowerCase()==i.toLowerCase()&&(l=u[a].Prefix);else{if(!n)return void r(["!docType && !GSID"]);for(a=0;a<t[2].recs.length;a++)for(c=t[2].recs[a].GSFilter.split(";"),p=0;p<c.length;p++)c[p]=c[p].trim().toLowerCase(),c[p]&&n.toLowerCase().match(new RegExp(c[p]))&&(l=t[2].recs[a].Prefix)}if(!l)return void r(["!docTypePrefix"],null);o=t[0].recs.length?parseInt(t[0].recs[0].nDocID)+1:"00001";var h=t[1].recs[0]._year,f=5-o.toString().length;for(a=0;f>a;a++)o="0"+o.toString();r(null,s+h+l+o)}})}},__docDataModelsDefaultFields:{id:{type:"N"},DocID:{type:"S"},ParentDoc:{type:"S"},ParentDoc2:{type:"S"},Tick:{type:"N"},OriginalDoc:{type:"S"},Company:{type:"S"},Status:{type:"S"},DocType:{type:"S"},User:{type:"S"},RegDate:{type:"D",value:"NOW()"},DateAVR:{type:"D"},DateAcc:{type:"D"},TxtAcc:{type:"S"},WorkName:{type:"S"},Agent:{type:"S"},Manager:{type:"S"},FirmContract:{type:"N"},Person:{type:"S"},FirmCustomer:{type:"N"},PayType:{type:"S"},Discount:{type:"N"},Disc_Text:{type:"S"},Margin:{type:"N"},Marg_Text:{type:"S"},CurRate:{type:"N"},Currency:{type:"S"},Sum1:{type:"N"},Sum2:{type:"N"},Debt:{type:"N"},SumExt:{type:"N"},SumExt2:{type:"N"},SumExt3:{type:"N"},SumExtNDS:{type:"N"},RateNDS:{type:"N"},RateSpecTax:{type:"N"},SumNDS:{type:"N"},SumSpecTax:{type:"N"},Notice:{type:"S"},DocFlag:{type:"S"},FilterGS:{type:"S"},IsDeleted:{type:"N"},DateNew:{type:"D"},UserNew:{type:"S"},DateEdit:{type:"D",value:"NOW()"},UserEdit:{type:"S"},TextAVR:{type:"S"},Addr:{type:"S"},Debt2:{type:"N"},SumExt4:{type:"N"}}}),t.exports=p},function(t,e,r){var o=function(){var t=r(3),e=t.prototype.DBModel;return this._fabulaInstance?this._fabulaInstance.getDBInstance():e.prototype.getInstance()},n=function(){this.init()};n.prototype={init:function(){this.dbModel=null,this.data=[],this.instances.push(this),this.GSUnits=Object.create(null),this.state=0},instances:[],getInstance:function(){return this.instances.length?this.instances[0]:new n},load:function(t){"undefined"==typeof t&&(t=Object.create(null));var e="function"==typeof t.callback?t.callback:function(){},r=o.call(this),n=this,i=["SELECT * FROM Gands WHERE GSCOP LIKE '87%' OR GSCOP LIKE '17%' OR GSCOP LIKE '27%' OR GSCOP LIKE '07%' ","SELECT * FROM GandsExt WHERE GSExID IN (SELECT GSID FROM Gands WHERE GSCOP LIKE '87%' OR GSCOP LIKE '17%' OR GSCOP LIKE '27%' OR GSCOP LIKE '07%')"];r&&r.dbquery({query:i.join("; "),callback:function(t){n.data=t[0].recs,n.state=1;var r,o,i=Object.create(null);for(r=0;r<n.data.length;r++)i[n.data[r].GSID]=n.data[r],n.data[r].gandsExtRef=[];n.dataReferences=i;var s=t[1].recs;for(r=0;r<s.length;r++)"undefined"!=typeof i[s[r].GSExID]&&i[s[r].GSExID].gandsExtRef.push(s[r]);for(r=0,o=n.data.length;o>r;r++)"undefined"==typeof n.GSUnits[n.data[r].GSID]&&(n.GSUnits[n.data[r].GSID]=n.data[r].GSUnit);e(n.data)}})},get:function(t){"object"!=typeof t&&(t=Object.create(null));var e="object"!=typeof t.type?[]:t.type,r="object"!=typeof t.cop?[]:t.cop;if(!e.length&&!r.length)return this.data;var o,n,i=[];for(o=0;o<this.data.length;o++)if(!(i.indexOf(this.data[o])>-1)){if(e.indexOf("material-paper")>-1&&this.data[o].GSID.toLowerCase().match(/тцбу/gi)&&this.data[o].GSID.length>4&&i.push(this.data[o]),e.indexOf("paper")>-1&&this.data[o].GSID.toLowerCase().match(/тцбуме|тцбуоф|тцбуса|тцбуск|тцбуцп|тцбуфб/gi)&&i.push(this.data[o]),e.indexOf("materials:print")>-1&&this.data[o].GSID.match(/тцмп/gi)){if(this.data[o].GSID.match(/тцмпбг|тцмпкк|тцмпкл|тцмпкр|тцмпкт|тцмпрс|тцмпс1|тцмпск|тцмпто/gi)||this.data[o].GSID.length<=6)continue;i.push(this.data[o])}for(e.indexOf("carton")>-1&&this.data[o].GSID.toLowerCase().match(/тцбуд1|тцбуд3|тцбукр|тцбупр/gi)&&i.push(this.data[o]),e.indexOf("envelope")>-1&&this.data[o].GSID.toLowerCase().match(/тцбуко/)&&i.push(this.data[o]),e.indexOf("products")>-1&&(this.data[o].GSCOP.match(/17/)||this.data[o].GSCOP.match(/27/))&&(this.data[o].GSCOP.match(/276|176/)||i.push(this.data[o])),e.indexOf("print")>-1&&(this.data[o].GSCOP.match(/17/)||this.data[o].GSCOP.match(/27/)||this.data[o].GSCOP.match(/07/))&&i.push(this.data[o]),e.indexOf("products:print")>-1&&(this.data[o].GSCOP.match(/17/)||this.data[o].GSCOP.match(/27/))&&(this.data[o].GSCOP.match(/276|176/)||i.push(this.data[o])),n=0;n<r.length;n++)r[n]instanceof RegExp?this.data[o].GSCOP.match(r[n])&&i.push(this.data[o]):"string"==typeof r[n].GSCOP&&r[n]==this.data[o]&&i.push(this.data[o])}return i},getGSUnit:function(t){return"undefined"!=typeof t&&"undefined"!=typeof this.GSUnits[t]?this.GSUnits[t]:void 0}},t.exports=n},function(t,e,r){var o=function(){var t=r(3),e=t.prototype.DBModel;return this._fabulaInstance?this._fabulaInstance.getDBInstance():e.prototype.getInstance()},n=function(){this.init()};n.prototype={init:function(){this.dbModel=null,this.data=[],this.instances.push(this),this.state=0},instances:[],getInstance:function(){return this.instances.length?this.instances[0]:new n},load:function(t){"undefined"==typeof t&&(t=Object.create(null));var e="function"==typeof t.callback?t.callback:function(){},r=o.call(this),n=this;r&&r.dbquery({query:"SELECT FirmID, Name FROM Firms",dbsrc:"common",callback:function(t){n.data=t.recs,n.state=1,e(n.data)}})},get:function(){return this.data}},t.exports=n},function(t,e,r){var o=function(){var t=r(3),e=t.prototype.DBModel;return this._fabulaInstance?this._fabulaInstance.getDBInstance():e.prototype.getInstance()},n=function(){this.init()};n.prototype={init:function(){this.dbModel=null,this.data=[],this.instances.push(this),this.state=0},instances:[],getInstance:function(){
return this.instances.length?this.instances[0]:new n},load:function(t){"undefined"==typeof t&&(t=Object.create(null));var e="function"==typeof t.callback?t.callback:function(){},r=o.call(this),n=this;r&&r.dbquery({query:"SELECT Value, Property FROM Property WHERE ExtClass = 'path' ",callback:function(t){n.data=t.recs,n.state=1,e(n.data)}})},get:function(){return this.data}},t.exports=n}]);